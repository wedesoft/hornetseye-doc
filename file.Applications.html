<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: Applications
  
    &mdash; Hornetseye - Ruby-extension for Computer Vision (DEPRECATED)
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Applications";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="file_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: Applications</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'>
<h1 id="label-Applications">Applications</h1>

<h2 id="label-Video+Thumbnails">Video Thumbnails</h2>

<h2 id="label-EXR+Viewer">EXR Viewer</h2>

<p><img src="images/exr.png"></p>

<p>This is small viewer for displaying EXR images. The exposure can be modified with the slider.</p>

<p>The user interface was defined using Qt-Designer. The scroll area was defined by promoting a QFrame object to QScrollArea. See reference about using custom widgets for more information.</p>

<p>To use this application you need to install Qt4Ruby. You also need to compile the user interface description file first:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_rbuic4'>rbuic4</span> <span class='id identifier rubyid_exrviewer'>exrviewer</span><span class='period'>.</span><span class='id identifier rubyid_ui'>ui</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_ui_exrviewer'>ui_exrviewer</span><span class='period'>.</span><span class='id identifier rubyid_rb'>rb</span>
</code></pre>

<p>The UI file is available for download here: <a href="exrviewer.ui">exrviewer.ui</a></p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_openexr</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_qt4</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require_relative'>require_relative</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>ui_exrviewer</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="Hornetseye.html" title="Hornetseye (module)">Hornetseye</a></span></span>
<span class='kw'>class</span> <span class='const'>EXRViewer</span> <span class='op'>&lt;</span> <span class='const'>Qt</span><span class='op'>::</span><span class='const'>Widget</span>
  <span class='id identifier rubyid_slots'>slots</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>load()</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_slots'>slots</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>recompute()</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span> <span class='id identifier rubyid_parent'>parent</span> <span class='op'>=</span> <span class='kw'>nil</span> <span class='rparen'>)</span>
    <span class='kw'>super</span> <span class='id identifier rubyid_parent'>parent</span>
    <span class='ivar'>@ui</span> <span class='op'>=</span> <span class='const'>Ui</span><span class='op'>::</span><span class='const'>EXRViewer</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='ivar'>@ui</span><span class='period'>.</span><span class='id identifier rubyid_setupUi'>setupUi</span> <span class='kw'>self</span>
    <span class='id identifier rubyid_connect'>connect</span> <span class='ivar'>@ui</span><span class='period'>.</span><span class='id identifier rubyid_close_button'>close_button</span><span class='comma'>,</span> <span class='const'>SIGNAL</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>clicked()</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='const'>SLOT</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>close()</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_connect'>connect</span> <span class='ivar'>@ui</span><span class='period'>.</span><span class='id identifier rubyid_load_button'>load_button</span><span class='comma'>,</span> <span class='const'>SIGNAL</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>clicked()</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='const'>SLOT</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>load()</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_connect'>connect</span> <span class='ivar'>@ui</span><span class='period'>.</span><span class='id identifier rubyid_brightness_slider'>brightness_slider</span><span class='comma'>,</span> <span class='const'>SIGNAL</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>valueChanged(int)</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='comma'>,</span>
            <span class='kw'>self</span><span class='comma'>,</span> <span class='const'>SLOT</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>recompute()</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='ivar'>@arr</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='ivar'>@channelmax</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='ivar'>@label</span> <span class='op'>=</span> <span class='const'>Qt</span><span class='op'>::</span><span class='const'>Label</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='ivar'>@ui</span><span class='period'>.</span><span class='id identifier rubyid_scroll_area'>scroll_area</span><span class='period'>.</span><span class='id identifier rubyid_setWidget'>setWidget</span> <span class='ivar'>@label</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_load'>load</span>
    <span class='id identifier rubyid_fileName'>fileName</span> <span class='op'>=</span> <span class='const'>Qt</span><span class='op'>::</span><span class='const'>FileDialog</span><span class='period'>.</span><span class='id identifier rubyid_getOpenFileName'>getOpenFileName</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Load EXR File</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                                              <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>EXR image (*.exr)</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>if</span> <span class='id identifier rubyid_fileName'>fileName</span>
      <span class='ivar'>@arr</span> <span class='op'>=</span> <span class='const'>MultiArray</span><span class='period'>.</span><span class='id identifier rubyid_load_sfloatrgb'>load_sfloatrgb</span> <span class='id identifier rubyid_fileName'>fileName</span>
      <span class='ivar'>@max</span> <span class='op'>=</span> <span class='id identifier rubyid_proc'>proc</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='lbracket'>[</span><span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_r'>r</span><span class='comma'>,</span> <span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_g'>g</span><span class='comma'>,</span> <span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_b'>b</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_max'>max</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span> <span class='ivar'>@arr</span><span class='period'>.</span><span class='id identifier rubyid_max'>max</span>
      <span class='ivar'>@ui</span><span class='period'>.</span><span class='id identifier rubyid_brightness_slider'>brightness_slider</span><span class='period'>.</span><span class='id identifier rubyid_setEnabled'>setEnabled</span> <span class='kw'>true</span>
      <span class='id identifier rubyid_recompute'>recompute</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_recompute'>recompute</span>
    <span class='id identifier rubyid_factor'>factor</span> <span class='op'>=</span> <span class='float'>2.0</span> <span class='op'>**</span> <span class='lparen'>(</span><span class='ivar'>@ui</span><span class='period'>.</span><span class='id identifier rubyid_brightness_slider'>brightness_slider</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span> <span class='op'>/</span> <span class='float'>4096.0</span><span class='rparen'>)</span> <span class='op'>*</span> <span class='int'>0xFF</span> <span class='op'>/</span> <span class='ivar'>@max</span>
    <span class='id identifier rubyid_img'>img</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='ivar'>@arr</span> <span class='op'>*</span> <span class='id identifier rubyid_factor'>factor</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_minor'>minor</span><span class='lparen'>(</span><span class='int'>0xFF</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_ubytergb'>to_ubytergb</span>
    <span class='id identifier rubyid_qimage'>qimage</span> <span class='op'>=</span> <span class='const'>Qt</span><span class='op'>::</span><span class='const'>Image</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_memory'>memory</span><span class='period'>.</span><span class='id identifier rubyid_export'>export</span><span class='comma'>,</span> <span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_width'>width</span><span class='comma'>,</span> <span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_height'>height</span><span class='comma'>,</span> <span class='const'>Qt</span><span class='op'>::</span><span class='const'>Image</span><span class='op'>::</span><span class='const'>Format_RGB888</span>
    <span class='id identifier rubyid_pixmap'>pixmap</span> <span class='op'>=</span> <span class='const'>Qt</span><span class='op'>::</span><span class='const'>Pixmap</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='id identifier rubyid_pixmap'>pixmap</span><span class='period'>.</span><span class='id identifier rubyid_convertFromImage'>convertFromImage</span> <span class='id identifier rubyid_qimage'>qimage</span>
    <span class='ivar'>@label</span><span class='period'>.</span><span class='id identifier rubyid_setPixmap'>setPixmap</span> <span class='id identifier rubyid_pixmap'>pixmap</span>
    <span class='ivar'>@label</span><span class='period'>.</span><span class='id identifier rubyid_resize'>resize</span> <span class='id identifier rubyid_pixmap'>pixmap</span><span class='period'>.</span><span class='id identifier rubyid_width'>width</span><span class='comma'>,</span> <span class='id identifier rubyid_pixmap'>pixmap</span><span class='period'>.</span><span class='id identifier rubyid_height'>height</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
<span class='id identifier rubyid_app'>app</span> <span class='op'>=</span> <span class='const'>Qt</span><span class='op'>::</span><span class='const'>Application</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='const'>ARGV</span>
<span class='id identifier rubyid_viewer'>viewer</span> <span class='op'>=</span> <span class='const'>EXRViewer</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='id identifier rubyid_viewer'>viewer</span><span class='period'>.</span><span class='id identifier rubyid_show'>show</span>
<span class='id identifier rubyid_app'>app</span><span class='period'>.</span><span class='id identifier rubyid_exec'>exec</span>
</code></pre>

<h2 id="label-XVideo+Widget">XVideo Widget</h2>

<p><img src="images/xvwidget.jpg"></p>

<p>The XVideo widget allows to use XVideo acceleration in a Qt4-QtRuby application. The example application shows how to write a small program for playing videos.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_ffmpeg</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_alsa</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_qt4</span><span class='tstring_end'>&#39;</span></span>
<span class='const'>VIDEO</span> <span class='op'>=</span> <span class='const'>ARGV</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>http://peach.themazzone.com/durian/movies/sintel-1024-surround.mp4</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>class</span> <span class='const'>Win</span> <span class='op'>&lt;</span> <span class='const'>Qt</span><span class='op'>::</span><span class='const'>Widget</span>
  <span class='id identifier rubyid_slots'>slots</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>seek(int)</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>
    <span class='kw'>super</span>
    <span class='ivar'>@screen</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Hornetseye.html" title="Hornetseye (module)">Hornetseye</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Hornetseye/XvWidget.html" title="Hornetseye::XvWidget (class)">XvWidget</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Hornetseye/XvWidget.html#initialize-instance_method" title="Hornetseye::XvWidget#initialize (method)">new</a></span></span> <span class='kw'>self</span>
    <span class='ivar'>@slider</span> <span class='op'>=</span> <span class='const'>Qt</span><span class='op'>::</span><span class='const'>Slider</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='const'>Qt</span><span class='op'>::</span><span class='const'>Horizontal</span>
    <span class='id identifier rubyid_layout'>layout</span> <span class='op'>=</span> <span class='const'>Qt</span><span class='op'>::</span><span class='const'>VBoxLayout</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='kw'>self</span>
    <span class='id identifier rubyid_layout'>layout</span><span class='period'>.</span><span class='id identifier rubyid_addWidget'>addWidget</span> <span class='ivar'>@screen</span>
    <span class='id identifier rubyid_layout'>layout</span><span class='period'>.</span><span class='id identifier rubyid_addWidget'>addWidget</span> <span class='ivar'>@slider</span>
    <span class='id identifier rubyid_connect'>connect</span> <span class='ivar'>@slider</span><span class='comma'>,</span> <span class='const'>SIGNAL</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>valueChanged(int)</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='const'>SLOT</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>seek(int)</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='ivar'>@seeking</span> <span class='op'>=</span> <span class='kw'>true</span>
    <span class='ivar'>@video</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='ivar'>@timer</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_start'>start</span>
    <span class='ivar'>@slider</span><span class='period'>.</span><span class='id identifier rubyid_tracking'>tracking</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='ivar'>@slider</span><span class='period'>.</span><span class='id identifier rubyid_minimum'>minimum</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='ivar'>@slider</span><span class='period'>.</span><span class='id identifier rubyid_single_step'>single_step</span> <span class='op'>=</span> <span class='int'>60</span>
    <span class='ivar'>@slider</span><span class='period'>.</span><span class='id identifier rubyid_page_step'>page_step</span> <span class='op'>=</span> <span class='int'>600</span>
    <span class='kw'>if</span> <span class='ivar'>@video</span><span class='period'>.</span><span class='id identifier rubyid_duration'>duration</span>
      <span class='ivar'>@slider</span><span class='period'>.</span><span class='id identifier rubyid_maximum'>maximum</span> <span class='op'>=</span> <span class='ivar'>@video</span><span class='period'>.</span><span class='id identifier rubyid_duration'>duration</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
    <span class='kw'>else</span>
      <span class='ivar'>@slider</span><span class='period'>.</span><span class='id identifier rubyid_maximum'>maximum</span> <span class='op'>=</span> <span class='const'>ARGV</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='int'>1</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_setWindowTitle'>setWindowTitle</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>XVideo</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_update_audio'>update_audio</span>
    <span class='ivar'>@audio_frame</span> <span class='op'>=</span> <span class='ivar'>@video</span><span class='period'>.</span><span class='id identifier rubyid_read_audio'>read_audio</span> <span class='kw'>unless</span> <span class='ivar'>@audio_frame</span>
    <span class='kw'>while</span> <span class='ivar'>@speaker</span><span class='period'>.</span><span class='id identifier rubyid_delay'>delay</span> <span class='op'>&lt;</span> <span class='ivar'>@speaker</span><span class='period'>.</span><span class='id identifier rubyid_rate'>rate</span> <span class='op'>/</span> <span class='int'>4</span>
      <span class='ivar'>@speaker</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span> <span class='ivar'>@audio_frame</span>
      <span class='ivar'>@audio_frame</span> <span class='op'>=</span> <span class='ivar'>@video</span><span class='period'>.</span><span class='id identifier rubyid_read_audio'>read_audio</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_update_video'>update_video</span>
    <span class='ivar'>@screen</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span> <span class='ivar'>@video</span><span class='period'>.</span><span class='id identifier rubyid_read_video'>read_video</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_timerEvent'>timerEvent</span><span class='lparen'>(</span> <span class='id identifier rubyid_e'>e</span> <span class='rparen'>)</span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_update_audio'>update_audio</span> <span class='kw'>if</span> <span class='ivar'>@video</span><span class='period'>.</span><span class='id identifier rubyid_has_audio?'>has_audio?</span>
      <span class='id identifier rubyid_update_video'>update_video</span>
      <span class='kw'>unless</span> <span class='ivar'>@slider</span><span class='period'>.</span><span class='id identifier rubyid_sliderDown'>sliderDown</span>
        <span class='ivar'>@seeking</span> <span class='op'>=</span> <span class='kw'>false</span>
        <span class='id identifier rubyid_p'>p</span> <span class='op'>=</span> <span class='ivar'>@video</span><span class='period'>.</span><span class='id identifier rubyid_video_pos'>video_pos</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
        <span class='ivar'>@slider</span><span class='period'>.</span><span class='id identifier rubyid_maximum'>maximum</span> <span class='op'>=</span> <span class='id identifier rubyid_p'>p</span> <span class='kw'>if</span> <span class='id identifier rubyid_p'>p</span> <span class='op'>&gt;</span> <span class='ivar'>@slider</span><span class='period'>.</span><span class='id identifier rubyid_maximum'>maximum</span>
        <span class='ivar'>@slider</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='id identifier rubyid_p'>p</span>
        <span class='ivar'>@seeking</span> <span class='op'>=</span> <span class='kw'>true</span>
      <span class='kw'>end</span>
      <span class='kw'>if</span> <span class='ivar'>@video</span><span class='period'>.</span><span class='id identifier rubyid_has_audio?'>has_audio?</span>
        <span class='id identifier rubyid_t'>t</span> <span class='op'>=</span> <span class='ivar'>@video</span><span class='period'>.</span><span class='id identifier rubyid_audio_pos'>audio_pos</span> <span class='op'>-</span> <span class='lparen'>(</span><span class='ivar'>@speaker</span><span class='period'>.</span><span class='id identifier rubyid_delay'>delay</span> <span class='op'>+</span> <span class='ivar'>@audio_frame</span><span class='period'>.</span><span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_quo'>quo</span><span class='lparen'>(</span> <span class='ivar'>@speaker</span><span class='period'>.</span><span class='id identifier rubyid_rate'>rate</span> <span class='rparen'>)</span>
        <span class='id identifier rubyid_delay'>delay</span> <span class='op'>=</span> <span class='lbracket'>[</span> <span class='int'>3</span><span class='period'>.</span><span class='id identifier rubyid_quo'>quo</span><span class='lparen'>(</span> <span class='int'>2</span> <span class='rparen'>)</span> <span class='op'>/</span> <span class='ivar'>@video</span><span class='period'>.</span><span class='id identifier rubyid_frame_rate'>frame_rate</span><span class='comma'>,</span> <span class='lbracket'>[</span> <span class='ivar'>@video</span><span class='period'>.</span><span class='id identifier rubyid_video_pos'>video_pos</span> <span class='op'>-</span> <span class='id identifier rubyid_t'>t</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_max'>max</span> <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_min'>min</span>
        <span class='id identifier rubyid_killTimer'>killTimer</span> <span class='ivar'>@timer</span>
        <span class='ivar'>@timer</span> <span class='op'>=</span> <span class='id identifier rubyid_startTimer'>startTimer</span><span class='lparen'>(</span> <span class='lparen'>(</span> <span class='id identifier rubyid_delay'>delay</span> <span class='op'>*</span> <span class='int'>1000</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
      <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_e'>e</span>
      <span class='id identifier rubyid_stop'>stop</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_start'>start</span>
    <span class='kw'>unless</span> <span class='ivar'>@video</span>
      <span class='id identifier rubyid_stop'>stop</span>
      <span class='ivar'>@video</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Hornetseye.html" title="Hornetseye (module)">Hornetseye</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Hornetseye/AVInput.html" title="Hornetseye::AVInput (class)">AVInput</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Hornetseye/AVInput.html#new-class_method" title="Hornetseye::AVInput.new (method)">new</a></span></span> <span class='const'>VIDEO</span>
      <span class='ivar'>@audio_frame</span> <span class='op'>=</span> <span class='kw'>nil</span>
      <span class='id identifier rubyid_resize'>resize</span> <span class='lparen'>(</span><span class='ivar'>@video</span><span class='period'>.</span><span class='id identifier rubyid_width'>width</span> <span class='op'>*</span> <span class='ivar'>@video</span><span class='period'>.</span><span class='id identifier rubyid_aspect_ratio'>aspect_ratio</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='comma'>,</span> <span class='ivar'>@video</span><span class='period'>.</span><span class='id identifier rubyid_height'>height</span>
      <span class='kw'>if</span> <span class='ivar'>@video</span><span class='period'>.</span><span class='id identifier rubyid_has_audio?'>has_audio?</span>
        <span class='ivar'>@speaker</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Hornetseye.html" title="Hornetseye (module)">Hornetseye</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Hornetseye/AlsaOutput.html" title="Hornetseye::AlsaOutput (class)">AlsaOutput</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Hornetseye/AlsaOutput.html#new-class_method" title="Hornetseye::AlsaOutput.new (method)">new</a></span></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>default</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='ivar'>@video</span><span class='period'>.</span><span class='id identifier rubyid_sample_rate'>sample_rate</span><span class='comma'>,</span> <span class='ivar'>@video</span><span class='period'>.</span><span class='id identifier rubyid_channels'>channels</span>
        <span class='ivar'>@timer</span> <span class='op'>=</span> <span class='id identifier rubyid_startTimer'>startTimer</span> <span class='int'>0</span>
      <span class='kw'>else</span>
        <span class='ivar'>@speaker</span> <span class='op'>=</span> <span class='kw'>nil</span>
        <span class='ivar'>@timer</span> <span class='op'>=</span> <span class='id identifier rubyid_startTimer'>startTimer</span><span class='lparen'>(</span><span class='lparen'>(</span><span class='int'>1000</span> <span class='op'>/</span> <span class='ivar'>@video</span><span class='period'>.</span><span class='id identifier rubyid_frame_rate'>frame_rate</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_stop'>stop</span>
    <span class='ivar'>@audio_frame</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='kw'>if</span> <span class='ivar'>@video</span>
      <span class='ivar'>@video</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
      <span class='ivar'>@video</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='ivar'>@speaker</span>
      <span class='ivar'>@speaker</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
      <span class='ivar'>@speaker</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='ivar'>@timer</span> <span class='op'>!=</span> <span class='int'>0</span>
      <span class='id identifier rubyid_killTimer'>killTimer</span> <span class='ivar'>@timer</span>
      <span class='ivar'>@timer</span> <span class='op'>=</span> <span class='int'>0</span>
      <span class='ivar'>@screen</span><span class='period'>.</span><span class='id identifier rubyid_clear'>clear</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_seek'>seek</span><span class='lparen'>(</span> <span class='id identifier rubyid_p'>p</span> <span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='ivar'>@seeking</span>
      <span class='kw'>begin</span>
        <span class='id identifier rubyid_start'>start</span>
        <span class='ivar'>@audio_frame</span> <span class='op'>=</span> <span class='kw'>nil</span>
        <span class='ivar'>@video</span><span class='period'>.</span><span class='id identifier rubyid_pos'>pos</span> <span class='op'>=</span> <span class='id identifier rubyid_p'>p</span>
        <span class='kw'>if</span> <span class='ivar'>@speaker</span>
          <span class='ivar'>@speaker</span><span class='period'>.</span><span class='id identifier rubyid_drop'>drop</span>
        <span class='kw'>end</span>
      <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
        <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_e'>e</span>
        <span class='id identifier rubyid_stop'>stop</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
<span class='id identifier rubyid_app'>app</span> <span class='op'>=</span> <span class='const'>Qt</span><span class='op'>::</span><span class='const'>Application</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='const'>ARGV</span>
<span class='const'>Win</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='period'>.</span><span class='id identifier rubyid_show'>show</span>
<span class='id identifier rubyid_app'>app</span><span class='period'>.</span><span class='id identifier rubyid_exec'>exec</span>
</code></pre>

<h2 id="label-Webcam+Viewer">Webcam Viewer</h2>

<p><img src="images/webcam.jpg"></p>

<p>This is an example using an XVideo widget to implement a webcam viewer. The viewer also has controls for a few camera features.</p>

<p>To use this application you need to install Qt4Ruby. You also need to compile the user interface description files first:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_rbuic4'>rbuic4</span> <span class='id identifier rubyid_modedialog'>modedialog</span><span class='period'>.</span><span class='id identifier rubyid_ui'>ui</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_ui_modedialog'>ui_modedialog</span><span class='period'>.</span><span class='id identifier rubyid_rb'>rb</span>
<span class='id identifier rubyid_rbuic4'>rbuic4</span> <span class='id identifier rubyid_webcam'>webcam</span><span class='period'>.</span><span class='id identifier rubyid_ui'>ui</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_ui_webcam'>ui_webcam</span><span class='period'>.</span><span class='id identifier rubyid_rb'>rb</span>
</code></pre>

<p>The UI files are available for download here: <a href="webcam.ui">webcam.ui</a>, <a href="modedialog.ui">modedialog.ui</a></p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_v4l2</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_qt4</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require_relative'>require_relative</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>ui_modedialog</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require_relative'>require_relative</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>ui_webcam</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="Hornetseye.html" title="Hornetseye (module)">Hornetseye</a></span></span>
<span class='id identifier rubyid_app'>app</span> <span class='op'>=</span> <span class='const'>Qt</span><span class='op'>::</span><span class='const'>Application</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='const'>ARGV</span>
<span class='kw'>class</span> <span class='const'>ModeDialog</span> <span class='op'>&lt;</span> <span class='const'>Qt</span><span class='op'>::</span><span class='const'>Dialog</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_parent'>parent</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='kw'>super</span> <span class='id identifier rubyid_parent'>parent</span>
    <span class='ivar'>@ui</span> <span class='op'>=</span> <span class='const'>Ui</span><span class='op'>::</span><span class='const'>ModeDialog</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='ivar'>@ui</span><span class='period'>.</span><span class='id identifier rubyid_setupUi'>setupUi</span> <span class='kw'>self</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_clear_modes'>clear_modes</span>
    <span class='ivar'>@ui</span><span class='period'>.</span><span class='id identifier rubyid_modeList'>modeList</span><span class='period'>.</span><span class='id identifier rubyid_clear'>clear</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_add_mode'>add_mode</span><span class='lparen'>(</span><span class='id identifier rubyid_typecode'>typecode</span><span class='comma'>,</span> <span class='id identifier rubyid_width'>width</span><span class='comma'>,</span> <span class='id identifier rubyid_height'>height</span><span class='rparen'>)</span>
    <span class='ivar'>@ui</span><span class='period'>.</span><span class='id identifier rubyid_modeList'>modeList</span><span class='period'>.</span><span class='id identifier rubyid_addItem'>addItem</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_typecode'>typecode</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_width'>width</span><span class='embexpr_end'>}</span><span class='tstring_content'> x </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_height'>height</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_selected'>selected</span>
    <span class='ivar'>@ui</span><span class='period'>.</span><span class='id identifier rubyid_modeList'>modeList</span><span class='period'>.</span><span class='id identifier rubyid_currentRow'>currentRow</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
<span class='kw'>class</span> <span class='const'>Webcam</span> <span class='op'>&lt;</span> <span class='const'>Qt</span><span class='op'>::</span><span class='const'>Dialog</span>
  <span class='id identifier rubyid_slots'>slots</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>open_camera(bool)</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_slots'>slots</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>select_feature(int)</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_slots'>slots</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>set_feature(int)</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_parent'>parent</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='kw'>super</span> <span class='id identifier rubyid_parent'>parent</span>
    <span class='ivar'>@ui</span> <span class='op'>=</span> <span class='const'>Ui</span><span class='op'>::</span><span class='const'>WebcamWindow</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='ivar'>@ui</span><span class='period'>.</span><span class='id identifier rubyid_setupUi'>setupUi</span> <span class='kw'>self</span>
    <span class='ivar'>@xvwidget</span> <span class='op'>=</span> <span class='const'>XvWidget</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='ivar'>@ui</span><span class='period'>.</span><span class='id identifier rubyid_scrollArea'>scrollArea</span><span class='period'>.</span><span class='id identifier rubyid_widget'>widget</span> <span class='op'>=</span> <span class='ivar'>@xvwidget</span>
    <span class='id identifier rubyid_connect'>connect</span> <span class='ivar'>@ui</span><span class='period'>.</span><span class='id identifier rubyid_connectButton'>connectButton</span><span class='comma'>,</span> <span class='const'>SIGNAL</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>toggled(bool)</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='const'>SLOT</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>open_camera(bool)</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_connect'>connect</span> <span class='ivar'>@ui</span><span class='period'>.</span><span class='id identifier rubyid_featureCombo'>featureCombo</span><span class='comma'>,</span> <span class='const'>SIGNAL</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>currentIndexChanged(int)</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='comma'>,</span>
            <span class='kw'>self</span><span class='comma'>,</span> <span class='const'>SLOT</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>select_feature(int)</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_connect'>connect</span> <span class='ivar'>@ui</span><span class='period'>.</span><span class='id identifier rubyid_featureSlider'>featureSlider</span><span class='comma'>,</span> <span class='const'>SIGNAL</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>valueChanged(int)</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='comma'>,</span>
            <span class='kw'>self</span><span class='comma'>,</span> <span class='const'>SLOT</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>set_feature(int)</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='ivar'>@input</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='ivar'>@timer</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='ivar'>@features</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='ivar'>@mode_dialog</span> <span class='op'>=</span> <span class='const'>ModeDialog</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_open_camera'>open_camera</span><span class='lparen'>(</span><span class='id identifier rubyid_on'>on</span><span class='rparen'>)</span>
    <span class='kw'>begin</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_on'>on</span>
        <span class='ivar'>@ui</span><span class='period'>.</span><span class='id identifier rubyid_errorLabel'>errorLabel</span><span class='period'>.</span><span class='id identifier rubyid_text'>text</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>
        <span class='ivar'>@input</span> <span class='op'>=</span> <span class='const'>V4L2Input</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='ivar'>@ui</span><span class='period'>.</span><span class='id identifier rubyid_deviceEdit'>deviceEdit</span><span class='period'>.</span><span class='id identifier rubyid_text'>text</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_modes'>modes</span><span class='op'>|</span>
          <span class='ivar'>@mode_dialog</span><span class='period'>.</span><span class='id identifier rubyid_clear_modes'>clear_modes</span>
          <span class='id identifier rubyid_modes'>modes</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_mode'>mode</span><span class='op'>|</span> <span class='ivar'>@mode_dialog</span><span class='period'>.</span><span class='id identifier rubyid_add_mode'>add_mode</span> <span class='op'>*</span><span class='id identifier rubyid_mode'>mode</span> <span class='rbrace'>}</span>
          <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Opening camera was aborted</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>unless</span> <span class='ivar'>@mode_dialog</span><span class='period'>.</span><span class='id identifier rubyid_exec'>exec</span> <span class='op'>==</span> <span class='const'>Qt</span><span class='op'>::</span><span class='const'>Dialog</span><span class='op'>::</span><span class='const'>Accepted</span>
          <span class='id identifier rubyid_modes'>modes</span><span class='lbracket'>[</span><span class='ivar'>@mode_dialog</span><span class='period'>.</span><span class='id identifier rubyid_selected'>selected</span> <span class='op'>||</span> <span class='int'>0</span><span class='rbracket'>]</span>
        <span class='kw'>end</span>
        <span class='ivar'>@input</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span>
        <span class='kw'>for</span> <span class='id identifier rubyid_feature'>feature</span> <span class='kw'>in</span> <span class='const'>V4L2Input</span><span class='op'>::</span><span class='const'>FEATURE_BASE</span> <span class='op'>..</span> <span class='const'>V4L2Input</span><span class='op'>::</span><span class='const'>FEATURE_LASTP1</span>
          <span class='kw'>if</span> <span class='ivar'>@input</span><span class='period'>.</span><span class='id identifier rubyid_feature_exist?'>feature_exist?</span> <span class='id identifier rubyid_feature'>feature</span>
            <span class='ivar'>@features</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_feature'>feature</span>
            <span class='ivar'>@ui</span><span class='period'>.</span><span class='id identifier rubyid_featureCombo'>featureCombo</span><span class='period'>.</span><span class='id identifier rubyid_addItem'>addItem</span> <span class='ivar'>@input</span><span class='period'>.</span><span class='id identifier rubyid_feature_name'>feature_name</span><span class='lparen'>(</span><span class='id identifier rubyid_feature'>feature</span><span class='rparen'>)</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>
        <span class='ivar'>@ui</span><span class='period'>.</span><span class='id identifier rubyid_featureCombo'>featureCombo</span><span class='period'>.</span><span class='id identifier rubyid_enabled'>enabled</span> <span class='op'>=</span> <span class='kw'>true</span>
        <span class='ivar'>@ui</span><span class='period'>.</span><span class='id identifier rubyid_deviceEdit'>deviceEdit</span><span class='period'>.</span><span class='id identifier rubyid_enabled'>enabled</span> <span class='op'>=</span> <span class='kw'>false</span>
        <span class='ivar'>@timer</span> <span class='op'>=</span> <span class='id identifier rubyid_startTimer'>startTimer</span> <span class='int'>0</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_killTimer'>killTimer</span> <span class='ivar'>@timer</span> <span class='kw'>if</span> <span class='ivar'>@timer</span> <span class='op'>!=</span> <span class='int'>0</span>
        <span class='kw'>if</span> <span class='ivar'>@input</span>
          <span class='ivar'>@input</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
          <span class='ivar'>@input</span> <span class='op'>=</span> <span class='kw'>nil</span>
        <span class='kw'>end</span>
        <span class='ivar'>@features</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
        <span class='ivar'>@ui</span><span class='period'>.</span><span class='id identifier rubyid_featureCombo'>featureCombo</span><span class='period'>.</span><span class='id identifier rubyid_clear'>clear</span>
        <span class='ivar'>@ui</span><span class='period'>.</span><span class='id identifier rubyid_deviceEdit'>deviceEdit</span><span class='period'>.</span><span class='id identifier rubyid_enabled'>enabled</span> <span class='op'>=</span> <span class='kw'>true</span>
        <span class='ivar'>@ui</span><span class='period'>.</span><span class='id identifier rubyid_featureCombo'>featureCombo</span><span class='period'>.</span><span class='id identifier rubyid_enabled'>enabled</span> <span class='op'>=</span> <span class='kw'>false</span>
      <span class='kw'>end</span>
    <span class='kw'>rescue</span> <span class='const'>RuntimeError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
      <span class='ivar'>@ui</span><span class='period'>.</span><span class='id identifier rubyid_errorLabel'>errorLabel</span><span class='period'>.</span><span class='id identifier rubyid_text'>text</span> <span class='op'>=</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
      <span class='ivar'>@ui</span><span class='period'>.</span><span class='id identifier rubyid_connectButton'>connectButton</span><span class='period'>.</span><span class='id identifier rubyid_checked'>checked</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_select_feature'>select_feature</span><span class='lparen'>(</span><span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='ivar'>@input</span> <span class='kw'>and</span> <span class='id identifier rubyid_value'>value</span> <span class='op'>&gt;=</span> <span class='int'>0</span>
      <span class='id identifier rubyid_feature'>feature</span> <span class='op'>=</span> <span class='ivar'>@features</span><span class='lbracket'>[</span><span class='id identifier rubyid_value'>value</span><span class='rbracket'>]</span>
      <span class='ivar'>@input</span><span class='comma'>,</span> <span class='id identifier rubyid_input'>input</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='ivar'>@input</span>
      <span class='ivar'>@ui</span><span class='period'>.</span><span class='id identifier rubyid_featureSlider'>featureSlider</span><span class='period'>.</span><span class='id identifier rubyid_minimum'>minimum</span> <span class='op'>=</span> <span class='id identifier rubyid_input'>input</span><span class='period'>.</span><span class='id identifier rubyid_feature_min'>feature_min</span> <span class='id identifier rubyid_feature'>feature</span>
      <span class='ivar'>@ui</span><span class='period'>.</span><span class='id identifier rubyid_featureSlider'>featureSlider</span><span class='period'>.</span><span class='id identifier rubyid_maximum'>maximum</span> <span class='op'>=</span> <span class='id identifier rubyid_input'>input</span><span class='period'>.</span><span class='id identifier rubyid_feature_max'>feature_max</span> <span class='id identifier rubyid_feature'>feature</span>
      <span class='ivar'>@ui</span><span class='period'>.</span><span class='id identifier rubyid_featureSlider'>featureSlider</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='id identifier rubyid_input'>input</span><span class='period'>.</span><span class='id identifier rubyid_feature_read'>feature_read</span> <span class='id identifier rubyid_feature'>feature</span>
      <span class='ivar'>@ui</span><span class='period'>.</span><span class='id identifier rubyid_featureSlider'>featureSlider</span><span class='period'>.</span><span class='id identifier rubyid_enabled'>enabled</span> <span class='op'>=</span> <span class='kw'>true</span>
      <span class='ivar'>@input</span> <span class='op'>=</span> <span class='id identifier rubyid_input'>input</span>
    <span class='kw'>else</span>
      <span class='ivar'>@ui</span><span class='period'>.</span><span class='id identifier rubyid_featureSlider'>featureSlider</span><span class='period'>.</span><span class='id identifier rubyid_enabled'>enabled</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_set_feature'>set_feature</span><span class='lparen'>(</span><span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='ivar'>@input</span>
      <span class='ivar'>@input</span><span class='period'>.</span><span class='id identifier rubyid_feature_write'>feature_write</span> <span class='ivar'>@features</span><span class='lbracket'>[</span><span class='ivar'>@ui</span><span class='period'>.</span><span class='id identifier rubyid_featureCombo'>featureCombo</span><span class='period'>.</span><span class='id identifier rubyid_currentIndex'>currentIndex</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_timerEvent'>timerEvent</span><span class='lparen'>(</span> <span class='id identifier rubyid_e'>e</span> <span class='rparen'>)</span>
    <span class='kw'>begin</span>
      <span class='ivar'>@xvwidget</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span> <span class='ivar'>@input</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span>
    <span class='kw'>rescue</span> <span class='const'>RuntimeError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
      <span class='ivar'>@ui</span><span class='period'>.</span><span class='id identifier rubyid_errorLabel'>errorLabel</span><span class='period'>.</span><span class='id identifier rubyid_text'>text</span> <span class='op'>=</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
      <span class='ivar'>@ui</span><span class='period'>.</span><span class='id identifier rubyid_connectButton'>connectButton</span><span class='period'>.</span><span class='id identifier rubyid_checked'>checked</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
<span class='id identifier rubyid_win'>win</span> <span class='op'>=</span> <span class='const'>Webcam</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='id identifier rubyid_win'>win</span><span class='period'>.</span><span class='id identifier rubyid_show'>show</span>
<span class='id identifier rubyid_app'>app</span><span class='period'>.</span><span class='id identifier rubyid_exec'>exec</span>
</code></pre>

<h2 id="label-2D+Plot">2D Plot</h2>

<p><img src="images/plot2d.png"></p>

<p>With Gordon James Millers <a href="http://rgplot.rubyforge.org/">rgplot</a> package you can use <a href="http://www.gnuplot.info/">Gnuplot</a> from within Ruby. This example shows how you can plot the histogram of an image.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_rmagick</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>gnuplot</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="Hornetseye.html" title="Hornetseye (module)">Hornetseye</a></span></span>
<span class='kw'>def</span> <span class='id identifier rubyid_plot'>plot</span><span class='lparen'>(</span> <span class='op'>*</span><span class='id identifier rubyid_arrs'>arrs</span> <span class='rparen'>)</span>
  <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='id identifier rubyid_arrs'>arrs</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span> <span class='const'>Hash</span> <span class='rparen'>)</span> <span class='op'>?</span> <span class='id identifier rubyid_arrs'>arrs</span><span class='period'>.</span><span class='id identifier rubyid_pop'>pop</span> <span class='op'>:</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='lbrace'>{</span> <span class='symbol'>:title</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span> <span class='kw'>nil</span> <span class='rbracket'>]</span> <span class='op'>*</span> <span class='id identifier rubyid_arrs'>arrs</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span> <span class='id identifier rubyid_options'>options</span>
  <span class='id identifier rubyid_title'>title</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span> <span class='symbol'>:title</span> <span class='rbracket'>]</span>
  <span class='id identifier rubyid_title'>title</span> <span class='op'>=</span> <span class='lbracket'>[</span> <span class='id identifier rubyid_title'>title</span> <span class='rbracket'>]</span> <span class='kw'>unless</span> <span class='id identifier rubyid_title'>title</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'><span class='object_link'><a href="Array.html" title="Array (class)">Array</a></span></span>
  <span class='const'>Gnuplot</span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_gp'>gp</span><span class='op'>|</span>
    <span class='const'>Gnuplot</span><span class='op'>::</span><span class='const'>Plot</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span> <span class='id identifier rubyid_gp'>gp</span> <span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_plot'>plot</span><span class='op'>|</span>
      <span class='id identifier rubyid_arrs'>arrs</span><span class='period'>.</span><span class='id identifier rubyid_zip'>zip</span><span class='lparen'>(</span> <span class='id identifier rubyid_title'>title</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_arr'>arr</span><span class='comma'>,</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
        <span class='id identifier rubyid_x'>x</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='int'>0</span><span class='op'>...</span><span class='id identifier rubyid_arr'>arr</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_v'>v</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span> <span class='rbrace'>}</span>
        <span class='id identifier rubyid_plot'>plot</span><span class='period'>.</span><span class='id identifier rubyid_data'>data</span> <span class='op'>&lt;&lt;</span> <span class='const'>Gnuplot</span><span class='op'>::</span><span class='const'>DataSet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span> <span class='lbracket'>[</span> <span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='id identifier rubyid_arr'>arr</span> <span class='rbracket'>]</span> <span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ds'>ds</span><span class='op'>|</span>
          <span class='id identifier rubyid_ds'>ds</span><span class='period'>.</span><span class='id identifier rubyid_with'>with</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>linespoints</span><span class='tstring_end'>&quot;</span></span>
          <span class='kw'>if</span> <span class='id identifier rubyid_t'>t</span>
            <span class='id identifier rubyid_ds'>ds</span><span class='period'>.</span><span class='id identifier rubyid_title'>title</span> <span class='op'>=</span> <span class='id identifier rubyid_t'>t</span>
          <span class='kw'>else</span>
            <span class='id identifier rubyid_ds'>ds</span><span class='period'>.</span><span class='id identifier rubyid_notitle'>notitle</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>nil</span>
<span class='kw'>end</span>
<span class='id identifier rubyid_img'>img</span> <span class='op'>=</span> <span class='const'>MultiArray</span><span class='period'>.</span><span class='id identifier rubyid_load_ubyte'>load_ubyte</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>http://www.wedesoft.de/hornetseye-api/images/grey.png</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_plot'>plot</span> <span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_histogram'>histogram</span><span class='lparen'>(</span> <span class='int'>256</span> <span class='rparen'>)</span><span class='comma'>,</span> <span class='symbol'>:title</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Histogram</span><span class='tstring_end'>&#39;</span></span> <span class='rbracket'>]</span>
</code></pre>

<h2 id="label-3D+Plot">3D Plot</h2>

<p><img src="images/plot3d.png"></p>

<p>This example shows how you can use Gnuplot to make a 3D plot of a two-dimensional array.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>multiarray</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>gnuplot</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_include'>include</span>  <span class='const'><span class='object_link'><a href="Hornetseye.html" title="Hornetseye (module)">Hornetseye</a></span></span>
<span class='kw'>class</span> <span class='const'>Node</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_to_gsplot'>to_gsplot</span>
    <span class='id identifier rubyid_retval'>retval</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>for</span> <span class='id identifier rubyid_j'>j</span> <span class='kw'>in</span> <span class='int'>0</span><span class='op'>...</span><span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
      <span class='kw'>for</span> <span class='id identifier rubyid_i'>i</span> <span class='kw'>in</span> <span class='int'>0</span><span class='op'>...</span><span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_retval'>retval</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span><span class='id identifier rubyid_j'>j</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_retval'>retval</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_retval'>retval</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_retval'>retval</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_plot'>plot</span>
    <span class='const'>Gnuplot</span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_gp'>gp</span><span class='op'>|</span>
      <span class='const'>Gnuplot</span><span class='op'>::</span><span class='const'>SPlot</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span> <span class='id identifier rubyid_gp'>gp</span> <span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_plot'>plot</span><span class='op'>|</span>
        <span class='id identifier rubyid_plot'>plot</span><span class='period'>.</span><span class='id identifier rubyid_pm3d'>pm3d</span>
        <span class='id identifier rubyid_plot'>plot</span><span class='period'>.</span><span class='id identifier rubyid_hidden3d'>hidden3d</span>
        <span class='id identifier rubyid_plot'>plot</span><span class='period'>.</span><span class='id identifier rubyid_palette'>palette</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>defined (   0 &quot;black&quot;, 51 &quot;blue&quot;, 102 &quot;green&quot;, </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span>
                               <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>153 &quot;yellow&quot;, 204 &quot;red&quot;, 255 &quot;white&quot; )</span><span class='tstring_end'>&#39;</span></span>
        <span class='id identifier rubyid_plot'>plot</span><span class='period'>.</span><span class='id identifier rubyid_data'>data</span> <span class='op'>&lt;&lt;</span> <span class='const'>Gnuplot</span><span class='op'>::</span><span class='const'>DataSet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span> <span class='kw'>self</span> <span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ds'>ds</span><span class='op'>|</span>
          <span class='id identifier rubyid_ds'>ds</span><span class='period'>.</span><span class='id identifier rubyid_with'>with</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>lines</span><span class='tstring_end'>&#39;</span></span>
          <span class='id identifier rubyid_ds'>ds</span><span class='period'>.</span><span class='id identifier rubyid_matrix'>matrix</span> <span class='op'>=</span> <span class='kw'>true</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
<span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_lazy'>lazy</span><span class='lparen'>(</span> <span class='int'>60</span> <span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='lparen'>(</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>+</span> <span class='float'>0.5</span> <span class='op'>-</span> <span class='int'>60</span> <span class='op'>/</span> <span class='int'>2</span> <span class='rparen'>)</span> <span class='op'>/</span> <span class='const'><span class='object_link'><a href="Math.html" title="Math (module)">Math</a></span></span><span class='op'>::</span><span class='const'>PI</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_sinc'>sinc</span> <span class='op'>=</span> <span class='id identifier rubyid_finalise'>finalise</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span><span class='id identifier rubyid_j'>j</span><span class='op'>|</span>
  <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Math.html" title="Math (module)">Math</a></span></span><span class='period'>.</span><span class='id identifier rubyid_hypot'>hypot</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='id identifier rubyid_j'>j</span><span class='rbracket'>]</span>
  <span class='const'><span class='object_link'><a href="Math.html" title="Math (module)">Math</a></span></span><span class='period'>.</span><span class='id identifier rubyid_sin'><span class='object_link'><a href="Math.html#sin-class_method" title="Math.sin (method)">sin</a></span></span><span class='lparen'>(</span> <span class='id identifier rubyid_r'>r</span> <span class='rparen'>)</span> <span class='op'>/</span> <span class='id identifier rubyid_r'>r</span>
<span class='kw'>end</span>
<span class='id identifier rubyid_sinc'>sinc</span><span class='period'>.</span><span class='id identifier rubyid_plot'>plot</span>
</code></pre>

<h2 id="label-Depth+from+Focus">Depth from Focus</h2>

<p><img src="images/stack.png"></p>

<p>This is an implementation of depth of focus. The Sobel gradient magnitude of the focus stack is used as a sharpness measure. An image with extended depth of field is created (deep view). Furthermore a height field is generated. With POVRay the height field and the deep view can be used to generate a 3D rendering.</p>

<p>Note that the <a href="http://trollop.rubyforge.org/">trollop</a> Ruby-extension is required for parsing the command line.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_rmagick</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_xorg</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>trollop</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="Hornetseye.html" title="Hornetseye (module)">Hornetseye</a></span></span>
<span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='const'>Trollop</span><span class='op'>::</span><span class='id identifier rubyid_options'>options</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_banner'>banner</span> <span class='heredoc_beg'>&lt;&lt;EOS</span>
<span class='tstring_content'>Generate height field and deep view from focus stack.

Usage:
       ./depthfromfocus.rb [options] &lt;file names&gt;+

where [options] are:
</span><span class='heredoc_end'>EOS
</span>  <span class='id identifier rubyid_opt'>opt</span> <span class='symbol'>:sigma</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Sigma for Gaussian blur (1/pixelsize)</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbol'>:default</span> <span class='op'>=&gt;</span> <span class='float'>2.5</span>
  <span class='id identifier rubyid_opt'>opt</span> <span class='symbol'>:field</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Output PGM file name for height field</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbol'>:type</span> <span class='op'>=&gt;</span> <span class='const'><span class='object_link'><a href="String.html" title="String (class)">String</a></span></span>
  <span class='id identifier rubyid_opt'>opt</span> <span class='symbol'>:view</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Output PPM file name for deep view</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbol'>:type</span> <span class='op'>=&gt;</span> <span class='const'><span class='object_link'><a href="String.html" title="String (class)">String</a></span></span>
  <span class='id identifier rubyid_opt'>opt</span> <span class='symbol'>:alternative</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Threat later half of filenames as alternative focus </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span>
      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>stack to generate deep view</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span>
<span class='id identifier rubyid_sigma'>sigma</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span> <span class='symbol'>:sigma</span> <span class='rbracket'>]</span>
<span class='const'>Trollop</span><span class='op'>::</span><span class='id identifier rubyid_die'>die</span> <span class='symbol'>:sigma</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>must be greater than zero</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_sigma'>sigma</span> <span class='op'>&gt;</span> <span class='int'>0</span>
<span class='id identifier rubyid_field_file'>field_file</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span> <span class='symbol'>:field</span> <span class='rbracket'>]</span>
<span class='const'>Trollop</span><span class='op'>::</span><span class='id identifier rubyid_die'>die</span> <span class='symbol'>:field</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>is required</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_field_file'>field_file</span>
<span class='id identifier rubyid_view_file'>view_file</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span> <span class='symbol'>:view</span> <span class='rbracket'>]</span>
<span class='const'>Trollop</span><span class='op'>::</span><span class='id identifier rubyid_die'>die</span> <span class='symbol'>:view</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>is required</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_view_file'>view_file</span>
<span class='id identifier rubyid_alternative'>alternative</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span> <span class='symbol'>:alternative</span> <span class='rbracket'>]</span>
<span class='kw'>if</span> <span class='id identifier rubyid_alternative'>alternative</span>
  <span class='kw'>if</span> <span class='const'>ARGV</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>%</span> <span class='int'>2</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='const'>Trollop</span><span class='op'>::</span><span class='id identifier rubyid_die'>die</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Even number of file names required when using alternative </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span>
      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>focus stack</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_n'>n</span> <span class='op'>=</span> <span class='const'>ARGV</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>/</span> <span class='int'>2</span>
  <span class='id identifier rubyid_stack_file'>stack_file</span> <span class='op'>=</span> <span class='const'>ARGV</span><span class='period'>.</span><span class='id identifier rubyid_slice!'>slice!</span> <span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_n'>n</span>
  <span class='id identifier rubyid_alternative_file'>alternative_file</span> <span class='op'>=</span> <span class='const'>ARGV</span><span class='period'>.</span><span class='id identifier rubyid_slice!'>slice!</span> <span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_n'>n</span>
<span class='kw'>else</span>
  <span class='id identifier rubyid_stack_file'>stack_file</span> <span class='op'>=</span> <span class='const'>ARGV</span>
  <span class='id identifier rubyid_alternative_file'>alternative_file</span> <span class='op'>=</span> <span class='kw'>nil</span>
<span class='kw'>end</span>
<span class='const'>Trollop</span><span class='op'>::</span><span class='id identifier rubyid_die'>die</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Cannot handle more than 255 files</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_stack_file'>stack_file</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;</span> <span class='int'>255</span>
<span class='id identifier rubyid_display'>display</span> <span class='op'>=</span> <span class='const'>X11Display</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='id identifier rubyid_field_output'>field_output</span> <span class='op'>=</span> <span class='const'>XImageOutput</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='id identifier rubyid_view_output'>view_output</span> <span class='op'>=</span> <span class='const'>XImageOutput</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='id identifier rubyid_field_window'>field_window</span> <span class='op'>=</span> <span class='const'>X11Window</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_display'>display</span><span class='comma'>,</span> <span class='id identifier rubyid_field_output'>field_output</span><span class='comma'>,</span> <span class='int'>320</span><span class='comma'>,</span> <span class='int'>240</span>
<span class='id identifier rubyid_view_window'>view_window</span> <span class='op'>=</span> <span class='const'>X11Window</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_display'>display</span><span class='comma'>,</span> <span class='id identifier rubyid_view_output'>view_output</span><span class='comma'>,</span> <span class='int'>320</span><span class='comma'>,</span> <span class='int'>240</span>
<span class='id identifier rubyid_field'>field</span><span class='comma'>,</span> <span class='id identifier rubyid_view'>view</span><span class='comma'>,</span> <span class='id identifier rubyid_max_sharpness'>max_sharpness</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>nil</span>
<span class='id identifier rubyid_stack_file'>stack_file</span><span class='period'>.</span><span class='id identifier rubyid_each_with_index'>each_with_index</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_f_name'>f_name</span><span class='comma'>,</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
  <span class='id identifier rubyid_img'>img</span> <span class='op'>=</span> <span class='const'>MultiArray</span><span class='period'>.</span><span class='id identifier rubyid_load_ubytergb'>load_ubytergb</span> <span class='id identifier rubyid_f_name'>f_name</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_field'>field</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_shape'>shape</span> <span class='op'>!=</span> <span class='id identifier rubyid_field'>field</span><span class='period'>.</span><span class='id identifier rubyid_shape'>shape</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Image &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_f_name'>f_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; must be of size </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_field'>field</span><span class='period'>.</span><span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>x</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_field'>field</span><span class='period'>.</span><span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> (but was </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>x</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_field'>field</span> <span class='op'>=</span> <span class='const'>MultiArray</span><span class='period'>.</span><span class='id identifier rubyid_ubyte'>ubyte</span><span class='lparen'>(</span> <span class='op'>*</span><span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_shape'>shape</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_fill!'>fill!</span>
    <span class='id identifier rubyid_view'>view</span> <span class='op'>=</span> <span class='const'>MultiArray</span><span class='period'>.</span><span class='id identifier rubyid_ubytergb'>ubytergb</span><span class='lparen'>(</span> <span class='op'>*</span><span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_shape'>shape</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_fill!'>fill!</span>
    <span class='id identifier rubyid_max_sharpness'>max_sharpness</span> <span class='op'>=</span> <span class='const'>MultiArray</span><span class='period'>.</span><span class='id identifier rubyid_dfloat'>dfloat</span><span class='lparen'>(</span> <span class='op'>*</span><span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_shape'>shape</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_fill!'>fill!</span>
    <span class='id identifier rubyid_field_window'>field_window</span><span class='period'>.</span><span class='id identifier rubyid_resize'>resize</span> <span class='op'>*</span><span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_shape'>shape</span>
    <span class='id identifier rubyid_view_window'>view_window</span><span class='period'>.</span><span class='id identifier rubyid_resize'>resize</span> <span class='op'>*</span><span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_shape'>shape</span>
    <span class='id identifier rubyid_field_window'>field_window</span><span class='period'>.</span><span class='id identifier rubyid_show'>show</span>
    <span class='id identifier rubyid_view_window'>view_window</span><span class='period'>.</span><span class='id identifier rubyid_show'>show</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_sharpness'>sharpness</span> <span class='op'>=</span> <span class='lparen'>(</span> <span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_sobel'>sobel</span><span class='lparen'>(</span> <span class='int'>0</span> <span class='rparen'>)</span> <span class='op'>**</span> <span class='int'>2</span> <span class='op'>+</span>
                <span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_sobel'>sobel</span><span class='lparen'>(</span> <span class='int'>1</span> <span class='rparen'>)</span> <span class='op'>**</span> <span class='int'>2</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_dfloat'>to_dfloat</span><span class='period'>.</span><span class='id identifier rubyid_gauss_blur'>gauss_blur</span> <span class='id identifier rubyid_sigma'>sigma</span>
  <span class='id identifier rubyid_mask'>mask</span> <span class='op'>=</span> <span class='id identifier rubyid_sharpness'>sharpness</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_max_sharpness'>max_sharpness</span>
  <span class='id identifier rubyid_field'>field</span> <span class='op'>=</span> <span class='id identifier rubyid_mask'>mask</span><span class='period'>.</span><span class='id identifier rubyid_conditional'>conditional</span> <span class='id identifier rubyid_i'>i</span><span class='comma'>,</span> <span class='id identifier rubyid_field'>field</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_alternative'>alternative</span>
    <span class='id identifier rubyid_alternative_img'>alternative_img</span> <span class='op'>=</span> <span class='const'>MultiArray</span><span class='period'>.</span><span class='id identifier rubyid_load_ubytergb'>load_ubytergb</span> <span class='id identifier rubyid_alternative_file'>alternative_file</span><span class='lbracket'>[</span> <span class='id identifier rubyid_i'>i</span> <span class='rbracket'>]</span>
    <span class='id identifier rubyid_view'>view</span> <span class='op'>=</span> <span class='id identifier rubyid_mask'>mask</span><span class='period'>.</span><span class='id identifier rubyid_conditional'>conditional</span> <span class='id identifier rubyid_alternative_img'>alternative_img</span><span class='comma'>,</span> <span class='id identifier rubyid_view'>view</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_view'>view</span> <span class='op'>=</span> <span class='id identifier rubyid_mask'>mask</span><span class='period'>.</span><span class='id identifier rubyid_conditional'>conditional</span> <span class='id identifier rubyid_img'>img</span><span class='comma'>,</span> <span class='id identifier rubyid_view'>view</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_max_sharpness'>max_sharpness</span> <span class='op'>=</span> <span class='id identifier rubyid_mask'>mask</span><span class='period'>.</span><span class='id identifier rubyid_conditional'>conditional</span> <span class='id identifier rubyid_sharpness'>sharpness</span><span class='comma'>,</span> <span class='id identifier rubyid_max_sharpness'>max_sharpness</span>
  <span class='id identifier rubyid_progress'>progress</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%3d</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_i'>i</span> <span class='embexpr_end'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%3d</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_stack_file'>stack_file</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_field_window'>field_window</span><span class='period'>.</span><span class='id identifier rubyid_title'>title</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Height field (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_progress'>progress</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_view_window'>view_window</span><span class='period'>.</span><span class='id identifier rubyid_title'>title</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Deep view (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_progress'>progress</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_field_output'>field_output</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span> <span class='id identifier rubyid_field'>field</span> <span class='op'>*</span> <span class='lparen'>(</span> <span class='float'>255.0</span> <span class='op'>/</span> <span class='id identifier rubyid_stack_file'>stack_file</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='rparen'>)</span>
  <span class='id identifier rubyid_view_output'>view_output</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span> <span class='id identifier rubyid_view'>view</span>
  <span class='id identifier rubyid_display'>display</span><span class='period'>.</span><span class='id identifier rubyid_process_events'>process_events</span>
<span class='kw'>end</span>
<span class='id identifier rubyid_field'>field</span><span class='period'>.</span><span class='id identifier rubyid_save_ubyte'>save_ubyte</span> <span class='id identifier rubyid_field_file'>field_file</span>
<span class='id identifier rubyid_view'>view</span><span class='period'>.</span><span class='id identifier rubyid_save_ubytergb'>save_ubytergb</span> <span class='id identifier rubyid_view_file'>view_file</span>
<span class='id identifier rubyid_field_window'>field_window</span><span class='period'>.</span><span class='id identifier rubyid_title'>title</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Height field</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_view_window'>view_window</span><span class='period'>.</span><span class='id identifier rubyid_title'>title</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Deep view</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_display'>display</span><span class='period'>.</span><span class='id identifier rubyid_event_loop'>event_loop</span>
</code></pre>

<h2 id="label-Line+Fit">Line Fit</h2>

<p><img src="images/fit.png"></p>

<p>This program fits a line assuming that the input image is showing a single white line without outliers. The problem of ambiguity with the orientation of the line is overcome by estimating 2*a instead of the angle a.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_rmagick</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_xorg</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="Hornetseye.html" title="Hornetseye (module)">Hornetseye</a></span></span>
<span class='kw'>class</span> <span class='const'>MultiArray</span>
  <span class='kw'>class</span> <span class='op'>&lt;&lt;</span> <span class='kw'>self</span>
    <span class='kw'>def</span> <span class='id identifier rubyid_cramp'>cramp</span><span class='lparen'>(</span> <span class='id identifier rubyid_w'>w</span><span class='comma'>,</span> <span class='id identifier rubyid_h'>h</span> <span class='rparen'>)</span>
      <span class='id identifier rubyid_lazy'>lazy</span><span class='lparen'>(</span> <span class='id identifier rubyid_w'>w</span><span class='comma'>,</span> <span class='id identifier rubyid_h'>h</span> <span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span><span class='id identifier rubyid_j'>j</span><span class='op'>|</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>+</span> <span class='const'><span class='object_link'><a href="Complex.html" title="Complex (class)">Complex</a></span></span><span class='op'>::</span><span class='const'>I</span> <span class='op'>*</span> <span class='id identifier rubyid_j'>j</span> <span class='rbrace'>}</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
<span class='id identifier rubyid_img'>img</span> <span class='op'>=</span> <span class='const'>MultiArray</span><span class='period'>.</span><span class='id identifier rubyid_load_ubyte'>load_ubyte</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>http://www.wedesoft.de/hornetseye-api/images/line.png</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_x'>x</span> <span class='op'>=</span> <span class='const'>MultiArray</span><span class='period'>.</span><span class='id identifier rubyid_cramp'>cramp</span><span class='lparen'>(</span> <span class='op'>*</span><span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_shape'>shape</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_mask'>mask</span> <span class='id identifier rubyid_img'>img</span> <span class='op'>&gt;=</span> <span class='int'>128</span>
<span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_sum'>sum</span> <span class='op'>/</span> <span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span>
<span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Math.html" title="Math (module)">Math</a></span></span><span class='period'>.</span><span class='id identifier rubyid_sqrt'><span class='object_link'><a href="Math.html#sqrt-class_method" title="Math.sqrt (method)">sqrt</a></span></span><span class='lparen'>(</span> <span class='lparen'>(</span> <span class='lparen'>(</span> <span class='id identifier rubyid_x'>x</span> <span class='op'>-</span> <span class='id identifier rubyid_c'>c</span> <span class='rparen'>)</span> <span class='op'>**</span> <span class='int'>2</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_sum'>sum</span> <span class='op'>/</span> <span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='rparen'>)</span>
<span class='id identifier rubyid_gc'>gc</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Magick.html" title="Magick (module)">Magick</a></span></span><span class='op'>::</span><span class='const'>Draw</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='id identifier rubyid_gc'>gc</span><span class='period'>.</span><span class='id identifier rubyid_stroke'>stroke</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>red</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_gc'>gc</span><span class='period'>.</span><span class='id identifier rubyid_stroke_width'>stroke_width</span> <span class='int'>1</span>
<span class='id identifier rubyid_gc'>gc</span><span class='period'>.</span><span class='id identifier rubyid_line'>line</span><span class='lparen'>(</span> <span class='lparen'>(</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>-</span> <span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_a'>a</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_real'>real</span><span class='comma'>,</span> <span class='lparen'>(</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>-</span> <span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_a'>a</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_imag'>imag</span><span class='comma'>,</span>
         <span class='lparen'>(</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>+</span> <span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_a'>a</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_real'>real</span><span class='comma'>,</span> <span class='lparen'>(</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>+</span> <span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_a'>a</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_imag'>imag</span> <span class='rparen'>)</span>
<span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_to_ubytergb'>to_ubytergb</span><span class='period'>.</span><span class='id identifier rubyid_to_magick'>to_magick</span>
<span class='id identifier rubyid_gc'>gc</span><span class='period'>.</span><span class='id identifier rubyid_draw'>draw</span> <span class='id identifier rubyid_result'>result</span>
<span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_to_ubytergb'>to_ubytergb</span><span class='period'>.</span><span class='id identifier rubyid_show'>show</span>
</code></pre>

<h2 id="label-Hough+Transform">Hough Transform</h2>

<p><img src="images/hough.png"></p>

<p>The following example detects white lines in a black-and-white image using a Hough transform.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>multiarray</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_rmagick</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_xorg</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="Hornetseye.html" title="Hornetseye (module)">Hornetseye</a></span></span>
<span class='kw'>class</span> <span class='const'>Node</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_nms'>nms</span><span class='lparen'>(</span> <span class='id identifier rubyid_threshold'>threshold</span> <span class='op'>=</span> <span class='int'>0</span> <span class='rparen'>)</span>
    <span class='id identifier rubyid_finalise'>finalise</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_dilate'>dilate</span><span class='period'>.</span><span class='id identifier rubyid_major'>major</span><span class='lparen'>(</span> <span class='id identifier rubyid_threshold'>threshold</span> <span class='rparen'>)</span> <span class='op'>&lt;=</span> <span class='kw'>self</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
<span class='const'>A_RANGE</span> <span class='op'>=</span> <span class='int'>0</span> <span class='op'>..</span> <span class='int'>179</span>
<span class='const'>THRESHOLD</span> <span class='op'>=</span> <span class='int'>128</span>
<span class='id identifier rubyid_img'>img</span> <span class='op'>=</span> <span class='const'>MultiArray</span><span class='period'>.</span><span class='id identifier rubyid_load_ubyte'>load_ubyte</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>http://www.wedesoft.de/hornetseye-api/images/lines.png</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_diag'>diag</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Math.html" title="Math (module)">Math</a></span></span><span class='period'>.</span><span class='id identifier rubyid_sqrt'><span class='object_link'><a href="Math.html#sqrt-class_method" title="Math.sqrt (method)">sqrt</a></span></span><span class='lparen'>(</span> <span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_width'>width</span> <span class='op'>**</span> <span class='int'>2</span> <span class='op'>+</span> <span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_height'>height</span> <span class='op'>**</span> <span class='int'>2</span> <span class='rparen'>)</span>
<span class='id identifier rubyid_d_range'>d_range</span> <span class='op'>=</span> <span class='op'>-</span><span class='lparen'>(</span> <span class='id identifier rubyid_diag'>diag</span> <span class='op'>+</span> <span class='int'>1</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_div'>div</span><span class='lparen'>(</span> <span class='int'>2</span> <span class='rparen'>)</span> <span class='op'>...</span> <span class='lparen'>(</span> <span class='id identifier rubyid_diag'>diag</span> <span class='op'>+</span> <span class='int'>1</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_div'>div</span><span class='lparen'>(</span> <span class='int'>2</span> <span class='rparen'>)</span>
<span class='id identifier rubyid_binary'>binary</span> <span class='op'>=</span> <span class='id identifier rubyid_img'>img</span> <span class='op'>&gt;=</span> <span class='const'>THRESHOLD</span>
<span class='id identifier rubyid_x'>x</span> <span class='op'>=</span> <span class='id identifier rubyid_lazy'>lazy</span><span class='lparen'>(</span> <span class='op'>*</span><span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_shape'>shape</span> <span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span><span class='id identifier rubyid_j'>j</span><span class='op'>|</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>-</span> <span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_width'>width</span>  <span class='op'>/</span> <span class='int'>2</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_mask'>mask</span> <span class='id identifier rubyid_binary'>binary</span>
<span class='id identifier rubyid_y'>y</span> <span class='op'>=</span> <span class='id identifier rubyid_lazy'>lazy</span><span class='lparen'>(</span> <span class='op'>*</span><span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_shape'>shape</span> <span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span><span class='id identifier rubyid_j'>j</span><span class='op'>|</span> <span class='id identifier rubyid_j'>j</span> <span class='op'>-</span> <span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_height'>height</span> <span class='op'>/</span> <span class='int'>2</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_mask'>mask</span> <span class='id identifier rubyid_binary'>binary</span>
<span class='id identifier rubyid_idx'>idx</span> <span class='op'>=</span> <span class='id identifier rubyid_lazy'>lazy</span><span class='lparen'>(</span> <span class='const'>A_RANGE</span><span class='period'>.</span><span class='id identifier rubyid_end'>end</span> <span class='op'>+</span> <span class='int'>1</span> <span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='id identifier rubyid_i'>i</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_angle'>angle</span> <span class='op'>=</span> <span class='id identifier rubyid_lazy'>lazy</span> <span class='lbrace'>{</span> <span class='const'><span class='object_link'><a href="Math.html" title="Math (module)">Math</a></span></span><span class='op'>::</span><span class='const'>PI</span> <span class='op'>*</span> <span class='id identifier rubyid_idx'>idx</span> <span class='op'>/</span> <span class='const'>A_RANGE</span><span class='period'>.</span><span class='id identifier rubyid_end'>end</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_dist'>dist</span> <span class='op'>=</span> <span class='id identifier rubyid_lazy'>lazy</span><span class='lparen'>(</span> <span class='id identifier rubyid_d_range'>d_range</span><span class='period'>.</span><span class='id identifier rubyid_end'>end</span> <span class='op'>+</span> <span class='int'>1</span> <span class='op'>-</span> <span class='id identifier rubyid_d_range'>d_range</span><span class='period'>.</span><span class='id identifier rubyid_begin'>begin</span> <span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>+</span> <span class='id identifier rubyid_d_range'>d_range</span><span class='period'>.</span><span class='id identifier rubyid_begin'>begin</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_cos'>cos</span><span class='comma'>,</span> <span class='id identifier rubyid_sin'>sin</span> <span class='op'>=</span> <span class='id identifier rubyid_lazy'>lazy</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='const'><span class='object_link'><a href="Math.html" title="Math (module)">Math</a></span></span><span class='period'>.</span><span class='id identifier rubyid_cos'><span class='object_link'><a href="Math.html#cos-class_method" title="Math.cos (method)">cos</a></span></span><span class='lparen'>(</span> <span class='id identifier rubyid_angle'>angle</span><span class='lbracket'>[</span> <span class='id identifier rubyid_i'>i</span> <span class='rbracket'>]</span> <span class='rparen'>)</span> <span class='rbrace'>}</span><span class='comma'>,</span> <span class='id identifier rubyid_lazy'>lazy</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='const'><span class='object_link'><a href="Math.html" title="Math (module)">Math</a></span></span><span class='period'>.</span><span class='id identifier rubyid_sin'><span class='object_link'><a href="Math.html#sin-class_method" title="Math.sin (method)">sin</a></span></span><span class='lparen'>(</span> <span class='id identifier rubyid_angle'>angle</span><span class='lbracket'>[</span> <span class='id identifier rubyid_i'>i</span> <span class='rbracket'>]</span> <span class='rparen'>)</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='id identifier rubyid_lazy'>lazy</span><span class='lparen'>(</span> <span class='id identifier rubyid_angle'>angle</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='comma'>,</span> <span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span><span class='id identifier rubyid_j'>j</span><span class='op'>|</span> <span class='id identifier rubyid_i'>i</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_d'>d</span> <span class='op'>=</span> <span class='id identifier rubyid_lazy'>lazy</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span><span class='id identifier rubyid_j'>j</span><span class='op'>|</span> <span class='lparen'>(</span> <span class='id identifier rubyid_x'>x</span><span class='lbracket'>[</span><span class='id identifier rubyid_j'>j</span><span class='rbracket'>]</span> <span class='op'>*</span> <span class='id identifier rubyid_cos'>cos</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='id identifier rubyid_y'>y</span><span class='lbracket'>[</span><span class='id identifier rubyid_j'>j</span><span class='rbracket'>]</span> <span class='op'>*</span> <span class='id identifier rubyid_sin'>sin</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span> <span class='op'>-</span> <span class='id identifier rubyid_d_range'>d_range</span><span class='period'>.</span><span class='id identifier rubyid_begin'>begin</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_int'>to_int</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_histogram'>histogram</span> <span class='op'>=</span> <span class='lbracket'>[</span> <span class='id identifier rubyid_a'>a</span><span class='comma'>,</span> <span class='id identifier rubyid_d'>d</span> <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_histogram'>histogram</span> <span class='const'>A_RANGE</span><span class='period'>.</span><span class='id identifier rubyid_end'>end</span> <span class='op'>+</span> <span class='int'>1</span><span class='comma'>,</span> <span class='id identifier rubyid_d_range'>d_range</span><span class='period'>.</span><span class='id identifier rubyid_end'>end</span> <span class='op'>+</span> <span class='int'>1</span> <span class='op'>-</span> <span class='id identifier rubyid_d_range'>d_range</span><span class='period'>.</span><span class='id identifier rubyid_begin'>begin</span>
<span class='id identifier rubyid_peaks'>peaks</span> <span class='op'>=</span> <span class='id identifier rubyid_histogram'>histogram</span><span class='period'>.</span><span class='id identifier rubyid_nms'>nms</span> <span class='int'>40</span>
<span class='id identifier rubyid_peaks'>peaks</span><span class='period'>.</span><span class='id identifier rubyid_conditional'>conditional</span><span class='lparen'>(</span> <span class='const'>RGB</span><span class='lparen'>(</span> <span class='int'>255</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_histogram'>histogram</span><span class='period'>.</span><span class='id identifier rubyid_normalise'>normalise</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_show'>show</span>
<span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='id identifier rubyid_lazy'>lazy</span><span class='lparen'>(</span> <span class='id identifier rubyid_d_range'>d_range</span><span class='period'>.</span><span class='id identifier rubyid_end'>end</span> <span class='op'>+</span> <span class='int'>1</span> <span class='op'>-</span> <span class='id identifier rubyid_d_range'>d_range</span><span class='period'>.</span><span class='id identifier rubyid_begin'>begin</span> <span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_j'>j</span><span class='op'>|</span> <span class='id identifier rubyid_angle'>angle</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_mask'>mask</span> <span class='id identifier rubyid_peaks'>peaks</span>
<span class='id identifier rubyid_d'>d</span> <span class='op'>=</span> <span class='id identifier rubyid_lazy'>lazy</span><span class='lparen'>(</span> <span class='const'>A_RANGE</span><span class='period'>.</span><span class='id identifier rubyid_end'>end</span> <span class='op'>+</span> <span class='int'>1</span> <span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='id identifier rubyid_dist'>dist</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_roll'>roll</span><span class='period'>.</span><span class='id identifier rubyid_mask'>mask</span> <span class='id identifier rubyid_peaks'>peaks</span>
<span class='id identifier rubyid_x'>x</span> <span class='op'>=</span> <span class='id identifier rubyid_lazy'>lazy</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span><span class='id identifier rubyid_j'>j</span><span class='op'>|</span> <span class='lparen'>(</span> <span class='const'><span class='object_link'><a href="Math.html" title="Math (module)">Math</a></span></span><span class='period'>.</span><span class='id identifier rubyid_cos'><span class='object_link'><a href="Math.html#cos-class_method" title="Math.cos (method)">cos</a></span></span><span class='lparen'>(</span> <span class='id identifier rubyid_a'>a</span><span class='lbracket'>[</span><span class='id identifier rubyid_j'>j</span><span class='rbracket'>]</span> <span class='rparen'>)</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span><span class='lbracket'>[</span><span class='id identifier rubyid_j'>j</span><span class='rbracket'>]</span> <span class='op'>-</span> <span class='const'><span class='object_link'><a href="Math.html" title="Math (module)">Math</a></span></span><span class='period'>.</span><span class='id identifier rubyid_sin'><span class='object_link'><a href="Math.html#sin-class_method" title="Math.sin (method)">sin</a></span></span><span class='lparen'>(</span> <span class='id identifier rubyid_a'>a</span><span class='lbracket'>[</span><span class='id identifier rubyid_j'>j</span><span class='rbracket'>]</span> <span class='rparen'>)</span> <span class='op'>*</span> <span class='id identifier rubyid_dist'>dist</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_width'>width</span>  <span class='op'>/</span> <span class='int'>2</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_int'>to_int</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_y'>y</span> <span class='op'>=</span> <span class='id identifier rubyid_lazy'>lazy</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span><span class='id identifier rubyid_j'>j</span><span class='op'>|</span> <span class='lparen'>(</span> <span class='const'><span class='object_link'><a href="Math.html" title="Math (module)">Math</a></span></span><span class='period'>.</span><span class='id identifier rubyid_sin'><span class='object_link'><a href="Math.html#sin-class_method" title="Math.sin (method)">sin</a></span></span><span class='lparen'>(</span> <span class='id identifier rubyid_a'>a</span><span class='lbracket'>[</span><span class='id identifier rubyid_j'>j</span><span class='rbracket'>]</span> <span class='rparen'>)</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span><span class='lbracket'>[</span><span class='id identifier rubyid_j'>j</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='const'><span class='object_link'><a href="Math.html" title="Math (module)">Math</a></span></span><span class='period'>.</span><span class='id identifier rubyid_cos'><span class='object_link'><a href="Math.html#cos-class_method" title="Math.cos (method)">cos</a></span></span><span class='lparen'>(</span> <span class='id identifier rubyid_a'>a</span><span class='lbracket'>[</span><span class='id identifier rubyid_j'>j</span><span class='rbracket'>]</span> <span class='rparen'>)</span> <span class='op'>*</span> <span class='id identifier rubyid_dist'>dist</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_height'>height</span> <span class='op'>/</span> <span class='int'>2</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_int'>to_int</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='id identifier rubyid_lazy'>lazy</span> <span class='lbrace'>{</span> <span class='lparen'>(</span> <span class='id identifier rubyid_x'>x</span> <span class='op'>&gt;=</span> <span class='int'>0</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_and'>and</span><span class='lparen'>(</span> <span class='id identifier rubyid_x'>x</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_and'>and</span><span class='lparen'>(</span> <span class='id identifier rubyid_y'>y</span> <span class='op'>&gt;=</span> <span class='int'>0</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_and'>and</span><span class='lparen'>(</span> <span class='id identifier rubyid_y'>y</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='rparen'>)</span> <span class='rbrace'>}</span>
<span class='lparen'>(</span> <span class='lbracket'>[</span> <span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_mask'>mask</span><span class='lparen'>(</span> <span class='id identifier rubyid_m'>m</span> <span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_y'>y</span><span class='period'>.</span><span class='id identifier rubyid_mask'>mask</span><span class='lparen'>(</span> <span class='id identifier rubyid_m'>m</span> <span class='rparen'>)</span> <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_histogram'>histogram</span><span class='lparen'>(</span> <span class='op'>*</span><span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_shape'>shape</span> <span class='rparen'>)</span> <span class='op'>&gt;</span> <span class='int'>0</span> <span class='rparen'>)</span><span class='period'>.</span>
  <span class='id identifier rubyid_conditional'>conditional</span><span class='lparen'>(</span> <span class='const'>RGB</span><span class='lparen'>(</span> <span class='int'>255</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_img'>img</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_show'>show</span>
</code></pre>

<h2 id="label-PCA+Recognition">PCA Recognition</h2>

<p><img src="images/pca.jpg"></p>

<p>The example program performs two-dimensional object recognition with three degrees of freedom. This is a customised algorithm which only works on images showing a single object which can be detected using colour-segmentation. In a controlled environment however this algorithm can be very useful as it is easy to implement. This algorithm has become popular recently in the context of touchless interfaces.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>matrix</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_rmagick</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_v4l2</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_qt4</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="Hornetseye.html" title="Hornetseye (module)">Hornetseye</a></span></span>
<span class='kw'>class</span> <span class='const'>Node</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_rgbabs'>rgbabs</span>
    <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span> <span class='op'>+</span> <span class='id identifier rubyid_g'>g</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span> <span class='op'>+</span> <span class='id identifier rubyid_b'>b</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
<span class='kw'>class</span> <span class='const'>PCAWindow</span> <span class='op'>&lt;</span> <span class='const'>Qt</span><span class='op'>::</span><span class='const'>Widget</span>
  <span class='const'>SIZE2</span> <span class='op'>=</span> <span class='int'>20</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>
    <span class='kw'>super</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_windowTitle'>windowTitle</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>PCA Recognition</span><span class='tstring_end'>&quot;</span></span>
    <span class='ivar'>@xvideo</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Hornetseye.html" title="Hornetseye (module)">Hornetseye</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Hornetseye/XvWidget.html" title="Hornetseye::XvWidget (class)">XvWidget</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Hornetseye/XvWidget.html#initialize-instance_method" title="Hornetseye::XvWidget#initialize (method)">new</a></span></span> <span class='kw'>self</span>
    <span class='ivar'>@slider</span> <span class='op'>=</span> <span class='const'>Qt</span><span class='op'>::</span><span class='const'>Slider</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='const'>Qt</span><span class='op'>::</span><span class='const'>Horizontal</span>
    <span class='ivar'>@checkbox</span> <span class='op'>=</span> <span class='const'>Qt</span><span class='op'>::</span><span class='const'>CheckBox</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&amp;Freeze Reference</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='kw'>self</span>
    <span class='ivar'>@slider</span><span class='period'>.</span><span class='id identifier rubyid_minimum'>minimum</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='ivar'>@slider</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='int'>32</span>
    <span class='ivar'>@slider</span><span class='period'>.</span><span class='id identifier rubyid_maximum'>maximum</span> <span class='op'>=</span> <span class='int'>128</span>
    <span class='id identifier rubyid_layout'>layout</span> <span class='op'>=</span> <span class='const'>Qt</span><span class='op'>::</span><span class='const'>VBoxLayout</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='kw'>self</span>
    <span class='id identifier rubyid_layout'>layout</span><span class='period'>.</span><span class='id identifier rubyid_addWidget'>addWidget</span> <span class='ivar'>@xvideo</span>
    <span class='id identifier rubyid_hlayout'>hlayout</span> <span class='op'>=</span> <span class='const'>Qt</span><span class='op'>::</span><span class='const'>HBoxLayout</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='id identifier rubyid_hlayout'>hlayout</span><span class='period'>.</span><span class='id identifier rubyid_addWidget'>addWidget</span> <span class='ivar'>@slider</span>
    <span class='id identifier rubyid_hlayout'>hlayout</span><span class='period'>.</span><span class='id identifier rubyid_addWidget'>addWidget</span> <span class='ivar'>@checkbox</span>
    <span class='id identifier rubyid_layout'>layout</span><span class='period'>.</span><span class='id identifier rubyid_addLayout'>addLayout</span> <span class='id identifier rubyid_hlayout'>hlayout</span>
    <span class='ivar'>@input</span> <span class='op'>=</span> <span class='const'>V4L2Input</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='ivar'>@w</span><span class='comma'>,</span> <span class='ivar'>@h</span> <span class='op'>=</span> <span class='ivar'>@input</span><span class='period'>.</span><span class='id identifier rubyid_width'>width</span><span class='comma'>,</span> <span class='ivar'>@input</span><span class='period'>.</span><span class='id identifier rubyid_height'>height</span>
    <span class='id identifier rubyid_resize'>resize</span> <span class='ivar'>@w</span><span class='comma'>,</span> <span class='ivar'>@h</span>
    <span class='ivar'>@reference</span> <span class='op'>=</span> <span class='const'>RGB</span> <span class='int'>128</span><span class='comma'>,</span> <span class='int'>128</span><span class='comma'>,</span> <span class='int'>128</span>
    <span class='ivar'>@x</span><span class='comma'>,</span> <span class='ivar'>@y</span> <span class='op'>=</span> <span class='id identifier rubyid_lazy'>lazy</span><span class='lparen'>(</span> <span class='ivar'>@w</span><span class='comma'>,</span> <span class='ivar'>@h</span> <span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span><span class='id identifier rubyid_j'>j</span><span class='op'>|</span> <span class='id identifier rubyid_i'>i</span> <span class='rbrace'>}</span><span class='comma'>,</span> <span class='id identifier rubyid_lazy'>lazy</span><span class='lparen'>(</span> <span class='ivar'>@w</span><span class='comma'>,</span> <span class='ivar'>@h</span> <span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span><span class='id identifier rubyid_j'>j</span><span class='op'>|</span> <span class='id identifier rubyid_j'>j</span> <span class='rbrace'>}</span>
    <span class='ivar'>@xx</span><span class='comma'>,</span> <span class='ivar'>@yy</span><span class='comma'>,</span> <span class='ivar'>@xy</span> <span class='op'>=</span> <span class='ivar'>@x</span> <span class='op'>**</span> <span class='int'>2</span><span class='comma'>,</span> <span class='ivar'>@y</span> <span class='op'>**</span> <span class='int'>2</span><span class='comma'>,</span> <span class='ivar'>@x</span> <span class='op'>*</span> <span class='ivar'>@y</span>
    <span class='ivar'>@old_eigenvector</span> <span class='op'>=</span> <span class='const'>Vector</span><span class='lbracket'>[</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rbracket'>]</span>
    <span class='id identifier rubyid_startTimer'>startTimer</span> <span class='int'>0</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_timerEvent'>timerEvent</span><span class='lparen'>(</span> <span class='id identifier rubyid_e'>e</span> <span class='rparen'>)</span>
    <span class='id identifier rubyid_img'>img</span> <span class='op'>=</span> <span class='ivar'>@input</span><span class='period'>.</span><span class='id identifier rubyid_read_ubytergb'>read_ubytergb</span>
    <span class='kw'>if</span> <span class='kw'>not</span> <span class='ivar'>@checkbox</span><span class='period'>.</span><span class='id identifier rubyid_checked?'>checked?</span>
      <span class='id identifier rubyid_box'>box</span> <span class='op'>=</span> <span class='lbracket'>[</span> <span class='lparen'>(</span> <span class='ivar'>@w</span> <span class='op'>/</span> <span class='int'>2</span> <span class='op'>-</span> <span class='const'>SIZE2</span> <span class='rparen'>)</span><span class='op'>...</span><span class='lparen'>(</span> <span class='ivar'>@w</span> <span class='op'>/</span> <span class='int'>2</span> <span class='op'>+</span> <span class='const'>SIZE2</span> <span class='rparen'>)</span><span class='comma'>,</span>
              <span class='lparen'>(</span> <span class='ivar'>@h</span> <span class='op'>/</span> <span class='int'>2</span> <span class='op'>-</span> <span class='const'>SIZE2</span> <span class='rparen'>)</span><span class='op'>...</span><span class='lparen'>(</span> <span class='ivar'>@h</span> <span class='op'>/</span> <span class='int'>2</span> <span class='op'>+</span> <span class='const'>SIZE2</span> <span class='rparen'>)</span> <span class='rbracket'>]</span>
      <span class='id identifier rubyid_area'>area</span> <span class='op'>=</span> <span class='id identifier rubyid_img'>img</span><span class='lbracket'>[</span> <span class='op'>*</span><span class='id identifier rubyid_box'>box</span> <span class='rbracket'>]</span>
      <span class='ivar'>@reference</span> <span class='op'>=</span> <span class='id identifier rubyid_area'>area</span><span class='period'>.</span><span class='id identifier rubyid_sum'>sum</span> <span class='op'>/</span> <span class='id identifier rubyid_area'>area</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span>
    <span class='kw'>else</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_mask'>mask</span> <span class='op'>=</span> <span class='lparen'>(</span> <span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_to_sintrgb'>to_sintrgb</span> <span class='op'>-</span> <span class='ivar'>@reference</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_rgbabs'>rgbabs</span> <span class='op'>&lt;</span> <span class='ivar'>@slider</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span>
    <span class='id identifier rubyid_img'>img</span> <span class='op'>=</span> <span class='id identifier rubyid_mask'>mask</span><span class='period'>.</span><span class='id identifier rubyid_conditional'>conditional</span> <span class='ivar'>@reference</span> <span class='op'>/</span> <span class='int'>2</span> <span class='op'>+</span> <span class='const'>RGB</span><span class='lparen'>(</span> <span class='int'>128</span><span class='comma'>,</span> <span class='int'>128</span><span class='comma'>,</span> <span class='int'>128</span> <span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_img'>img</span>
    <span class='kw'>if</span> <span class='kw'>not</span> <span class='ivar'>@checkbox</span><span class='period'>.</span><span class='id identifier rubyid_checked?'>checked?</span>
      <span class='id identifier rubyid_img'>img</span><span class='lbracket'>[</span> <span class='op'>*</span><span class='id identifier rubyid_box'>box</span> <span class='rbracket'>]</span> <span class='op'>=</span> <span class='int'>255</span> <span class='op'>-</span> <span class='id identifier rubyid_area'>area</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_n'>n</span> <span class='op'>=</span> <span class='id identifier rubyid_mask'>mask</span><span class='period'>.</span><span class='id identifier rubyid_to_ubyte'>to_ubyte</span><span class='period'>.</span><span class='id identifier rubyid_sum'>sum</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_n'>n</span> <span class='op'>&gt;</span> <span class='int'>0</span>
        <span class='id identifier rubyid_sum'>sum</span> <span class='op'>=</span> <span class='const'>Vector</span><span class='lbracket'>[</span> <span class='ivar'>@x</span><span class='period'>.</span><span class='id identifier rubyid_mask'>mask</span><span class='lparen'>(</span> <span class='id identifier rubyid_mask'>mask</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_sum'>sum</span><span class='comma'>,</span> <span class='ivar'>@y</span><span class='period'>.</span><span class='id identifier rubyid_mask'>mask</span><span class='lparen'>(</span> <span class='id identifier rubyid_mask'>mask</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_sum'>sum</span> <span class='rbracket'>]</span>
        <span class='id identifier rubyid_center'>center</span> <span class='op'>=</span> <span class='id identifier rubyid_sum'>sum</span> <span class='op'>*</span> <span class='lparen'>(</span> <span class='float'>1.0</span> <span class='op'>/</span> <span class='id identifier rubyid_n'>n</span> <span class='rparen'>)</span>
        <span class='id identifier rubyid_xx'>xx</span> <span class='op'>=</span> <span class='ivar'>@xx</span><span class='period'>.</span><span class='id identifier rubyid_mask'>mask</span><span class='lparen'>(</span> <span class='id identifier rubyid_mask'>mask</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_sum'>sum</span>
        <span class='id identifier rubyid_yy'>yy</span> <span class='op'>=</span> <span class='ivar'>@yy</span><span class='period'>.</span><span class='id identifier rubyid_mask'>mask</span><span class='lparen'>(</span> <span class='id identifier rubyid_mask'>mask</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_sum'>sum</span>
        <span class='id identifier rubyid_xy'>xy</span> <span class='op'>=</span> <span class='ivar'>@xy</span><span class='period'>.</span><span class='id identifier rubyid_mask'>mask</span><span class='lparen'>(</span> <span class='id identifier rubyid_mask'>mask</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_sum'>sum</span>
        <span class='id identifier rubyid_squares'>squares</span> <span class='op'>=</span> <span class='const'>Matrix</span><span class='lbracket'>[</span> <span class='lbracket'>[</span> <span class='id identifier rubyid_xx'>xx</span><span class='comma'>,</span> <span class='id identifier rubyid_xy'>xy</span> <span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span> <span class='id identifier rubyid_xy'>xy</span><span class='comma'>,</span> <span class='id identifier rubyid_yy'>yy</span> <span class='rbracket'>]</span> <span class='rbracket'>]</span>
        <span class='id identifier rubyid_covariance'>covariance</span> <span class='op'>=</span> <span class='lparen'>(</span> <span class='id identifier rubyid_n'>n</span> <span class='op'>*</span> <span class='id identifier rubyid_squares'>squares</span> <span class='op'>-</span> <span class='id identifier rubyid_sum'>sum</span><span class='period'>.</span><span class='id identifier rubyid_covector'>covector</span><span class='period'>.</span><span class='id identifier rubyid_transpose'>transpose</span> <span class='op'>*</span> <span class='id identifier rubyid_sum'>sum</span><span class='period'>.</span><span class='id identifier rubyid_covector'>covector</span> <span class='rparen'>)</span> <span class='op'>/</span>
          <span class='lparen'>(</span> <span class='id identifier rubyid_n'>n</span> <span class='op'>**</span> <span class='int'>2</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span>
        <span class='id identifier rubyid_discriminant'>discriminant</span> <span class='op'>=</span> <span class='lparen'>(</span> <span class='id identifier rubyid_covariance'>covariance</span><span class='period'>.</span><span class='id identifier rubyid_trace'>trace</span> <span class='op'>**</span> <span class='int'>2</span> <span class='op'>-</span> <span class='int'>4</span> <span class='op'>*</span> <span class='id identifier rubyid_covariance'>covariance</span><span class='period'>.</span><span class='id identifier rubyid_determinant'>determinant</span> <span class='rparen'>)</span>
        <span class='id identifier rubyid_discriminant'>discriminant</span> <span class='op'>=</span> <span class='float'>0.0</span> <span class='kw'>if</span> <span class='id identifier rubyid_discriminant'>discriminant</span> <span class='op'>&lt;</span> <span class='float'>0.0</span>
        <span class='comment'># Take smallest eigenvalue. Eigenvalues are
</span>        <span class='comment'># &quot;0.5 * ( covariance.trace +- Math.sqrt( discriminant ) )&quot;
</span>        <span class='id identifier rubyid_lambda1'>lambda1</span> <span class='op'>=</span> <span class='float'>0.5</span> <span class='op'>*</span> <span class='lparen'>(</span> <span class='id identifier rubyid_covariance'>covariance</span><span class='period'>.</span><span class='id identifier rubyid_trace'>trace</span> <span class='op'>-</span> <span class='const'><span class='object_link'><a href="Math.html" title="Math (module)">Math</a></span></span><span class='period'>.</span><span class='id identifier rubyid_sqrt'><span class='object_link'><a href="Math.html#sqrt-class_method" title="Math.sqrt (method)">sqrt</a></span></span><span class='lparen'>(</span> <span class='id identifier rubyid_discriminant'>discriminant</span> <span class='rparen'>)</span> <span class='rparen'>)</span>
        <span class='id identifier rubyid_eigenspace'>eigenspace</span> <span class='op'>=</span> <span class='id identifier rubyid_covariance'>covariance</span> <span class='op'>-</span> <span class='id identifier rubyid_lambda1'>lambda1</span> <span class='op'>*</span> <span class='const'>Matrix</span><span class='period'>.</span><span class='id identifier rubyid_unit'>unit</span><span class='lparen'>(</span> <span class='int'>2</span> <span class='rparen'>)</span>
        <span class='comment'># Compute eigenvector by projecting basis-vectors.
</span>        <span class='id identifier rubyid_vector1'>vector1</span> <span class='op'>=</span> <span class='id identifier rubyid_eigenspace'>eigenspace</span> <span class='op'>*</span> <span class='const'>Vector</span><span class='lbracket'>[</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rbracket'>]</span> <span class='op'>-</span> <span class='const'>Vector</span><span class='lbracket'>[</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rbracket'>]</span>
        <span class='id identifier rubyid_vector2'>vector2</span> <span class='op'>=</span> <span class='id identifier rubyid_eigenspace'>eigenspace</span> <span class='op'>*</span> <span class='const'>Vector</span><span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span> <span class='rbracket'>]</span> <span class='op'>-</span> <span class='const'>Vector</span><span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span> <span class='rbracket'>]</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_vector1'>vector1</span><span class='period'>.</span><span class='id identifier rubyid_r'>r</span> <span class='op'>&gt;=</span> <span class='id identifier rubyid_vector2'>vector2</span><span class='period'>.</span><span class='id identifier rubyid_r'>r</span>
          <span class='id identifier rubyid_eigenvector'>eigenvector</span> <span class='op'>=</span> <span class='id identifier rubyid_vector1'>vector1</span> <span class='op'>*</span> <span class='lparen'>(</span> <span class='float'>1.0</span> <span class='op'>/</span> <span class='id identifier rubyid_vector1'>vector1</span><span class='period'>.</span><span class='id identifier rubyid_r'>r</span> <span class='rparen'>)</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_eigenvector'>eigenvector</span> <span class='op'>=</span> <span class='id identifier rubyid_vector2'>vector2</span> <span class='op'>*</span> <span class='lparen'>(</span> <span class='float'>1.0</span> <span class='op'>/</span> <span class='id identifier rubyid_vector2'>vector2</span><span class='period'>.</span><span class='id identifier rubyid_r'>r</span> <span class='rparen'>)</span>
        <span class='kw'>end</span>
        <span class='comment'># Resolve ambiguity by comparing with previous eigenvector.
</span>        <span class='kw'>if</span> <span class='ivar'>@old_eigenvector</span><span class='period'>.</span><span class='id identifier rubyid_inner_product'>inner_product</span><span class='lparen'>(</span> <span class='id identifier rubyid_eigenvector'>eigenvector</span> <span class='rparen'>)</span> <span class='op'>&lt;</span> <span class='int'>0</span>
          <span class='id identifier rubyid_eigenvector'>eigenvector</span> <span class='op'>=</span> <span class='id identifier rubyid_eigenvector'>eigenvector</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='op'>-</span><span class='id identifier rubyid_x'>x</span> <span class='rbrace'>}</span>
        <span class='kw'>end</span>
        <span class='ivar'>@old_eigenvector</span> <span class='op'>=</span> <span class='id identifier rubyid_eigenvector'>eigenvector</span>
        <span class='id identifier rubyid_gc'>gc</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Magick.html" title="Magick (module)">Magick</a></span></span><span class='op'>::</span><span class='const'>Draw</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
        <span class='id identifier rubyid_pointer'>pointer</span> <span class='op'>=</span> <span class='id identifier rubyid_center'>center</span> <span class='op'>+</span> <span class='id identifier rubyid_eigenvector'>eigenvector</span> <span class='op'>*</span> <span class='int'>30</span>
        <span class='id identifier rubyid_gc'>gc</span><span class='period'>.</span><span class='id identifier rubyid_fill_opacity'>fill_opacity</span><span class='lparen'>(</span> <span class='int'>0</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_stroke'>stroke</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>blue</span><span class='tstring_end'>&#39;</span></span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_stroke_width'>stroke_width</span><span class='lparen'>(</span> <span class='int'>3</span> <span class='rparen'>)</span>
        <span class='id identifier rubyid_gc'>gc</span><span class='period'>.</span><span class='id identifier rubyid_circle'>circle</span><span class='lparen'>(</span> <span class='id identifier rubyid_center'>center</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_center'>center</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_pointer'>pointer</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_pointer'>pointer</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='rparen'>)</span>
        <span class='id identifier rubyid_gc'>gc</span><span class='period'>.</span><span class='id identifier rubyid_line'>line</span><span class='lparen'>(</span> <span class='id identifier rubyid_center'>center</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_center'>center</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_pointer'>pointer</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_pointer'>pointer</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='rparen'>)</span>
        <span class='id identifier rubyid_img'>img</span> <span class='op'>=</span> <span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_to_ubytergb'>to_ubytergb</span><span class='period'>.</span><span class='id identifier rubyid_to_magick'>to_magick</span>
        <span class='id identifier rubyid_gc'>gc</span><span class='period'>.</span><span class='id identifier rubyid_draw'>draw</span> <span class='id identifier rubyid_img'>img</span>
        <span class='id identifier rubyid_img'>img</span> <span class='op'>=</span> <span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_to_ubytergb'>to_ubytergb</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='ivar'>@xvideo</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span> <span class='id identifier rubyid_img'>img</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_keyPressEvent'>keyPressEvent</span><span class='lparen'>(</span> <span class='id identifier rubyid_event'>event</span> <span class='rparen'>)</span>
    <span class='kw'>case</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_key'>key</span>
    <span class='kw'>when</span> <span class='const'>Qt</span><span class='op'>::</span><span class='const'>Key_Escape</span>
      <span class='id identifier rubyid_close'>close</span>
    <span class='kw'>else</span>
      <span class='kw'>super</span> <span class='id identifier rubyid_event'>event</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
<span class='id identifier rubyid_app'>app</span> <span class='op'>=</span> <span class='const'>Qt</span><span class='op'>::</span><span class='const'>Application</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='const'>ARGV</span>
<span class='const'>PCAWindow</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='period'>.</span><span class='id identifier rubyid_show'>show</span>
<span class='id identifier rubyid_app'>app</span><span class='period'>.</span><span class='id identifier rubyid_exec'>exec</span>
</code></pre>

<h2 id="label-Power+Spectrum">Power Spectrum</h2>

<p><img src="images/power.jpg"></p>

<p>The following example demonstrates using windowing, zero padding, and Fourier transform in order to compute the power spectrum of a signal. The example image shows the power spectrum of a piece of fabric.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_fftw3</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_rmagick</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_xorg</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="Hornetseye.html" title="Hornetseye (module)">Hornetseye</a></span></span>
<span class='kw'>class</span> <span class='const'>Node</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_window'>window</span>
    <span class='id identifier rubyid_finalise'>finalise</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span><span class='id identifier rubyid_j'>j</span><span class='op'>|</span>
      <span class='id identifier rubyid_x'>x</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_i'>i</span> <span class='op'>+</span> <span class='float'>0.5</span> <span class='op'>-</span> <span class='float'>0.5</span> <span class='op'>*</span> <span class='id identifier rubyid_width'>width</span> <span class='rparen'>)</span> <span class='op'>/</span> <span class='lparen'>(</span><span class='float'>0.5</span> <span class='op'>*</span> <span class='id identifier rubyid_width'>width</span> <span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span>
      <span class='id identifier rubyid_y'>y</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_j'>j</span> <span class='op'>+</span> <span class='float'>0.5</span> <span class='op'>-</span> <span class='float'>0.5</span> <span class='op'>*</span> <span class='id identifier rubyid_height'>height</span><span class='rparen'>)</span> <span class='op'>/</span> <span class='lparen'>(</span><span class='float'>0.5</span> <span class='op'>*</span> <span class='id identifier rubyid_height'>height</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span>
      <span class='id identifier rubyid_w'>w</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='int'>1</span> <span class='op'>-</span> <span class='const'><span class='object_link'><a href="Math.html" title="Math (module)">Math</a></span></span><span class='period'>.</span><span class='id identifier rubyid_sqrt'><span class='object_link'><a href="Math.html#sqrt-class_method" title="Math.sqrt (method)">sqrt</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span> <span class='op'>**</span> <span class='int'>2</span> <span class='op'>+</span> <span class='id identifier rubyid_y'>y</span> <span class='op'>**</span> <span class='int'>2</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_major'>major</span> <span class='float'>0.0</span>
      <span class='kw'>self</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span><span class='id identifier rubyid_j'>j</span><span class='rbracket'>]</span> <span class='op'>*</span> <span class='id identifier rubyid_w'>w</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_zeropad'>zeropad</span>
    <span class='id identifier rubyid_retval'>retval</span> <span class='op'>=</span> <span class='const'>MultiArray</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_typecode'>typecode</span><span class='comma'>,</span> <span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_width'>width</span><span class='comma'>,</span> <span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_height'>height</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_fill!'>fill!</span>
    <span class='id identifier rubyid_retval'>retval</span><span class='lbracket'>[</span><span class='int'>0</span> <span class='op'>...</span> <span class='id identifier rubyid_width'>width</span><span class='comma'>,</span> <span class='int'>0</span> <span class='op'>...</span> <span class='id identifier rubyid_height'>height</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>self</span>
    <span class='id identifier rubyid_retval'>retval</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_spectrum'>spectrum</span>
    <span class='id identifier rubyid_fft'>fft</span> <span class='op'>=</span> <span class='id identifier rubyid_window'>window</span><span class='period'>.</span><span class='id identifier rubyid_zeropad'>zeropad</span><span class='period'>.</span><span class='id identifier rubyid_fft'>fft</span>
    <span class='lparen'>(</span><span class='id identifier rubyid_fft'>fft</span><span class='period'>.</span><span class='id identifier rubyid_conj'>conj</span> <span class='op'>*</span> <span class='id identifier rubyid_fft'>fft</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_real'>real</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
<span class='id identifier rubyid_img'>img</span> <span class='op'>=</span> <span class='const'>MultiArray</span><span class='period'>.</span><span class='id identifier rubyid_load_ubyte'>load_ubyte</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>http://www.wedesoft.de/hornetseye-api/images/texture.jpg</span><span class='tstring_end'>&#39;</span></span>
<span class='lparen'>(</span><span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_spectrum'>spectrum</span> <span class='op'>**</span> <span class='float'>0.1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_shift'>shift</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_shape'>shape</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_normalise'>normalise</span><span class='lparen'>(</span><span class='int'>255</span> <span class='op'>..</span> <span class='int'>0</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_show'>show</span> <span class='op'>*</span><span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_shape'>shape</span>
</code></pre>

<h2 id="label-Phase+Correlation">Phase Correlation</h2>

<p><img src="images/phasecorrelation.png"></p>

<p>This is an implementation of the phase correlation for aligning images. This implementation also works on images which are of different size. I.e. stitching of overlapping images is possible as well as searching a small template in a large image. Note that you may have to add a windowing function to the implementation to avoid boundary effects.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_fftw3</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_rmagick</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_xorg</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="Hornetseye.html" title="Hornetseye (module)">Hornetseye</a></span></span>
<span class='kw'>class</span> <span class='const'>Node</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_zeropad'>zeropad</span><span class='lparen'>(</span> <span class='op'>*</span><span class='id identifier rubyid_s'>s</span> <span class='rparen'>)</span>
    <span class='id identifier rubyid_retval'>retval</span> <span class='op'>=</span> <span class='const'>MultiArray</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span> <span class='id identifier rubyid_typecode'>typecode</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_s'>s</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_fill!'>fill!</span>
    <span class='id identifier rubyid_retval'>retval</span><span class='lbracket'>[</span> <span class='int'>0</span> <span class='op'>...</span> <span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='int'>0</span> <span class='op'>...</span> <span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>self</span>
    <span class='id identifier rubyid_retval'>retval</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_phase_corr_cyclical'>phase_corr_cyclical</span><span class='lparen'>(</span> <span class='id identifier rubyid_other'>other</span> <span class='rparen'>)</span>
    <span class='id identifier rubyid_nominator'>nominator</span> <span class='op'>=</span> <span class='id identifier rubyid_rfft'>rfft</span> <span class='op'>*</span> <span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_rfft'>rfft</span><span class='period'>.</span><span class='id identifier rubyid_conj'>conj</span>
    <span class='id identifier rubyid_denominator'>denominator</span> <span class='op'>=</span> <span class='id identifier rubyid_nominator'>nominator</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span>
    <span class='id identifier rubyid_mask'>mask</span> <span class='op'>=</span> <span class='id identifier rubyid_denominator'>denominator</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span> <span class='op'>&gt;</span> <span class='float'>1.0e-5</span>
    <span class='lparen'>(</span> <span class='id identifier rubyid_nominator'>nominator</span><span class='period'>.</span><span class='id identifier rubyid_mask'>mask</span><span class='lparen'>(</span> <span class='id identifier rubyid_mask'>mask</span> <span class='rparen'>)</span> <span class='op'>/</span> <span class='id identifier rubyid_denominator'>denominator</span><span class='period'>.</span><span class='id identifier rubyid_mask'>mask</span><span class='lparen'>(</span> <span class='id identifier rubyid_mask'>mask</span> <span class='rparen'>)</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_unmask'>unmask</span><span class='lparen'>(</span> <span class='id identifier rubyid_mask'>mask</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_irfft'>irfft</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_phase_corr'>phase_corr</span><span class='lparen'>(</span> <span class='id identifier rubyid_other'>other</span> <span class='rparen'>)</span>
    <span class='id identifier rubyid_ext_shape'>ext_shape</span> <span class='op'>=</span> <span class='lbracket'>[</span> <span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='rbracket'>]</span>
    <span class='id identifier rubyid_zeropad'>zeropad</span><span class='lparen'>(</span> <span class='op'>*</span><span class='id identifier rubyid_ext_shape'>ext_shape</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_phase_corr_cyclical'>phase_corr_cyclical</span> <span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_zeropad'>zeropad</span><span class='lparen'>(</span> <span class='op'>*</span><span class='id identifier rubyid_ext_shape'>ext_shape</span> <span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
<span class='id identifier rubyid_syntax'>syntax</span> <span class='op'>=</span> <span class='heredoc_beg'>&lt;&lt;END_OF_STRING</span>
<span class='tstring_content'>Align images using phase correlation
Syntax : pc.rb &lt;image1&gt; &lt;image2&gt;
Example: pc.rb image1.jpg image2.jpg
</span><span class='heredoc_end'>END_OF_STRING
</span><span class='kw'>if</span> <span class='const'>ARGV</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>!=</span> <span class='int'>2</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_syntax'>syntax</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Wrong number of command-line arguments</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
<span class='id identifier rubyid_image'>image</span> <span class='op'>=</span> <span class='const'>MultiArray</span><span class='period'>.</span><span class='id identifier rubyid_load_ubyte'>load_ubyte</span> <span class='const'>ARGV</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
<span class='id identifier rubyid_template'>template</span> <span class='op'>=</span> <span class='const'>MultiArray</span><span class='period'>.</span><span class='id identifier rubyid_load_ubyte'>load_ubyte</span> <span class='const'>ARGV</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
<span class='id identifier rubyid_shift'>shift</span> <span class='op'>=</span> <span class='id identifier rubyid_image'>image</span><span class='period'>.</span><span class='id identifier rubyid_phase_corr'>phase_corr</span> <span class='id identifier rubyid_template'>template</span>
<span class='id identifier rubyid_shiftx'>shiftx</span><span class='comma'>,</span> <span class='id identifier rubyid_shifty'>shifty</span> <span class='op'>=</span> <span class='id identifier rubyid_argmax'>argmax</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span><span class='id identifier rubyid_j'>j</span><span class='op'>|</span> <span class='id identifier rubyid_shift'>shift</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span><span class='id identifier rubyid_j'>j</span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_shiftx'>shiftx</span> <span class='op'>=</span> <span class='id identifier rubyid_shiftx'>shiftx</span> <span class='op'>-</span> <span class='id identifier rubyid_image'>image</span><span class='period'>.</span><span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>-</span> <span class='id identifier rubyid_template'>template</span><span class='period'>.</span><span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_shiftx'>shiftx</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_image'>image</span><span class='period'>.</span><span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
<span class='id identifier rubyid_shifty'>shifty</span> <span class='op'>=</span> <span class='id identifier rubyid_shifty'>shifty</span> <span class='op'>-</span> <span class='id identifier rubyid_image'>image</span><span class='period'>.</span><span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>-</span> <span class='id identifier rubyid_template'>template</span><span class='period'>.</span><span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_shifty'>shifty</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_image'>image</span><span class='period'>.</span><span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
<span class='id identifier rubyid_minx'>minx</span> <span class='op'>=</span> <span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_shiftx'>shiftx</span> <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_min'>min</span>
<span class='id identifier rubyid_miny'>miny</span> <span class='op'>=</span> <span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_shifty'>shifty</span> <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_min'>min</span>
<span class='id identifier rubyid_maxx'>maxx</span> <span class='op'>=</span> <span class='lbracket'>[</span> <span class='id identifier rubyid_image'>image</span><span class='period'>.</span><span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_template'>template</span><span class='period'>.</span><span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='id identifier rubyid_shiftx'>shiftx</span> <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_max'>max</span> <span class='op'>-</span> <span class='int'>1</span>
<span class='id identifier rubyid_maxy'>maxy</span> <span class='op'>=</span> <span class='lbracket'>[</span> <span class='id identifier rubyid_image'>image</span><span class='period'>.</span><span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_template'>template</span><span class='period'>.</span><span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='id identifier rubyid_shifty'>shifty</span> <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_max'>max</span> <span class='op'>-</span> <span class='int'>1</span>
<span class='id identifier rubyid_offsetx'>offsetx</span> <span class='op'>=</span> <span class='op'>-</span><span class='id identifier rubyid_minx'>minx</span>
<span class='id identifier rubyid_offsety'>offsety</span> <span class='op'>=</span> <span class='op'>-</span><span class='id identifier rubyid_miny'>miny</span>
<span class='id identifier rubyid_resultwidth'>resultwidth</span>  <span class='op'>=</span> <span class='id identifier rubyid_maxx'>maxx</span> <span class='op'>+</span> <span class='int'>1</span> <span class='op'>-</span> <span class='id identifier rubyid_minx'>minx</span>
<span class='id identifier rubyid_resultheight'>resultheight</span> <span class='op'>=</span> <span class='id identifier rubyid_maxy'>maxy</span> <span class='op'>+</span> <span class='int'>1</span> <span class='op'>-</span> <span class='id identifier rubyid_miny'>miny</span>
<span class='id identifier rubyid_result1'>result1</span> <span class='op'>=</span> <span class='const'>MultiArray</span><span class='period'>.</span><span class='id identifier rubyid_ubyte'>ubyte</span><span class='lparen'>(</span> <span class='id identifier rubyid_resultwidth'>resultwidth</span><span class='comma'>,</span> <span class='id identifier rubyid_resultheight'>resultheight</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_fill!'>fill!</span>
<span class='id identifier rubyid_result1'>result1</span><span class='lbracket'>[</span> <span class='id identifier rubyid_offsetx'>offsetx</span> <span class='op'>...</span> <span class='id identifier rubyid_offsetx'>offsetx</span> <span class='op'>+</span> <span class='id identifier rubyid_image'>image</span><span class='period'>.</span><span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span>
         <span class='id identifier rubyid_offsety'>offsety</span> <span class='op'>...</span> <span class='id identifier rubyid_offsety'>offsety</span> <span class='op'>+</span> <span class='id identifier rubyid_image'>image</span><span class='period'>.</span><span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_image'>image</span> <span class='op'>/</span> <span class='int'>2</span>
<span class='id identifier rubyid_result2'>result2</span> <span class='op'>=</span> <span class='const'>MultiArray</span><span class='period'>.</span><span class='id identifier rubyid_ubyte'>ubyte</span><span class='lparen'>(</span> <span class='id identifier rubyid_resultwidth'>resultwidth</span><span class='comma'>,</span> <span class='id identifier rubyid_resultheight'>resultheight</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_fill!'>fill!</span>
<span class='id identifier rubyid_result2'>result2</span><span class='lbracket'>[</span> <span class='id identifier rubyid_shiftx'>shiftx</span> <span class='op'>+</span> <span class='id identifier rubyid_offsetx'>offsetx</span> <span class='op'>...</span> <span class='id identifier rubyid_shiftx'>shiftx</span> <span class='op'>+</span> <span class='id identifier rubyid_offsetx'>offsetx</span> <span class='op'>+</span> <span class='id identifier rubyid_template'>template</span><span class='period'>.</span><span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span>
         <span class='id identifier rubyid_shifty'>shifty</span> <span class='op'>+</span> <span class='id identifier rubyid_offsety'>offsety</span> <span class='op'>...</span> <span class='id identifier rubyid_shifty'>shifty</span> <span class='op'>+</span> <span class='id identifier rubyid_offsety'>offsety</span> <span class='op'>+</span> <span class='id identifier rubyid_template'>template</span><span class='period'>.</span><span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_template'>template</span> <span class='op'>/</span> <span class='int'>2</span>
<span class='lparen'>(</span> <span class='id identifier rubyid_result1'>result1</span> <span class='op'>+</span> <span class='id identifier rubyid_result2'>result2</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_show'>show</span>
</code></pre>

<h2 id="label-Normalised+Cross-Correlation">Normalised Cross-Correlation</h2>

<p><img src="images/ncc.png"></p>

<p>This is an implementation of the normalised cross-correlation for locating a template in an image. The template must be smaller than the image. Note that the implementation could be optimised using integral images.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_fftw3</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_rmagick</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_xorg</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="Hornetseye.html" title="Hornetseye (module)">Hornetseye</a></span></span>
<span class='kw'>class</span> <span class='const'>Node</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_avg'>avg</span>
    <span class='id identifier rubyid_sum'>sum</span> <span class='op'>/</span> <span class='id identifier rubyid_size'>size</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_sqr'>sqr</span>
    <span class='kw'>self</span> <span class='op'>*</span> <span class='kw'>self</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_corr'>corr</span><span class='lparen'>(</span><span class='id identifier rubyid_other'>other</span><span class='rparen'>)</span>
    <span class='lparen'>(</span><span class='id identifier rubyid_rfft'>rfft</span> <span class='op'>*</span> <span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_rfft'>rfft</span><span class='period'>.</span><span class='id identifier rubyid_conj'>conj</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_irfft'>irfft</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_zcorr'>zcorr</span><span class='lparen'>(</span><span class='id identifier rubyid_other'>other</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_zother'>zother</span> <span class='op'>=</span> <span class='const'>MultiArray</span><span class='period'>.</span><span class='id identifier rubyid_dfloat'>dfloat</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_shape'>shape</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_fill!'>fill!</span>
    <span class='id identifier rubyid_zother'>zother</span><span class='lbracket'>[</span><span class='int'>0</span> <span class='op'>...</span> <span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='int'>0</span> <span class='op'>...</span> <span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_other'>other</span>
    <span class='id identifier rubyid_corr'>corr</span> <span class='id identifier rubyid_zother'>zother</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_ma'>ma</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_box'>box</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_iself'>iself</span> <span class='op'>=</span> <span class='const'>MultiArray</span><span class='period'>.</span><span class='id identifier rubyid_dfloat'>dfloat</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_shape'>shape</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_fill!'>fill!</span>
    <span class='id identifier rubyid_iself'>iself</span><span class='lbracket'>[</span><span class='int'>1</span> <span class='op'>...</span> <span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='int'>1</span> <span class='op'>...</span> <span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>self</span><span class='lbracket'>[</span><span class='int'>0</span> <span class='op'>...</span> <span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>-</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span> <span class='op'>...</span> <span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>-</span> <span class='int'>1</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_int'>int</span> <span class='op'>=</span> <span class='id identifier rubyid_iself'>iself</span><span class='period'>.</span><span class='id identifier rubyid_integral'>integral</span>
    <span class='id identifier rubyid_int'>int</span><span class='lbracket'>[</span><span class='int'>0</span> <span class='op'>...</span> <span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>-</span> <span class='id identifier rubyid_box'>box</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='int'>0</span> <span class='op'>...</span> <span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>-</span> <span class='id identifier rubyid_box'>box</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='op'>+</span>
      <span class='id identifier rubyid_int'>int</span><span class='lbracket'>[</span><span class='id identifier rubyid_box'>box</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>...</span> <span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_box'>box</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>...</span> <span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='op'>-</span>
      <span class='id identifier rubyid_int'>int</span><span class='lbracket'>[</span><span class='int'>0</span> <span class='op'>...</span> <span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>-</span> <span class='id identifier rubyid_box'>box</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_box'>box</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>...</span> <span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='op'>-</span>
      <span class='id identifier rubyid_int'>int</span><span class='lbracket'>[</span><span class='id identifier rubyid_box'>box</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>...</span> <span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='int'>0</span> <span class='op'>...</span> <span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>-</span> <span class='id identifier rubyid_box'>box</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_ncc'>ncc</span><span class='lparen'>(</span><span class='id identifier rubyid_other'>other</span><span class='comma'>,</span> <span class='id identifier rubyid_noise'>noise</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_box'>box</span> <span class='op'>=</span> <span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_shape'>shape</span>
    <span class='id identifier rubyid_zcorr'>zcorr</span><span class='lparen'>(</span><span class='id identifier rubyid_other'>other</span> <span class='op'>-</span> <span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_avg'>avg</span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='int'>0</span> <span class='op'>...</span> <span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>-</span> <span class='id identifier rubyid_box'>box</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='int'>0</span> <span class='op'>...</span> <span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>-</span> <span class='id identifier rubyid_box'>box</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='op'>/</span>
      <span class='const'><span class='object_link'><a href="Math.html" title="Math (module)">Math</a></span></span><span class='period'>.</span><span class='id identifier rubyid_sqrt'><span class='object_link'><a href="Math.html#sqrt-class_method" title="Math.sqrt (method)">sqrt</a></span></span><span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_sqr'>sqr</span><span class='period'>.</span><span class='id identifier rubyid_ma'>ma</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_shape'>shape</span><span class='rparen'>)</span> <span class='op'>-</span>
                 <span class='id identifier rubyid_ma'>ma</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_shape'>shape</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_sqr'>sqr</span> <span class='op'>/</span> <span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='rparen'>)</span> <span class='op'>*</span>
                <span class='lparen'>(</span><span class='id identifier rubyid_other'>other</span> <span class='op'>-</span> <span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_avg'>avg</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_sqr'>sqr</span><span class='period'>.</span><span class='id identifier rubyid_sum'>sum</span> <span class='op'>+</span> <span class='id identifier rubyid_noise'>noise</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
<span class='id identifier rubyid_syntax'>syntax</span> <span class='op'>=</span> <span class='heredoc_beg'>&lt;&lt;END_OF_STRING</span>
<span class='tstring_content'>Locate template using normalised cross-correlation
Syntax : ncc.rb &lt;image&gt; &lt;template&gt;
Example: ncc.rb image.jpg template.jpg
</span><span class='heredoc_end'>END_OF_STRING
</span><span class='kw'>if</span> <span class='const'>ARGV</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>!=</span> <span class='int'>2</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_syntax'>syntax</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Wrong number of command-line arguments</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
<span class='id identifier rubyid_image'>image</span> <span class='op'>=</span> <span class='const'>MultiArray</span><span class='period'>.</span><span class='id identifier rubyid_load_ubyte'>load_ubyte</span> <span class='const'>ARGV</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
<span class='id identifier rubyid_template'>template</span> <span class='op'>=</span> <span class='const'>MultiArray</span><span class='period'>.</span><span class='id identifier rubyid_load_ubyte'>load_ubyte</span> <span class='const'>ARGV</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
<span class='id identifier rubyid_ncc'>ncc</span> <span class='op'>=</span> <span class='id identifier rubyid_image'>image</span><span class='period'>.</span><span class='id identifier rubyid_to_dfloat'>to_dfloat</span><span class='period'>.</span><span class='id identifier rubyid_ncc'>ncc</span> <span class='id identifier rubyid_template'>template</span><span class='period'>.</span><span class='id identifier rubyid_to_dfloat'>to_dfloat</span><span class='comma'>,</span> <span class='float'>0.1</span>
<span class='id identifier rubyid_shiftx'>shiftx</span><span class='comma'>,</span> <span class='id identifier rubyid_shifty'>shifty</span> <span class='op'>=</span> <span class='id identifier rubyid_argmax'>argmax</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span><span class='id identifier rubyid_j'>j</span><span class='op'>|</span> <span class='id identifier rubyid_ncc'>ncc</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span><span class='id identifier rubyid_j'>j</span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_result1'>result1</span> <span class='op'>=</span> <span class='id identifier rubyid_image'>image</span> <span class='op'>/</span> <span class='int'>2</span>
<span class='id identifier rubyid_result2'>result2</span> <span class='op'>=</span> <span class='const'>MultiArray</span><span class='period'>.</span><span class='id identifier rubyid_ubyte'>ubyte</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_image'>image</span><span class='period'>.</span><span class='id identifier rubyid_shape'>shape</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_fill!'>fill!</span>
<span class='id identifier rubyid_result2'>result2</span><span class='lbracket'>[</span><span class='id identifier rubyid_shiftx'>shiftx</span> <span class='op'>...</span> <span class='id identifier rubyid_shiftx'>shiftx</span> <span class='op'>+</span> <span class='id identifier rubyid_template'>template</span><span class='period'>.</span><span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span>
        <span class='id identifier rubyid_shifty'>shifty</span> <span class='op'>...</span> <span class='id identifier rubyid_shifty'>shifty</span> <span class='op'>+</span> <span class='id identifier rubyid_template'>template</span><span class='period'>.</span><span class='id identifier rubyid_shape'>shape</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_template'>template</span> <span class='op'>/</span> <span class='int'>2</span>
<span class='lparen'>(</span><span class='id identifier rubyid_result1'>result1</span> <span class='op'>+</span> <span class='id identifier rubyid_result2'>result2</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_show'>show</span>
</code></pre>

<h2 id="label-Camshift+Tracking">Camshift Tracking</h2>

<p><img src="images/camshift.jpg"></p>

<p>This is an implementation of the Camshift algorithm for real-time tracking. The algorithm tracks the object by maximising the similarity of a hue reference histogram and a hue scene histogram.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_v4l2</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_xorg</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="Hornetseye.html" title="Hornetseye (module)">Hornetseye</a></span></span>
<span class='const'>WIDTH</span> <span class='op'>=</span> <span class='int'>320</span>
<span class='const'>BOX_SIZE</span> <span class='op'>=</span> <span class='int'>64</span>
<span class='const'>SHIFT</span> <span class='op'>=</span> <span class='int'>3</span>
<span class='const'>N</span> <span class='op'>=</span> <span class='int'>0x100</span> <span class='op'>&gt;&gt;</span> <span class='const'>SHIFT</span>
<span class='const'>RANGE</span> <span class='op'>=</span> <span class='int'>0x30</span> <span class='op'>..</span> <span class='int'>0xD0</span>
<span class='const'>MAX_ITER</span> <span class='op'>=</span> <span class='int'>5</span>
<span class='const'>RATIO</span> <span class='op'>=</span> <span class='float'>1.2</span>
<span class='const'>HUE</span> <span class='op'>=</span> <span class='id identifier rubyid_finalise'>finalise</span> <span class='const'>N</span><span class='comma'>,</span> <span class='const'>N</span><span class='comma'>,</span> <span class='const'>N</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='comma'>,</span><span class='id identifier rubyid_y'>y</span><span class='comma'>,</span><span class='id identifier rubyid_z'>z</span><span class='op'>|</span>
  <span class='id identifier rubyid_r'>r</span><span class='comma'>,</span> <span class='id identifier rubyid_g'>g</span><span class='comma'>,</span> <span class='id identifier rubyid_b'>b</span> <span class='op'>=</span> <span class='lparen'>(</span> <span class='id identifier rubyid_x'>x</span> <span class='op'>+</span> <span class='float'>0.5</span> <span class='rparen'>)</span> <span class='op'>/</span> <span class='const'>N</span><span class='comma'>,</span> <span class='lparen'>(</span> <span class='id identifier rubyid_y'>y</span> <span class='op'>+</span> <span class='float'>0.5</span> <span class='rparen'>)</span> <span class='op'>/</span> <span class='const'>N</span><span class='comma'>,</span> <span class='lparen'>(</span> <span class='id identifier rubyid_z'>z</span> <span class='op'>+</span> <span class='float'>0.5</span> <span class='rparen'>)</span> <span class='op'>/</span> <span class='const'>N</span>
  <span class='id identifier rubyid_min'>min</span> <span class='op'>=</span> <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_minor'>minor</span><span class='lparen'>(</span> <span class='id identifier rubyid_g'>g</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_minor'>minor</span> <span class='id identifier rubyid_b'>b</span>
  <span class='id identifier rubyid_max'>max</span> <span class='op'>=</span> <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_major'>major</span><span class='lparen'>(</span> <span class='id identifier rubyid_g'>g</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_major'>major</span> <span class='id identifier rubyid_b'>b</span>
  <span class='id identifier rubyid_max'>max</span><span class='period'>.</span><span class='id identifier rubyid_eq'>eq</span><span class='lparen'>(</span> <span class='id identifier rubyid_min'>min</span> <span class='rparen'>)</span><span class='period'>.</span>
    <span class='id identifier rubyid_conditional'>conditional</span><span class='lparen'>(</span> <span class='int'>0</span><span class='comma'>,</span>
      <span class='id identifier rubyid_max'>max</span><span class='period'>.</span><span class='id identifier rubyid_eq'>eq</span><span class='lparen'>(</span> <span class='id identifier rubyid_r'>r</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_and'>and</span><span class='lparen'>(</span> <span class='id identifier rubyid_g'>g</span> <span class='op'>&gt;=</span> <span class='id identifier rubyid_b'>b</span> <span class='rparen'>)</span><span class='period'>.</span>
      <span class='id identifier rubyid_conditional'>conditional</span><span class='lparen'>(</span> <span class='int'>60</span> <span class='op'>*</span> <span class='lparen'>(</span> <span class='id identifier rubyid_g'>g</span> <span class='op'>-</span> <span class='id identifier rubyid_b'>b</span> <span class='rparen'>)</span> <span class='op'>/</span> <span class='lparen'>(</span> <span class='id identifier rubyid_max'>max</span> <span class='op'>-</span> <span class='id identifier rubyid_min'>min</span> <span class='rparen'>)</span><span class='comma'>,</span>
         <span class='id identifier rubyid_max'>max</span><span class='period'>.</span><span class='id identifier rubyid_eq'>eq</span><span class='lparen'>(</span> <span class='id identifier rubyid_r'>r</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_and'>and</span><span class='lparen'>(</span> <span class='id identifier rubyid_g'>g</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_b'>b</span> <span class='rparen'>)</span><span class='period'>.</span>
         <span class='id identifier rubyid_conditional'>conditional</span><span class='lparen'>(</span> <span class='int'>60</span> <span class='op'>*</span> <span class='lparen'>(</span> <span class='id identifier rubyid_g'>g</span> <span class='op'>-</span> <span class='id identifier rubyid_b'>b</span> <span class='rparen'>)</span> <span class='op'>/</span> <span class='lparen'>(</span> <span class='id identifier rubyid_max'>max</span> <span class='op'>-</span> <span class='id identifier rubyid_min'>min</span> <span class='rparen'>)</span> <span class='op'>+</span> <span class='int'>360</span><span class='comma'>,</span>
           <span class='id identifier rubyid_max'>max</span><span class='period'>.</span><span class='id identifier rubyid_eq'>eq</span><span class='lparen'>(</span> <span class='id identifier rubyid_g'>g</span> <span class='rparen'>)</span><span class='period'>.</span>
           <span class='id identifier rubyid_conditional'>conditional</span><span class='lparen'>(</span> <span class='int'>60</span> <span class='op'>*</span> <span class='lparen'>(</span> <span class='id identifier rubyid_b'>b</span> <span class='op'>-</span> <span class='id identifier rubyid_r'>r</span> <span class='rparen'>)</span> <span class='op'>/</span> <span class='lparen'>(</span> <span class='id identifier rubyid_max'>max</span> <span class='op'>-</span> <span class='id identifier rubyid_min'>min</span> <span class='rparen'>)</span> <span class='op'>+</span> <span class='int'>120</span><span class='comma'>,</span>
                        <span class='int'>60</span> <span class='op'>*</span> <span class='lparen'>(</span> <span class='id identifier rubyid_r'>r</span> <span class='op'>-</span> <span class='id identifier rubyid_g'>g</span> <span class='rparen'>)</span> <span class='op'>/</span> <span class='lparen'>(</span> <span class='id identifier rubyid_max'>max</span> <span class='op'>-</span> <span class='id identifier rubyid_min'>min</span> <span class='rparen'>)</span> <span class='op'>+</span> <span class='int'>240</span> <span class='rparen'>)</span> <span class='rparen'>)</span> <span class='rparen'>)</span> <span class='rparen'>)</span>
<span class='kw'>end</span>
<span class='const'>SAT</span> <span class='op'>=</span> <span class='id identifier rubyid_finalise'>finalise</span> <span class='const'>N</span><span class='comma'>,</span> <span class='const'>N</span><span class='comma'>,</span> <span class='const'>N</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='comma'>,</span><span class='id identifier rubyid_y'>y</span><span class='comma'>,</span><span class='id identifier rubyid_z'>z</span><span class='op'>|</span>
  <span class='id identifier rubyid_r'>r</span><span class='comma'>,</span> <span class='id identifier rubyid_g'>g</span><span class='comma'>,</span> <span class='id identifier rubyid_b'>b</span> <span class='op'>=</span> <span class='lparen'>(</span> <span class='id identifier rubyid_x'>x</span> <span class='op'>+</span> <span class='float'>0.5</span> <span class='rparen'>)</span> <span class='op'>/</span> <span class='const'>N</span><span class='comma'>,</span> <span class='lparen'>(</span> <span class='id identifier rubyid_y'>y</span> <span class='op'>+</span> <span class='float'>0.5</span> <span class='rparen'>)</span> <span class='op'>/</span> <span class='const'>N</span><span class='comma'>,</span> <span class='lparen'>(</span> <span class='id identifier rubyid_z'>z</span> <span class='op'>+</span> <span class='float'>0.5</span> <span class='rparen'>)</span> <span class='op'>/</span> <span class='const'>N</span>
  <span class='id identifier rubyid_min'>min</span> <span class='op'>=</span> <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_minor'>minor</span><span class='lparen'>(</span> <span class='id identifier rubyid_g'>g</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_minor'>minor</span> <span class='id identifier rubyid_b'>b</span>
  <span class='id identifier rubyid_max'>max</span> <span class='op'>=</span> <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_major'>major</span><span class='lparen'>(</span> <span class='id identifier rubyid_g'>g</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_major'>major</span> <span class='id identifier rubyid_b'>b</span>
  <span class='id identifier rubyid_max'>max</span><span class='period'>.</span><span class='id identifier rubyid_eq'>eq</span><span class='lparen'>(</span> <span class='int'>0</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_conditional'>conditional</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>255</span> <span class='op'>*</span> <span class='lparen'>(</span> <span class='id identifier rubyid_max'>max</span> <span class='op'>-</span> <span class='id identifier rubyid_min'>min</span> <span class='rparen'>)</span> <span class='op'>/</span> <span class='id identifier rubyid_max'>max</span>
<span class='kw'>end</span>
<span class='const'>MIN</span> <span class='op'>=</span> <span class='id identifier rubyid_finalise'>finalise</span> <span class='const'>N</span><span class='comma'>,</span> <span class='const'>N</span><span class='comma'>,</span> <span class='const'>N</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='comma'>,</span><span class='id identifier rubyid_y'>y</span><span class='comma'>,</span><span class='id identifier rubyid_z'>z</span><span class='op'>|</span>
  <span class='id identifier rubyid_r'>r</span><span class='comma'>,</span> <span class='id identifier rubyid_g'>g</span><span class='comma'>,</span> <span class='id identifier rubyid_b'>b</span> <span class='op'>=</span> <span class='lparen'>(</span> <span class='id identifier rubyid_x'>x</span> <span class='op'>+</span> <span class='float'>0.5</span> <span class='rparen'>)</span> <span class='op'>/</span> <span class='const'>N</span><span class='comma'>,</span> <span class='lparen'>(</span> <span class='id identifier rubyid_y'>y</span> <span class='op'>+</span> <span class='float'>0.5</span> <span class='rparen'>)</span> <span class='op'>/</span> <span class='const'>N</span><span class='comma'>,</span> <span class='lparen'>(</span> <span class='id identifier rubyid_z'>z</span> <span class='op'>+</span> <span class='float'>0.5</span> <span class='rparen'>)</span> <span class='op'>/</span> <span class='const'>N</span>
  <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_minor'>minor</span><span class='lparen'>(</span> <span class='id identifier rubyid_g'>g</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_minor'>minor</span> <span class='id identifier rubyid_b'>b</span>
<span class='kw'>end</span>
<span class='const'>MAX</span> <span class='op'>=</span> <span class='id identifier rubyid_finalise'>finalise</span> <span class='const'>N</span><span class='comma'>,</span> <span class='const'>N</span><span class='comma'>,</span> <span class='const'>N</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='comma'>,</span><span class='id identifier rubyid_y'>y</span><span class='comma'>,</span><span class='id identifier rubyid_z'>z</span><span class='op'>|</span>
  <span class='id identifier rubyid_r'>r</span><span class='comma'>,</span> <span class='id identifier rubyid_g'>g</span><span class='comma'>,</span> <span class='id identifier rubyid_b'>b</span> <span class='op'>=</span> <span class='lparen'>(</span> <span class='id identifier rubyid_x'>x</span> <span class='op'>+</span> <span class='float'>0.5</span> <span class='rparen'>)</span> <span class='op'>/</span> <span class='const'>N</span><span class='comma'>,</span> <span class='lparen'>(</span> <span class='id identifier rubyid_y'>y</span> <span class='op'>+</span> <span class='float'>0.5</span> <span class='rparen'>)</span> <span class='op'>/</span> <span class='const'>N</span><span class='comma'>,</span> <span class='lparen'>(</span> <span class='id identifier rubyid_z'>z</span> <span class='op'>+</span> <span class='float'>0.5</span> <span class='rparen'>)</span> <span class='op'>/</span> <span class='const'>N</span>
  <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_major'>major</span><span class='lparen'>(</span> <span class='id identifier rubyid_g'>g</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_major'>major</span> <span class='id identifier rubyid_b'>b</span>
<span class='kw'>end</span>
<span class='id identifier rubyid_input'>input</span> <span class='op'>=</span> <span class='const'>V4L2Input</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_modes'>modes</span><span class='op'>|</span>
  <span class='id identifier rubyid_modes'>modes</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_mode'>mode</span><span class='op'>|</span> <span class='id identifier rubyid_mode'>mode</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_rgb?'>rgb?</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_sort_by'>sort_by</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_mode'>mode</span><span class='op'>|</span> <span class='lparen'>(</span><span class='id identifier rubyid_mode'>mode</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>-</span> <span class='const'>WIDTH</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
<span class='kw'>end</span>
<span class='id identifier rubyid_box'>box</span> <span class='op'>=</span> <span class='lbracket'>[</span> <span class='lparen'>(</span> <span class='id identifier rubyid_input'>input</span><span class='period'>.</span><span class='id identifier rubyid_width'>width</span>  <span class='op'>-</span> <span class='const'>BOX_SIZE</span> <span class='rparen'>)</span> <span class='op'>/</span> <span class='int'>2</span> <span class='op'>...</span> <span class='lparen'>(</span> <span class='id identifier rubyid_input'>input</span><span class='period'>.</span><span class='id identifier rubyid_width'>width</span>  <span class='op'>+</span> <span class='const'>BOX_SIZE</span> <span class='rparen'>)</span> <span class='op'>/</span> <span class='int'>2</span><span class='comma'>,</span>
        <span class='lparen'>(</span> <span class='id identifier rubyid_input'>input</span><span class='period'>.</span><span class='id identifier rubyid_height'>height</span> <span class='op'>-</span> <span class='const'>BOX_SIZE</span> <span class='rparen'>)</span> <span class='op'>/</span> <span class='int'>2</span> <span class='op'>...</span> <span class='lparen'>(</span> <span class='id identifier rubyid_input'>input</span><span class='period'>.</span><span class='id identifier rubyid_height'>height</span> <span class='op'>+</span> <span class='const'>BOX_SIZE</span> <span class='rparen'>)</span> <span class='op'>/</span> <span class='int'>2</span> <span class='rbracket'>]</span>
<span class='id identifier rubyid_reference'>reference</span> <span class='op'>=</span> <span class='kw'>nil</span>
<span class='const'>X11Display</span><span class='period'>.</span><span class='id identifier rubyid_show'>show</span> <span class='symbol'>:title</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Capture Reference Histogram</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_img'>img</span> <span class='op'>=</span> <span class='id identifier rubyid_input'>input</span><span class='period'>.</span><span class='id identifier rubyid_read_ubytergb'>read_ubytergb</span><span class='period'>.</span><span class='id identifier rubyid_flip'>flip</span> <span class='int'>0</span>
  <span class='id identifier rubyid_reference'>reference</span> <span class='op'>=</span> <span class='id identifier rubyid_img'>img</span><span class='lbracket'>[</span> <span class='op'>*</span><span class='id identifier rubyid_box'>box</span> <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>
  <span class='id identifier rubyid_img'>img</span><span class='lbracket'>[</span> <span class='op'>*</span><span class='id identifier rubyid_box'>box</span> <span class='rbracket'>]</span> <span class='op'>=</span> <span class='int'>0x80</span> <span class='op'>+</span> <span class='lparen'>(</span> <span class='id identifier rubyid_reference'>reference</span> <span class='op'>&gt;&gt;</span> <span class='int'>1</span> <span class='rparen'>)</span>
  <span class='id identifier rubyid_img'>img</span>
<span class='kw'>end</span>
<span class='id identifier rubyid_histogram'>histogram</span> <span class='op'>=</span> <span class='lparen'>(</span> <span class='id identifier rubyid_reference'>reference</span> <span class='op'>&gt;&gt;</span> <span class='const'>SHIFT</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_lut'>lut</span><span class='lparen'>(</span> <span class='const'>HUE</span><span class='period'>.</span><span class='id identifier rubyid_to_usint'>to_usint</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_histogram'>histogram</span> <span class='int'>360</span>
<span class='id identifier rubyid_flesh_map'>flesh_map</span> <span class='op'>=</span> <span class='lparen'>(</span> <span class='const'>MIN</span> <span class='op'>&gt;=</span> <span class='const'>RANGE</span><span class='period'>.</span><span class='id identifier rubyid_begin'>begin</span> <span class='op'>/</span> <span class='float'>256.0</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_and'>and</span><span class='lparen'>(</span> <span class='const'>MAX</span> <span class='op'>&lt;=</span> <span class='const'>RANGE</span><span class='period'>.</span><span class='id identifier rubyid_end'>end</span> <span class='op'>/</span> <span class='float'>256.0</span> <span class='rparen'>)</span><span class='period'>.</span>
  <span class='id identifier rubyid_conditional'>conditional</span><span class='lparen'>(</span> <span class='const'>HUE</span><span class='period'>.</span><span class='id identifier rubyid_to_usint'>to_usint</span><span class='period'>.</span><span class='id identifier rubyid_lut'>lut</span><span class='lparen'>(</span> <span class='id identifier rubyid_histogram'>histogram</span> <span class='rparen'>)</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rparen'>)</span>
<span class='id identifier rubyid_cx'>cx</span><span class='comma'>,</span> <span class='id identifier rubyid_cy'>cy</span> <span class='op'>=</span> <span class='id identifier rubyid_input'>input</span><span class='period'>.</span><span class='id identifier rubyid_width'>width</span> <span class='op'>/</span> <span class='int'>2</span><span class='comma'>,</span> <span class='id identifier rubyid_input'>input</span><span class='period'>.</span><span class='id identifier rubyid_height'>height</span> <span class='op'>/</span> <span class='int'>2</span>
<span class='id identifier rubyid_w'>w</span><span class='comma'>,</span> <span class='id identifier rubyid_h'>h</span> <span class='op'>=</span> <span class='const'>BOX_SIZE</span><span class='comma'>,</span> <span class='lparen'>(</span> <span class='const'>BOX_SIZE</span> <span class='op'>*</span> <span class='const'>RATIO</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
<span class='const'>X11Display</span><span class='period'>.</span><span class='id identifier rubyid_show'>show</span> <span class='symbol'>:title</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Camshift</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_image'>image</span> <span class='op'>=</span> <span class='id identifier rubyid_input'>input</span><span class='period'>.</span><span class='id identifier rubyid_read_ubytergb'>read_ubytergb</span><span class='period'>.</span><span class='id identifier rubyid_flip'>flip</span> <span class='int'>0</span>
  <span class='id identifier rubyid_n'>n</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_sum'>sum</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_region'>region</span> <span class='op'>=</span> <span class='id identifier rubyid_image'>image</span><span class='lbracket'>[</span> <span class='id identifier rubyid_cx'>cx</span> <span class='op'>-</span> <span class='id identifier rubyid_w'>w</span> <span class='op'>/</span> <span class='int'>2</span> <span class='op'>...</span> <span class='id identifier rubyid_cx'>cx</span> <span class='op'>-</span> <span class='id identifier rubyid_w'>w</span> <span class='op'>/</span> <span class='int'>2</span> <span class='op'>+</span> <span class='id identifier rubyid_w'>w</span><span class='comma'>,</span> <span class='id identifier rubyid_cy'>cy</span> <span class='op'>-</span> <span class='id identifier rubyid_h'>h</span> <span class='op'>/</span> <span class='int'>2</span> <span class='op'>...</span> <span class='id identifier rubyid_cy'>cy</span> <span class='op'>-</span> <span class='id identifier rubyid_h'>h</span> <span class='op'>/</span> <span class='int'>2</span> <span class='op'>+</span> <span class='id identifier rubyid_h'>h</span> <span class='rbracket'>]</span>
    <span class='id identifier rubyid_weight'>weight</span> <span class='op'>=</span> <span class='lparen'>(</span> <span class='id identifier rubyid_region'>region</span> <span class='op'>&gt;&gt;</span> <span class='const'>SHIFT</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_lut'>lut</span> <span class='id identifier rubyid_flesh_map'>flesh_map</span>
    <span class='id identifier rubyid_old_sum'>old_sum</span> <span class='op'>=</span> <span class='id identifier rubyid_sum'>sum</span>
    <span class='id identifier rubyid_sum'>sum</span> <span class='op'>=</span> <span class='id identifier rubyid_weight'>weight</span><span class='period'>.</span><span class='id identifier rubyid_sum'>sum</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_sum'>sum</span> <span class='op'>&gt;</span> <span class='int'>0</span>
      <span class='id identifier rubyid_dx'>dx</span> <span class='op'>=</span> <span class='id identifier rubyid_sum'>sum</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span><span class='id identifier rubyid_j'>j</span><span class='op'>|</span> <span class='id identifier rubyid_weight'>weight</span><span class='lbracket'>[</span> <span class='id identifier rubyid_i'>i</span><span class='comma'>,</span> <span class='id identifier rubyid_j'>j</span> <span class='rbracket'>]</span> <span class='op'>*</span> <span class='id identifier rubyid_i'>i</span> <span class='rbrace'>}</span> <span class='op'>/</span> <span class='id identifier rubyid_sum'>sum</span>
      <span class='id identifier rubyid_dy'>dy</span> <span class='op'>=</span> <span class='id identifier rubyid_sum'>sum</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span><span class='id identifier rubyid_j'>j</span><span class='op'>|</span> <span class='id identifier rubyid_weight'>weight</span><span class='lbracket'>[</span> <span class='id identifier rubyid_i'>i</span><span class='comma'>,</span> <span class='id identifier rubyid_j'>j</span> <span class='rbracket'>]</span> <span class='op'>*</span> <span class='id identifier rubyid_j'>j</span> <span class='rbrace'>}</span> <span class='op'>/</span> <span class='id identifier rubyid_sum'>sum</span>
      <span class='id identifier rubyid_cx'>cx</span> <span class='op'>=</span> <span class='id identifier rubyid_cx'>cx</span> <span class='op'>+</span> <span class='id identifier rubyid_dx'>dx</span> <span class='op'>-</span> <span class='id identifier rubyid_w'>w</span> <span class='op'>/</span> <span class='int'>2</span>
      <span class='id identifier rubyid_cy'>cy</span> <span class='op'>=</span> <span class='id identifier rubyid_cy'>cy</span> <span class='op'>+</span> <span class='id identifier rubyid_dy'>dy</span> <span class='op'>-</span> <span class='id identifier rubyid_h'>h</span> <span class='op'>/</span> <span class='int'>2</span>
      <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='int'>2</span> <span class='op'>*</span> <span class='const'><span class='object_link'><a href="Math.html" title="Math (module)">Math</a></span></span><span class='period'>.</span><span class='id identifier rubyid_sqrt'><span class='object_link'><a href="Math.html#sqrt-class_method" title="Math.sqrt (method)">sqrt</a></span></span><span class='lparen'>(</span> <span class='id identifier rubyid_sum'>sum</span> <span class='op'>/</span> <span class='id identifier rubyid_flesh_map'>flesh_map</span><span class='period'>.</span><span class='id identifier rubyid_max'>max</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span> <span class='op'>/</span> <span class='const'>RATIO</span> <span class='rparen'>)</span>
      <span class='id identifier rubyid_w'>w</span><span class='comma'>,</span> <span class='id identifier rubyid_h'>h</span> <span class='op'>=</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='comma'>,</span> <span class='lparen'>(</span> <span class='id identifier rubyid_s'>s</span> <span class='op'>*</span> <span class='const'>RATIO</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
      <span class='id identifier rubyid_w'>w</span> <span class='op'>=</span> <span class='lbracket'>[</span> <span class='lbracket'>[</span> <span class='id identifier rubyid_w'>w</span><span class='comma'>,</span> <span class='int'>3</span> <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_max'>max</span><span class='comma'>,</span> <span class='id identifier rubyid_input'>input</span><span class='period'>.</span><span class='id identifier rubyid_width'>width</span> <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_min'>min</span>
      <span class='id identifier rubyid_h'>h</span> <span class='op'>=</span> <span class='lbracket'>[</span> <span class='lbracket'>[</span> <span class='id identifier rubyid_h'>h</span><span class='comma'>,</span> <span class='int'>3</span> <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_max'>max</span><span class='comma'>,</span> <span class='id identifier rubyid_input'>input</span><span class='period'>.</span><span class='id identifier rubyid_height'>height</span> <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_min'>min</span>
      <span class='id identifier rubyid_cx'>cx</span> <span class='op'>=</span> <span class='lbracket'>[</span> <span class='lbracket'>[</span> <span class='id identifier rubyid_cx'>cx</span><span class='comma'>,</span> <span class='id identifier rubyid_w'>w</span> <span class='op'>/</span> <span class='int'>2</span> <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_max'>max</span><span class='comma'>,</span> <span class='id identifier rubyid_input'>input</span><span class='period'>.</span><span class='id identifier rubyid_width'>width</span>  <span class='op'>-</span> <span class='id identifier rubyid_w'>w</span> <span class='op'>+</span> <span class='id identifier rubyid_w'>w</span> <span class='op'>/</span> <span class='int'>2</span> <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_min'>min</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
      <span class='id identifier rubyid_cy'>cy</span> <span class='op'>=</span> <span class='lbracket'>[</span> <span class='lbracket'>[</span> <span class='id identifier rubyid_cy'>cy</span><span class='comma'>,</span> <span class='id identifier rubyid_h'>h</span> <span class='op'>/</span> <span class='int'>2</span> <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_max'>max</span><span class='comma'>,</span> <span class='id identifier rubyid_input'>input</span><span class='period'>.</span><span class='id identifier rubyid_height'>height</span> <span class='op'>-</span> <span class='id identifier rubyid_h'>h</span> <span class='op'>+</span> <span class='id identifier rubyid_h'>h</span> <span class='op'>/</span> <span class='int'>2</span> <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_min'>min</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_n'>n</span> <span class='op'>+=</span> <span class='int'>1</span>
  <span class='kw'>end</span> <span class='kw'>while</span> <span class='id identifier rubyid_old_sum'>old_sum</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_sum'>sum</span> <span class='kw'>and</span> <span class='id identifier rubyid_n'>n</span> <span class='op'>&lt;</span> <span class='const'>MAX_ITER</span> 
  <span class='id identifier rubyid_image'>image</span><span class='lbracket'>[</span> <span class='id identifier rubyid_cx'>cx</span> <span class='op'>-</span> <span class='id identifier rubyid_w'>w</span> <span class='op'>/</span> <span class='int'>2</span> <span class='op'>...</span> <span class='id identifier rubyid_cx'>cx</span> <span class='op'>-</span> <span class='id identifier rubyid_w'>w</span> <span class='op'>/</span> <span class='int'>2</span> <span class='op'>+</span> <span class='id identifier rubyid_w'>w</span><span class='comma'>,</span> <span class='id identifier rubyid_cy'>cy</span> <span class='op'>-</span> <span class='id identifier rubyid_h'>h</span> <span class='op'>/</span> <span class='int'>2</span> <span class='op'>...</span> <span class='id identifier rubyid_cy'>cy</span> <span class='op'>-</span> <span class='id identifier rubyid_h'>h</span> <span class='op'>/</span> <span class='int'>2</span> <span class='op'>+</span> <span class='id identifier rubyid_h'>h</span> <span class='rbracket'>]</span> <span class='op'>/=</span> <span class='int'>2</span>
  <span class='id identifier rubyid_image'>image</span>
<span class='kw'>end</span>
</code></pre>

<h2 id="label-Lucas-Kanade+Tracker">Lucas-Kanade Tracker</h2>

<p><img src="images/lktracker.png"></p>

<p>This is an implementation of the (inverse compositional) Lucas-Kanade algorithm. The Lucas-Kanade algorithm iteratively tries to minimise the difference between the template and a warped image. The technique can be used for image alignment, tracking, optic flow analysis, and motion estimation. Possible improvements are to incorporate illumination changes and a proper threatment of the image boundaries.</p>

<p>The example offers five different models</p>
<ol><li>
<p>shift</p>
</li><li>
<p>shift and scale</p>
</li><li>
<p>shift and rotation</p>
</li><li>
<p>affine transform</p>
</li><li>
<p>2-d homography</p>
</li></ol>

<p>A video for testing can be created using PovRay and the files <a href="polygon.ini">polygon.ini</a> and <a href="polygon.pov">polygon.pov</a>.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>matrix</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_ffmpeg</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_rmagick</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_xorg</span><span class='tstring_end'>&#39;</span></span>
<span class='comment'>#require &#39;matrix_fix&#39;
</span><span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="Hornetseye.html" title="Hornetseye (module)">Hornetseye</a></span></span>
<span class='id identifier rubyid_syntax'>syntax</span> <span class='op'>=</span> <span class='heredoc_beg'>&lt;&lt;END_OF_STRING</span>
<span class='tstring_content'>Align images using phase correlation
Syntax: lktracker.rb &lt;video&gt; &lt;backgr.&gt; &lt;model&gt; &lt;width&gt; &lt;height&gt; &lt;p1&gt; &lt;p2&gt; ...
Examples:
  ./lktracker.rb polygon.avi shift 94 65 80 35
  ./lktracker.rb polygon.avi shift-n-scale 94 65 80 35 1 1
  ./lktracker.rb polygon.avi isometry 94 65 80 35 0
  ./lktracker.rb polygon.avi rotate-n-scale 94 65 80 35 0 1
  ./lktracker.rb polygon.avi affine 94 65 80 35 1 0 0 1
  ./lktracker.rb polygon.avi homography 94 65 1 0 0 1 80 35 0 0
</span><span class='heredoc_end'>END_OF_STRING
</span><span class='kw'>if</span> <span class='const'>ARGV</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&lt;</span> <span class='int'>2</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_syntax'>syntax</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Wrong number of command-line arguments</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span>
<span class='kw'>class</span> <span class='const'>Node</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_warp_clipped_interpolate'>warp_clipped_interpolate</span><span class='lparen'>(</span> <span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='id identifier rubyid_y'>y</span> <span class='rparen'>)</span>
    <span class='id identifier rubyid_x0'>x0</span> <span class='op'>=</span> <span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_floor'>floor</span><span class='period'>.</span><span class='id identifier rubyid_to_int'>to_int</span>
    <span class='id identifier rubyid_y0'>y0</span> <span class='op'>=</span> <span class='id identifier rubyid_y'>y</span><span class='period'>.</span><span class='id identifier rubyid_floor'>floor</span><span class='period'>.</span><span class='id identifier rubyid_to_int'>to_int</span>
    <span class='id identifier rubyid_x1'>x1</span> <span class='op'>=</span> <span class='id identifier rubyid_x0'>x0</span> <span class='op'>+</span> <span class='int'>1</span>
    <span class='id identifier rubyid_y1'>y1</span> <span class='op'>=</span> <span class='id identifier rubyid_y0'>y0</span> <span class='op'>+</span> <span class='int'>1</span>
    <span class='id identifier rubyid_fx1'>fx1</span> <span class='op'>=</span> <span class='id identifier rubyid_x'>x</span> <span class='op'>-</span> <span class='id identifier rubyid_x0'>x0</span>
    <span class='id identifier rubyid_fy1'>fy1</span> <span class='op'>=</span> <span class='id identifier rubyid_y'>y</span> <span class='op'>-</span> <span class='id identifier rubyid_y0'>y0</span>
    <span class='id identifier rubyid_fx0'>fx0</span> <span class='op'>=</span> <span class='id identifier rubyid_x1'>x1</span> <span class='op'>-</span> <span class='id identifier rubyid_x'>x</span>
    <span class='id identifier rubyid_fy0'>fy0</span> <span class='op'>=</span> <span class='id identifier rubyid_y1'>y1</span> <span class='op'>-</span> <span class='id identifier rubyid_y'>y</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_warp'>warp</span><span class='lparen'>(</span> <span class='id identifier rubyid_x0'>x0</span><span class='comma'>,</span> <span class='id identifier rubyid_y0'>y0</span> <span class='rparen'>)</span> <span class='op'>*</span> <span class='id identifier rubyid_fx0'>fx0</span> <span class='op'>*</span> <span class='id identifier rubyid_fy0'>fy0</span> <span class='op'>+</span>
           <span class='id identifier rubyid_warp'>warp</span><span class='lparen'>(</span> <span class='id identifier rubyid_x1'>x1</span><span class='comma'>,</span> <span class='id identifier rubyid_y0'>y0</span> <span class='rparen'>)</span> <span class='op'>*</span> <span class='id identifier rubyid_fx1'>fx1</span> <span class='op'>*</span> <span class='id identifier rubyid_fy0'>fy0</span> <span class='op'>+</span>
           <span class='id identifier rubyid_warp'>warp</span><span class='lparen'>(</span> <span class='id identifier rubyid_x0'>x0</span><span class='comma'>,</span> <span class='id identifier rubyid_y1'>y1</span> <span class='rparen'>)</span> <span class='op'>*</span> <span class='id identifier rubyid_fx0'>fx0</span> <span class='op'>*</span> <span class='id identifier rubyid_fy1'>fy1</span> <span class='op'>+</span>
           <span class='id identifier rubyid_warp'>warp</span><span class='lparen'>(</span> <span class='id identifier rubyid_x1'>x1</span><span class='comma'>,</span> <span class='id identifier rubyid_y1'>y1</span> <span class='rparen'>)</span> <span class='op'>*</span> <span class='id identifier rubyid_fx1'>fx1</span> <span class='op'>*</span> <span class='id identifier rubyid_fy1'>fy1</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
<span class='id identifier rubyid_input'>input</span> <span class='op'>=</span> <span class='const'>AVInput</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='const'>ARGV</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
<span class='id identifier rubyid_w'>w</span><span class='comma'>,</span> <span class='id identifier rubyid_h'>h</span> <span class='op'>=</span> <span class='const'>ARGV</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='comma'>,</span> <span class='const'>ARGV</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
<span class='kw'>case</span> <span class='const'>ARGV</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
<span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>shift</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Shifting model requires 2 parameters</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='const'>ARGV</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>!=</span> <span class='int'>6</span>
  <span class='id identifier rubyid_p'>p</span> <span class='op'>=</span> <span class='const'>Vector</span><span class='lbracket'>[</span> <span class='op'>*</span><span class='const'>ARGV</span><span class='lbracket'>[</span><span class='int'>4</span><span class='op'>...</span><span class='int'>6</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_a'>a</span><span class='op'>|</span> <span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span> <span class='rbrace'>}</span> <span class='rbracket'>]</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_model'>model</span><span class='lparen'>(</span> <span class='id identifier rubyid_p'>p</span><span class='comma'>,</span> <span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='id identifier rubyid_y'>y</span> <span class='rparen'>)</span>
    <span class='const'>Vector</span><span class='lbracket'>[</span> <span class='id identifier rubyid_x'>x</span> <span class='op'>+</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_y'>y</span> <span class='op'>+</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='rbracket'>]</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_derivative'>derivative</span><span class='lparen'>(</span> <span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='id identifier rubyid_y'>y</span> <span class='rparen'>)</span> <span class='comment'># derivative at p = [ 0, 0 ]
</span>    <span class='const'>Matrix</span><span class='lbracket'>[</span> <span class='lbracket'>[</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span> <span class='rbracket'>]</span> <span class='rbracket'>]</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_compose'>compose</span><span class='lparen'>(</span> <span class='id identifier rubyid_p'>p</span><span class='comma'>,</span> <span class='id identifier rubyid_d'>d</span> <span class='rparen'>)</span>
    <span class='id identifier rubyid_p'>p</span> <span class='op'>+</span> <span class='id identifier rubyid_d'>d</span>
  <span class='kw'>end</span>
<span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>shift-n-scale</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Shift-and-scale model requires 4 parameters</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='const'>ARGV</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>!=</span> <span class='int'>8</span>
  <span class='id identifier rubyid_p'>p</span> <span class='op'>=</span> <span class='const'>Vector</span><span class='lbracket'>[</span> <span class='op'>*</span><span class='const'>ARGV</span><span class='lbracket'>[</span><span class='int'>4</span><span class='op'>...</span><span class='int'>8</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_a'>a</span><span class='op'>|</span> <span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span> <span class='rbrace'>}</span> <span class='rbracket'>]</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_model'>model</span><span class='lparen'>(</span> <span class='id identifier rubyid_p'>p</span><span class='comma'>,</span> <span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='id identifier rubyid_y'>y</span> <span class='rparen'>)</span>
    <span class='const'>Vector</span><span class='lbracket'>[</span> <span class='id identifier rubyid_x'>x</span> <span class='op'>*</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_y'>y</span> <span class='op'>*</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='rbracket'>]</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_derivative'>derivative</span><span class='lparen'>(</span> <span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='id identifier rubyid_y'>y</span> <span class='rparen'>)</span> <span class='comment'># derivative at p = [ 0, 0, 1, 1 ]
</span>    <span class='const'>Matrix</span><span class='lbracket'>[</span> <span class='lbracket'>[</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span> <span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span> <span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_y'>y</span> <span class='rbracket'>]</span> <span class='rbracket'>]</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_compose'>compose</span><span class='lparen'>(</span> <span class='id identifier rubyid_p'>p</span><span class='comma'>,</span> <span class='id identifier rubyid_d'>d</span> <span class='rparen'>)</span>
    <span class='id identifier rubyid_p'>p</span> <span class='op'>+</span> <span class='const'>Vector</span><span class='lbracket'>[</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span> <span class='rbracket'>]</span>
  <span class='kw'>end</span>
<span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>isometry</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Isometric model requires 3 parameters</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='const'>ARGV</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>!=</span> <span class='int'>7</span>
  <span class='id identifier rubyid_p'>p</span> <span class='op'>=</span> <span class='const'>Vector</span><span class='lbracket'>[</span> <span class='op'>*</span><span class='const'>ARGV</span><span class='lbracket'>[</span><span class='int'>4</span><span class='op'>...</span><span class='int'>7</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_a'>a</span><span class='op'>|</span> <span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span> <span class='rbrace'>}</span> <span class='rbracket'>]</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_model'>model</span><span class='lparen'>(</span> <span class='id identifier rubyid_p'>p</span><span class='comma'>,</span> <span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='id identifier rubyid_y'>y</span> <span class='rparen'>)</span>
    <span class='id identifier rubyid_cw'>cw</span><span class='comma'>,</span> <span class='id identifier rubyid_sw'>sw</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Math.html" title="Math (module)">Math</a></span></span><span class='op'>::</span><span class='id identifier rubyid_cos'><span class='object_link'><a href="Math.html#cos-class_method" title="Math.cos (method)">cos</a></span></span><span class='lparen'>(</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span> <span class='rparen'>)</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Math.html" title="Math (module)">Math</a></span></span><span class='op'>::</span><span class='id identifier rubyid_sin'><span class='object_link'><a href="Math.html#sin-class_method" title="Math.sin (method)">sin</a></span></span><span class='lparen'>(</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span> <span class='rparen'>)</span>
    <span class='const'>Vector</span><span class='lbracket'>[</span> <span class='id identifier rubyid_x'>x</span> <span class='op'>*</span> <span class='id identifier rubyid_cw'>cw</span> <span class='op'>-</span> <span class='id identifier rubyid_y'>y</span> <span class='op'>*</span> <span class='id identifier rubyid_sw'>sw</span> <span class='op'>+</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_x'>x</span> <span class='op'>*</span> <span class='id identifier rubyid_sw'>sw</span> <span class='op'>+</span> <span class='id identifier rubyid_y'>y</span> <span class='op'>*</span> <span class='id identifier rubyid_cw'>cw</span> <span class='op'>+</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='rbracket'>]</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_derivative'>derivative</span><span class='lparen'>(</span> <span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='id identifier rubyid_y'>y</span> <span class='rparen'>)</span> <span class='comment'># derivative at p = [ 0, 0, 0 ]
</span>    <span class='const'>Matrix</span><span class='lbracket'>[</span> <span class='lbracket'>[</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span> <span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span> <span class='op'>-</span><span class='id identifier rubyid_y'>y</span><span class='comma'>,</span> <span class='id identifier rubyid_x'>x</span> <span class='rbracket'>]</span> <span class='rbracket'>]</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_compose'>compose</span><span class='lparen'>(</span> <span class='id identifier rubyid_p'>p</span><span class='comma'>,</span> <span class='id identifier rubyid_d'>d</span> <span class='rparen'>)</span>
    <span class='id identifier rubyid_cw'>cw</span><span class='comma'>,</span> <span class='id identifier rubyid_sw'>sw</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Math.html" title="Math (module)">Math</a></span></span><span class='op'>::</span><span class='id identifier rubyid_cos'><span class='object_link'><a href="Math.html#cos-class_method" title="Math.cos (method)">cos</a></span></span><span class='lparen'>(</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span> <span class='rparen'>)</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Math.html" title="Math (module)">Math</a></span></span><span class='op'>::</span><span class='id identifier rubyid_sin'><span class='object_link'><a href="Math.html#sin-class_method" title="Math.sin (method)">sin</a></span></span><span class='lparen'>(</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span> <span class='rparen'>)</span>
    <span class='id identifier rubyid_p'>p</span> <span class='op'>+</span> <span class='const'>Matrix</span><span class='lbracket'>[</span> <span class='lbracket'>[</span>  <span class='id identifier rubyid_cw'>cw</span><span class='comma'>,</span> <span class='op'>-</span><span class='id identifier rubyid_sw'>sw</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                <span class='lbracket'>[</span>  <span class='id identifier rubyid_sw'>sw</span><span class='comma'>,</span>  <span class='id identifier rubyid_cw'>cw</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                <span class='lbracket'>[</span>   <span class='int'>0</span><span class='comma'>,</span>   <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span> <span class='rbracket'>]</span> <span class='rbracket'>]</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span>
  <span class='kw'>end</span>
<span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rotate-n-scale</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Isometric model requires 3 parameters</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='const'>ARGV</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>!=</span> <span class='int'>8</span>
  <span class='id identifier rubyid_p'>p</span> <span class='op'>=</span> <span class='const'>Vector</span><span class='lbracket'>[</span> <span class='op'>*</span><span class='const'>ARGV</span><span class='lbracket'>[</span><span class='int'>4</span><span class='op'>...</span><span class='int'>8</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_a'>a</span><span class='op'>|</span> <span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span> <span class='rbrace'>}</span> <span class='rbracket'>]</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_model'>model</span><span class='lparen'>(</span> <span class='id identifier rubyid_p'>p</span><span class='comma'>,</span> <span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='id identifier rubyid_y'>y</span> <span class='rparen'>)</span>
    <span class='id identifier rubyid_cw'>cw</span><span class='comma'>,</span> <span class='id identifier rubyid_sw'>sw</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Math.html" title="Math (module)">Math</a></span></span><span class='op'>::</span><span class='id identifier rubyid_cos'><span class='object_link'><a href="Math.html#cos-class_method" title="Math.cos (method)">cos</a></span></span><span class='lparen'>(</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span> <span class='rparen'>)</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Math.html" title="Math (module)">Math</a></span></span><span class='op'>::</span><span class='id identifier rubyid_sin'><span class='object_link'><a href="Math.html#sin-class_method" title="Math.sin (method)">sin</a></span></span><span class='lparen'>(</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span> <span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span>
    <span class='const'>Vector</span><span class='lbracket'>[</span> <span class='id identifier rubyid_x'>x</span> <span class='op'>*</span> <span class='id identifier rubyid_cw'>cw</span> <span class='op'>*</span> <span class='id identifier rubyid_s'>s</span> <span class='op'>-</span> <span class='id identifier rubyid_y'>y</span> <span class='op'>*</span> <span class='id identifier rubyid_sw'>sw</span> <span class='op'>*</span> <span class='id identifier rubyid_s'>s</span> <span class='op'>+</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_x'>x</span> <span class='op'>*</span> <span class='id identifier rubyid_sw'>sw</span> <span class='op'>*</span> <span class='id identifier rubyid_s'>s</span> <span class='op'>+</span> <span class='id identifier rubyid_y'>y</span> <span class='op'>*</span> <span class='id identifier rubyid_cw'>cw</span> <span class='op'>*</span> <span class='id identifier rubyid_s'>s</span> <span class='op'>+</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='rbracket'>]</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_derivative'>derivative</span><span class='lparen'>(</span> <span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='id identifier rubyid_y'>y</span> <span class='rparen'>)</span> <span class='comment'># derivative at p = [ 0, 0, 0 ]
</span>    <span class='const'>Matrix</span><span class='lbracket'>[</span> <span class='lbracket'>[</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span> <span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span> <span class='op'>-</span><span class='id identifier rubyid_y'>y</span><span class='comma'>,</span> <span class='id identifier rubyid_x'>x</span> <span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span> <span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='id identifier rubyid_y'>y</span> <span class='rbracket'>]</span> <span class='rbracket'>]</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_compose'>compose</span><span class='lparen'>(</span> <span class='id identifier rubyid_p'>p</span><span class='comma'>,</span> <span class='id identifier rubyid_d'>d</span> <span class='rparen'>)</span>
    <span class='id identifier rubyid_cw'>cw</span><span class='comma'>,</span> <span class='id identifier rubyid_sw'>sw</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Math.html" title="Math (module)">Math</a></span></span><span class='op'>::</span><span class='id identifier rubyid_cos'><span class='object_link'><a href="Math.html#cos-class_method" title="Math.cos (method)">cos</a></span></span><span class='lparen'>(</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span> <span class='rparen'>)</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Math.html" title="Math (module)">Math</a></span></span><span class='op'>::</span><span class='id identifier rubyid_sin'><span class='object_link'><a href="Math.html#sin-class_method" title="Math.sin (method)">sin</a></span></span><span class='lparen'>(</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span> <span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_p'>p</span> <span class='op'>+</span> <span class='const'>Matrix</span><span class='lbracket'>[</span> <span class='lbracket'>[</span>  <span class='id identifier rubyid_cw'>cw</span><span class='comma'>,</span> <span class='op'>-</span><span class='id identifier rubyid_sw'>sw</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                <span class='lbracket'>[</span>  <span class='id identifier rubyid_sw'>sw</span><span class='comma'>,</span>  <span class='id identifier rubyid_cw'>cw</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                <span class='lbracket'>[</span>   <span class='int'>0</span><span class='comma'>,</span>   <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                <span class='lbracket'>[</span>   <span class='int'>0</span><span class='comma'>,</span>   <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span> <span class='rbracket'>]</span> <span class='rbracket'>]</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span>
  <span class='kw'>end</span>
<span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>affine</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Affine model requires 6 parameters</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='const'>ARGV</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>!=</span> <span class='int'>10</span>
  <span class='id identifier rubyid_p'>p</span> <span class='op'>=</span> <span class='const'>Vector</span><span class='lbracket'>[</span> <span class='op'>*</span><span class='const'>ARGV</span><span class='lbracket'>[</span><span class='int'>4</span><span class='op'>...</span><span class='int'>10</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_a'>a</span><span class='op'>|</span> <span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span> <span class='rbrace'>}</span> <span class='rbracket'>]</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_model'>model</span><span class='lparen'>(</span> <span class='id identifier rubyid_p'>p</span><span class='comma'>,</span> <span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='id identifier rubyid_y'>y</span> <span class='rparen'>)</span>
    <span class='const'>Vector</span><span class='lbracket'>[</span> <span class='id identifier rubyid_x'>x</span> <span class='op'>*</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='id identifier rubyid_y'>y</span> <span class='op'>*</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>4</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_x'>x</span> <span class='op'>*</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='id identifier rubyid_y'>y</span> <span class='op'>*</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>5</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='rbracket'>]</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_derivative'>derivative</span><span class='lparen'>(</span> <span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='id identifier rubyid_y'>y</span> <span class='rparen'>)</span> <span class='comment'># derivative at p = [ 0, 0, 1, 0, 0, 1 ]
</span>    <span class='const'>Matrix</span><span class='lbracket'>[</span> <span class='lbracket'>[</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span> <span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span> <span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_x'>x</span> <span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span> <span class='id identifier rubyid_y'>y</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_y'>y</span> <span class='rbracket'>]</span> <span class='rbracket'>]</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_compose'>compose</span><span class='lparen'>(</span> <span class='id identifier rubyid_p'>p</span><span class='comma'>,</span> <span class='id identifier rubyid_d'>d</span> <span class='rparen'>)</span>
    <span class='id identifier rubyid_p'>p</span> <span class='op'>+</span> <span class='const'>Matrix</span><span class='lbracket'>[</span> <span class='lbracket'>[</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>4</span><span class='rbracket'>]</span><span class='comma'>,</span>    <span class='int'>0</span><span class='comma'>,</span>    <span class='int'>0</span><span class='comma'>,</span>    <span class='int'>0</span><span class='comma'>,</span>    <span class='int'>0</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                <span class='lbracket'>[</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>5</span><span class='rbracket'>]</span><span class='comma'>,</span>    <span class='int'>0</span><span class='comma'>,</span>    <span class='int'>0</span><span class='comma'>,</span>    <span class='int'>0</span><span class='comma'>,</span>    <span class='int'>0</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                <span class='lbracket'>[</span>    <span class='int'>0</span><span class='comma'>,</span>    <span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>4</span><span class='rbracket'>]</span><span class='comma'>,</span>    <span class='int'>0</span><span class='comma'>,</span>    <span class='int'>0</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                <span class='lbracket'>[</span>    <span class='int'>0</span><span class='comma'>,</span>    <span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>5</span><span class='rbracket'>]</span><span class='comma'>,</span>    <span class='int'>0</span><span class='comma'>,</span>    <span class='int'>0</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                <span class='lbracket'>[</span>    <span class='int'>0</span><span class='comma'>,</span>    <span class='int'>0</span><span class='comma'>,</span>    <span class='int'>0</span><span class='comma'>,</span>    <span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>4</span><span class='rbracket'>]</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                <span class='lbracket'>[</span>    <span class='int'>0</span><span class='comma'>,</span>    <span class='int'>0</span><span class='comma'>,</span>    <span class='int'>0</span><span class='comma'>,</span>    <span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>5</span><span class='rbracket'>]</span> <span class='rbracket'>]</span> <span class='rbracket'>]</span> <span class='op'>*</span> <span class='id identifier rubyid_d'>d</span>
  <span class='kw'>end</span>
<span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>homography</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Homography requires 8 parameters</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='const'>ARGV</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>!=</span> <span class='int'>12</span>
  <span class='id identifier rubyid_p'>p</span> <span class='op'>=</span> <span class='const'>Vector</span><span class='lbracket'>[</span> <span class='op'>*</span><span class='const'>ARGV</span><span class='lbracket'>[</span><span class='int'>4</span><span class='op'>...</span><span class='int'>12</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_a'>a</span><span class='op'>|</span> <span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span> <span class='rbrace'>}</span> <span class='rbracket'>]</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_model'>model</span><span class='lparen'>(</span> <span class='id identifier rubyid_p'>p</span><span class='comma'>,</span> <span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='id identifier rubyid_y'>y</span> <span class='rparen'>)</span>
    <span class='id identifier rubyid_h'>h</span> <span class='op'>=</span> <span class='const'>Matrix</span><span class='lbracket'>[</span> <span class='lbracket'>[</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>4</span><span class='rbracket'>]</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                <span class='lbracket'>[</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>5</span><span class='rbracket'>]</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                <span class='lbracket'>[</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>6</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>7</span><span class='rbracket'>]</span><span class='comma'>,</span>    <span class='int'>1</span> <span class='rbracket'>]</span> <span class='rbracket'>]</span>
    <span class='id identifier rubyid_rh'>rh</span> <span class='op'>=</span> <span class='id identifier rubyid_h'>h</span> <span class='op'>*</span> <span class='const'>Vector</span><span class='lbracket'>[</span> <span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='id identifier rubyid_y'>y</span><span class='comma'>,</span> <span class='int'>1</span> <span class='rbracket'>]</span>
    <span class='const'>Vector</span><span class='lbracket'>[</span> <span class='id identifier rubyid_rh'>rh</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>/</span> <span class='id identifier rubyid_rh'>rh</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_rh'>rh</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>/</span> <span class='id identifier rubyid_rh'>rh</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span> <span class='rbracket'>]</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_derivative'>derivative</span><span class='lparen'>(</span> <span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='id identifier rubyid_y'>y</span> <span class='rparen'>)</span>
    <span class='const'>Matrix</span><span class='lbracket'>[</span>
      <span class='lbracket'>[</span> <span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_x'>x</span> <span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span> <span class='id identifier rubyid_y'>y</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_y'>y</span> <span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span> <span class='rbracket'>]</span><span class='comma'>,</span>
      <span class='lbracket'>[</span> <span class='op'>-</span><span class='id identifier rubyid_x'>x</span> <span class='op'>*</span> <span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='op'>-</span><span class='id identifier rubyid_x'>x</span> <span class='op'>*</span> <span class='id identifier rubyid_y'>y</span> <span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span> <span class='op'>-</span><span class='id identifier rubyid_y'>y</span> <span class='op'>*</span> <span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='op'>-</span><span class='id identifier rubyid_y'>y</span> <span class='op'>*</span> <span class='id identifier rubyid_y'>y</span> <span class='rbracket'>]</span> <span class='rbracket'>]</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_compose'>compose</span><span class='lparen'>(</span> <span class='id identifier rubyid_p'>p</span><span class='comma'>,</span> <span class='id identifier rubyid_d'>d</span> <span class='rparen'>)</span>
    <span class='id identifier rubyid_h'>h</span> <span class='op'>=</span> <span class='const'>Matrix</span><span class='lbracket'>[</span> <span class='lbracket'>[</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>4</span><span class='rbracket'>]</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                <span class='lbracket'>[</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>5</span><span class='rbracket'>]</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                <span class='lbracket'>[</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>6</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>7</span><span class='rbracket'>]</span><span class='comma'>,</span>    <span class='int'>1</span> <span class='rbracket'>]</span> <span class='rbracket'>]</span>
    <span class='id identifier rubyid_hd'>hd</span> <span class='op'>=</span> <span class='const'>Matrix</span><span class='lbracket'>[</span> <span class='lbracket'>[</span> <span class='int'>1</span> <span class='op'>+</span> <span class='id identifier rubyid_d'>d</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span>     <span class='id identifier rubyid_d'>d</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_d'>d</span><span class='lbracket'>[</span><span class='int'>4</span><span class='rbracket'>]</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                 <span class='lbracket'>[</span>     <span class='id identifier rubyid_d'>d</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='int'>1</span> <span class='op'>+</span> <span class='id identifier rubyid_d'>d</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_d'>d</span><span class='lbracket'>[</span><span class='int'>5</span><span class='rbracket'>]</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                 <span class='lbracket'>[</span>     <span class='id identifier rubyid_d'>d</span><span class='lbracket'>[</span><span class='int'>6</span><span class='rbracket'>]</span><span class='comma'>,</span>     <span class='id identifier rubyid_d'>d</span><span class='lbracket'>[</span><span class='int'>7</span><span class='rbracket'>]</span><span class='comma'>,</span>    <span class='int'>1</span> <span class='rbracket'>]</span> <span class='rbracket'>]</span>
    <span class='id identifier rubyid_hr'>hr</span> <span class='op'>=</span> <span class='id identifier rubyid_h'>h</span> <span class='op'>*</span> <span class='id identifier rubyid_hd'>hd</span>
    <span class='id identifier rubyid_hr'>hr</span> <span class='op'>=</span> <span class='id identifier rubyid_hr'>hr</span> <span class='op'>/</span> <span class='id identifier rubyid_hr'>hr</span><span class='lbracket'>[</span><span class='int'>2</span><span class='comma'>,</span><span class='int'>2</span><span class='rbracket'>]</span>
    <span class='const'>Vector</span><span class='lbracket'>[</span> <span class='id identifier rubyid_hr'>hr</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_hr'>hr</span><span class='lbracket'>[</span><span class='int'>1</span><span class='comma'>,</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_hr'>hr</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_hr'>hr</span><span class='lbracket'>[</span><span class='int'>1</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span><span class='comma'>,</span>
      <span class='id identifier rubyid_hr'>hr</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>2</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_hr'>hr</span><span class='lbracket'>[</span><span class='int'>1</span><span class='comma'>,</span><span class='int'>2</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_hr'>hr</span><span class='lbracket'>[</span><span class='int'>2</span><span class='comma'>,</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_hr'>hr</span><span class='lbracket'>[</span><span class='int'>2</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='rbracket'>]</span>
  <span class='kw'>end</span>
<span class='kw'>else</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No such model (</span><span class='embexpr_beg'>#{</span><span class='const'>ARGV</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
<span class='id identifier rubyid_img'>img</span> <span class='op'>=</span> <span class='id identifier rubyid_input'>input</span><span class='period'>.</span><span class='id identifier rubyid_read_ubyte'>read_ubyte</span>
<span class='id identifier rubyid_sigma'>sigma</span> <span class='op'>=</span> <span class='float'>2.5</span>
<span class='comment'># compute gradient on a larger field and crop later to avoid fringe effects.
</span><span class='id identifier rubyid_b'>b</span> <span class='op'>=</span> <span class='lparen'>(</span> <span class='const'><span class='object_link'><a href="Array.html" title="Array (class)">Array</a></span></span><span class='period'>.</span><span class='id identifier rubyid_gauss_gradient_filter'><span class='object_link'><a href="Array.html#gauss_gradient_filter-class_method" title="Array.gauss_gradient_filter (method)">gauss_gradient_filter</a></span></span><span class='lparen'>(</span> <span class='id identifier rubyid_sigma'>sigma</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>-</span> <span class='int'>1</span> <span class='rparen'>)</span> <span class='op'>/</span> <span class='int'>2</span>
<span class='id identifier rubyid_x'>x</span> <span class='op'>=</span> <span class='id identifier rubyid_lazy'>lazy</span><span class='lparen'>(</span> <span class='id identifier rubyid_w'>w</span> <span class='op'>+</span> <span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_b'>b</span><span class='comma'>,</span> <span class='id identifier rubyid_h'>h</span> <span class='op'>+</span> <span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_b'>b</span> <span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span><span class='id identifier rubyid_j'>j</span><span class='op'>|</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>-</span> <span class='id identifier rubyid_b'>b</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_y'>y</span> <span class='op'>=</span> <span class='id identifier rubyid_lazy'>lazy</span><span class='lparen'>(</span> <span class='id identifier rubyid_w'>w</span> <span class='op'>+</span> <span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_b'>b</span><span class='comma'>,</span> <span class='id identifier rubyid_h'>h</span> <span class='op'>+</span> <span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_b'>b</span> <span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span><span class='id identifier rubyid_j'>j</span><span class='op'>|</span> <span class='id identifier rubyid_j'>j</span> <span class='op'>-</span> <span class='id identifier rubyid_b'>b</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_tpl'>tpl</span> <span class='op'>=</span> <span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_warp_clipped_interpolate'>warp_clipped_interpolate</span> <span class='op'>*</span><span class='id identifier rubyid_model'>model</span><span class='lparen'>(</span> <span class='id identifier rubyid_p'>p</span><span class='comma'>,</span> <span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='id identifier rubyid_y'>y</span> <span class='rparen'>)</span>
<span class='id identifier rubyid_gx'>gx</span> <span class='op'>=</span> <span class='id identifier rubyid_tpl'>tpl</span><span class='period'>.</span><span class='id identifier rubyid_gauss_gradient'>gauss_gradient</span><span class='lparen'>(</span> <span class='id identifier rubyid_sigma'>sigma</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rparen'>)</span>
<span class='id identifier rubyid_gy'>gy</span> <span class='op'>=</span> <span class='id identifier rubyid_tpl'>tpl</span><span class='period'>.</span><span class='id identifier rubyid_gauss_gradient'>gauss_gradient</span><span class='lparen'>(</span> <span class='id identifier rubyid_sigma'>sigma</span><span class='comma'>,</span> <span class='int'>1</span> <span class='rparen'>)</span>
<span class='id identifier rubyid_tpl'>tpl</span><span class='comma'>,</span> <span class='id identifier rubyid_gx'>gx</span><span class='comma'>,</span> <span class='id identifier rubyid_gy'>gy</span><span class='comma'>,</span> <span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='id identifier rubyid_y'>y</span> <span class='op'>=</span> <span class='op'>*</span><span class='lparen'>(</span> <span class='lbracket'>[</span> <span class='id identifier rubyid_tpl'>tpl</span><span class='comma'>,</span> <span class='id identifier rubyid_gx'>gx</span><span class='comma'>,</span> <span class='id identifier rubyid_gy'>gy</span><span class='comma'>,</span> <span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='id identifier rubyid_y'>y</span> <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_arr'>arr</span><span class='op'>|</span> <span class='id identifier rubyid_arr'>arr</span><span class='lbracket'>[</span> <span class='id identifier rubyid_b'>b</span><span class='op'>...</span><span class='lparen'>(</span><span class='id identifier rubyid_w'>w</span><span class='op'>+</span><span class='id identifier rubyid_b'>b</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_b'>b</span><span class='op'>...</span><span class='lparen'>(</span><span class='id identifier rubyid_h'>h</span><span class='op'>+</span><span class='id identifier rubyid_b'>b</span><span class='rparen'>)</span> <span class='rbracket'>]</span> <span class='rbrace'>}</span> <span class='rparen'>)</span>
<span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='id identifier rubyid_derivative'>derivative</span><span class='lparen'>(</span> <span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='id identifier rubyid_y'>y</span> <span class='rparen'>)</span> <span class='op'>*</span> <span class='const'>Vector</span><span class='lbracket'>[</span> <span class='id identifier rubyid_gx'>gx</span><span class='comma'>,</span> <span class='id identifier rubyid_gy'>gy</span> <span class='rbracket'>]</span>
<span class='id identifier rubyid_hs'>hs</span> <span class='op'>=</span> <span class='lparen'>(</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>*</span> <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_covector'>covector</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_sum'>sum</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_hsinv'>hsinv</span> <span class='op'>=</span> <span class='id identifier rubyid_hs'>hs</span><span class='period'>.</span><span class='id identifier rubyid_inverse'>inverse</span>
<span class='const'>X11Display</span><span class='period'>.</span><span class='id identifier rubyid_show'>show</span> <span class='symbol'>:title</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Lucas-Kanade tracker</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_img'>img</span> <span class='op'>=</span> <span class='id identifier rubyid_input'>input</span><span class='period'>.</span><span class='id identifier rubyid_read_ubyte'>read_ubyte</span>
  <span class='kw'>for</span> <span class='id identifier rubyid_i'>i</span> <span class='kw'>in</span> <span class='int'>0</span><span class='op'>...</span><span class='int'>5</span>
    <span class='id identifier rubyid_diff'>diff</span> <span class='op'>=</span> <span class='id identifier rubyid_tpl'>tpl</span> <span class='op'>-</span> <span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_warp_clipped_interpolate'>warp_clipped_interpolate</span><span class='lparen'>(</span> <span class='op'>*</span><span class='id identifier rubyid_model'>model</span><span class='lparen'>(</span> <span class='id identifier rubyid_p'>p</span><span class='comma'>,</span> <span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='id identifier rubyid_y'>y</span> <span class='rparen'>)</span> <span class='rparen'>)</span>
    <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span> <span class='lparen'>(</span> <span class='id identifier rubyid_e'>e</span> <span class='op'>*</span> <span class='id identifier rubyid_diff'>diff</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_sum'>sum</span> <span class='rbrace'>}</span>
    <span class='id identifier rubyid_p'>p</span> <span class='op'>=</span> <span class='id identifier rubyid_compose'>compose</span><span class='lparen'>(</span> <span class='id identifier rubyid_p'>p</span><span class='comma'>,</span> <span class='id identifier rubyid_hsinv'>hsinv</span> <span class='op'>*</span> <span class='id identifier rubyid_s'>s</span> <span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_gc'>gc</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Magick.html" title="Magick (module)">Magick</a></span></span><span class='op'>::</span><span class='const'>Draw</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_gc'>gc</span><span class='period'>.</span><span class='id identifier rubyid_fill_opacity'>fill_opacity</span> <span class='int'>0</span>
  <span class='id identifier rubyid_gc'>gc</span><span class='period'>.</span><span class='id identifier rubyid_stroke'>stroke</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>red</span><span class='tstring_end'>&#39;</span></span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_stroke_width'>stroke_width</span> <span class='int'>1</span>
  <span class='id identifier rubyid_gc'>gc</span><span class='period'>.</span><span class='id identifier rubyid_line'>line</span> <span class='op'>*</span><span class='lparen'>(</span> <span class='id identifier rubyid_model'>model</span><span class='lparen'>(</span> <span class='id identifier rubyid_p'>p</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span> <span class='op'>+</span> <span class='id identifier rubyid_model'>model</span><span class='lparen'>(</span> <span class='id identifier rubyid_p'>p</span><span class='comma'>,</span> <span class='id identifier rubyid_w'>w</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span> <span class='rparen'>)</span>
  <span class='id identifier rubyid_gc'>gc</span><span class='period'>.</span><span class='id identifier rubyid_line'>line</span> <span class='op'>*</span><span class='lparen'>(</span> <span class='id identifier rubyid_model'>model</span><span class='lparen'>(</span> <span class='id identifier rubyid_p'>p</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_h'>h</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span> <span class='op'>+</span> <span class='id identifier rubyid_model'>model</span><span class='lparen'>(</span> <span class='id identifier rubyid_p'>p</span><span class='comma'>,</span> <span class='id identifier rubyid_w'>w</span><span class='comma'>,</span> <span class='id identifier rubyid_h'>h</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span> <span class='rparen'>)</span>
  <span class='id identifier rubyid_gc'>gc</span><span class='period'>.</span><span class='id identifier rubyid_line'>line</span> <span class='op'>*</span><span class='lparen'>(</span> <span class='id identifier rubyid_model'>model</span><span class='lparen'>(</span> <span class='id identifier rubyid_p'>p</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span> <span class='op'>+</span> <span class='id identifier rubyid_model'>model</span><span class='lparen'>(</span> <span class='id identifier rubyid_p'>p</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_h'>h</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span> <span class='rparen'>)</span>
  <span class='id identifier rubyid_gc'>gc</span><span class='period'>.</span><span class='id identifier rubyid_line'>line</span> <span class='op'>*</span><span class='lparen'>(</span> <span class='id identifier rubyid_model'>model</span><span class='lparen'>(</span> <span class='id identifier rubyid_p'>p</span><span class='comma'>,</span> <span class='id identifier rubyid_w'>w</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span> <span class='op'>+</span> <span class='id identifier rubyid_model'>model</span><span class='lparen'>(</span> <span class='id identifier rubyid_p'>p</span><span class='comma'>,</span> <span class='id identifier rubyid_w'>w</span><span class='comma'>,</span> <span class='id identifier rubyid_h'>h</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span> <span class='rparen'>)</span>
  <span class='id identifier rubyid_gc'>gc</span><span class='period'>.</span><span class='id identifier rubyid_circle'>circle</span> <span class='op'>*</span><span class='lparen'>(</span> <span class='id identifier rubyid_model'>model</span><span class='lparen'>(</span> <span class='id identifier rubyid_p'>p</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span> <span class='op'>+</span> <span class='id identifier rubyid_model'>model</span><span class='lparen'>(</span> <span class='id identifier rubyid_p'>p</span><span class='comma'>,</span> <span class='int'>3</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span> <span class='rparen'>)</span>
  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_to_ubytergb'>to_ubytergb</span><span class='period'>.</span><span class='id identifier rubyid_to_magick'>to_magick</span>
  <span class='id identifier rubyid_gc'>gc</span><span class='period'>.</span><span class='id identifier rubyid_draw'>draw</span> <span class='id identifier rubyid_result'>result</span>
  <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_to_ubytergb'>to_ubytergb</span>
<span class='kw'>end</span>
</code></pre>

<h2 id="label-EAN-13+Barcode+Reader">EAN-13 Barcode Reader</h2>

<p><img src="images/barcode.png"></p>

<p>The example below is a barcode reader for reading EAN-13 (and UPC) barcodes. Reading of the barcode is restricted to a single line of the camera image. However the application can read barcodes forwards as well as backwards. The detected numbers are displayed using RMagick.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_v4l2</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_xorg</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_rmagick</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="Hornetseye.html" title="Hornetseye (module)">Hornetseye</a></span></span>
<span class='kw'>class</span> <span class='const'>Integer</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_checksum'>checksum</span>
    <span class='id identifier rubyid_x'>x</span> <span class='op'>=</span> <span class='kw'>self</span> <span class='op'>/</span> <span class='int'>10</span>
    <span class='id identifier rubyid_retval'>retval</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='kw'>while</span> <span class='id identifier rubyid_x'>x</span> <span class='op'>&gt;</span> <span class='int'>0</span>
      <span class='id identifier rubyid_retval'>retval</span> <span class='op'>+=</span> <span class='lparen'>(</span> <span class='id identifier rubyid_x'>x</span> <span class='op'>%</span> <span class='int'>10</span> <span class='rparen'>)</span> <span class='op'>*</span> <span class='int'>3</span>
      <span class='id identifier rubyid_x'>x</span> <span class='op'>/=</span> <span class='int'>10</span>
      <span class='id identifier rubyid_retval'>retval</span> <span class='op'>+=</span> <span class='id identifier rubyid_x'>x</span>
      <span class='id identifier rubyid_x'>x</span> <span class='op'>/=</span> <span class='int'>10</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_retval'>retval</span> <span class='op'>=</span> <span class='id identifier rubyid_retval'>retval</span> <span class='op'>%</span> <span class='int'>10</span>
    <span class='id identifier rubyid_retval'>retval</span> <span class='op'>=</span> <span class='int'>10</span> <span class='op'>-</span> <span class='id identifier rubyid_retval'>retval</span> <span class='kw'>unless</span> <span class='id identifier rubyid_retval'>retval</span> <span class='op'>==</span> <span class='int'>0</span>
    <span class='id identifier rubyid_retval'>retval</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_check?'>check?</span>
    <span class='id identifier rubyid_checksum'>checksum</span> <span class='op'>==</span> <span class='kw'>self</span> <span class='op'>%</span> <span class='int'>10</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
<span class='id identifier rubyid_input'>input</span> <span class='op'>=</span> <span class='const'>V4L2Input</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_modes'>modes</span><span class='op'>|</span> <span class='id identifier rubyid_modes'>modes</span><span class='period'>.</span><span class='id identifier rubyid_sort_by'>sort_by</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_mode'>mode</span><span class='op'>|</span> <span class='lparen'>(</span> <span class='id identifier rubyid_mode'>mode</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>-</span> <span class='int'>640</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span> <span class='rbrace'>}</span>
<span class='const'>SIGMA</span> <span class='op'>=</span> <span class='float'>20.0</span>
<span class='const'>NOISE</span> <span class='op'>=</span> <span class='float'>10.0</span>
<span class='const'>ERR_THRESH</span> <span class='op'>=</span> <span class='float'>0.25</span>
<span class='const'>WIDTH</span><span class='comma'>,</span> <span class='const'>HEIGHT</span> <span class='op'>=</span> <span class='id identifier rubyid_input'>input</span><span class='period'>.</span><span class='id identifier rubyid_width'>width</span><span class='comma'>,</span> <span class='id identifier rubyid_input'>input</span><span class='period'>.</span><span class='id identifier rubyid_height'>height</span>
<span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='const'>MultiArray</span><span class='period'>.</span><span class='id identifier rubyid_ubytergb'>ubytergb</span> <span class='const'>WIDTH</span><span class='comma'>,</span> <span class='const'>HEIGHT</span> <span class='op'>+</span> <span class='int'>100</span>
<span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span> <span class='const'>HEIGHT</span> <span class='op'>...</span> <span class='const'>HEIGHT</span> <span class='op'>+</span> <span class='int'>100</span> <span class='rbracket'>]</span> <span class='op'>=</span> <span class='int'>128</span>
<span class='id identifier rubyid_segment'>segment</span> <span class='op'>=</span> <span class='const'>Sequence</span><span class='lbracket'>[</span> <span class='op'>*</span><span class='lparen'>(</span> <span class='lbracket'>[</span> <span class='int'>0</span> <span class='rbracket'>]</span> <span class='op'>*</span> <span class='int'>3</span> <span class='op'>+</span>
                       <span class='lparen'>(</span> <span class='int'>1</span> <span class='op'>..</span> <span class='int'>6</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='lbracket'>[</span> <span class='id identifier rubyid_i'>i</span> <span class='rbracket'>]</span> <span class='op'>*</span> <span class='int'>4</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_flatten'>flatten</span> <span class='op'>+</span>
                       <span class='lbracket'>[</span> <span class='int'>7</span> <span class='rbracket'>]</span> <span class='op'>*</span> <span class='int'>5</span> <span class='op'>+</span>
                       <span class='lparen'>(</span> <span class='int'>8</span> <span class='op'>..</span> <span class='int'>13</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='lbracket'>[</span> <span class='id identifier rubyid_i'>i</span> <span class='rbracket'>]</span> <span class='op'>*</span> <span class='int'>4</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_flatten'>flatten</span> <span class='op'>+</span>
                       <span class='lbracket'>[</span> <span class='int'>14</span> <span class='rbracket'>]</span> <span class='op'>*</span> <span class='int'>3</span> <span class='rparen'>)</span> <span class='rbracket'>]</span>
<span class='id identifier rubyid_digits'>digits</span> <span class='op'>=</span> <span class='const'>MultiArray</span><span class='lbracket'>[</span> <span class='lbracket'>[</span> <span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                       <span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                       <span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                       <span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                       <span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                       <span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                       <span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                       <span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                       <span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                       <span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span> <span class='rbracket'>]</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                     <span class='lbracket'>[</span> <span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                       <span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                       <span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                       <span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                       <span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                       <span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                       <span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                       <span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                       <span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                       <span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span> <span class='rbracket'>]</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                     <span class='lbracket'>[</span> <span class='lbracket'>[</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                       <span class='lbracket'>[</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                       <span class='lbracket'>[</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                       <span class='lbracket'>[</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                       <span class='lbracket'>[</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                       <span class='lbracket'>[</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                       <span class='lbracket'>[</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                       <span class='lbracket'>[</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                       <span class='lbracket'>[</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                       <span class='lbracket'>[</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rbracket'>]</span> <span class='rbracket'>]</span> <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_byte'>to_byte</span>
<span class='id identifier rubyid_patterns'>patterns</span> <span class='op'>=</span> <span class='const'>MultiArray</span><span class='lbracket'>[</span> <span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                       <span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                       <span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                       <span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                       <span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                       <span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                       <span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                       <span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                       <span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span> <span class='rbracket'>]</span><span class='comma'>,</span>
                       <span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span> <span class='rbracket'>]</span> <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_byte'>to_byte</span>
<span class='const'>X11Display</span><span class='period'>.</span><span class='id identifier rubyid_show'>show</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_img'>img</span> <span class='op'>=</span> <span class='id identifier rubyid_input'>input</span><span class='period'>.</span><span class='id identifier rubyid_read_ubyte'>read_ubyte</span>
  <span class='id identifier rubyid_avg'>avg</span> <span class='op'>=</span> <span class='id identifier rubyid_img'>img</span><span class='lbracket'>[</span> <span class='const'>HEIGHT</span> <span class='op'>/</span> <span class='int'>2</span> <span class='rbracket'>]</span>
  <span class='id identifier rubyid_mean'>mean</span> <span class='op'>=</span> <span class='id identifier rubyid_avg'>avg</span><span class='period'>.</span><span class='id identifier rubyid_gauss_blur'>gauss_blur</span> <span class='const'>SIGMA</span>
  <span class='id identifier rubyid_var'>var</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Math.html" title="Math (module)">Math</a></span></span><span class='period'>.</span><span class='id identifier rubyid_sqrt'><span class='object_link'><a href="Math.html#sqrt-class_method" title="Math.sqrt (method)">sqrt</a></span></span><span class='lparen'>(</span> <span class='lparen'>(</span> <span class='lparen'>(</span> <span class='id identifier rubyid_avg'>avg</span> <span class='op'>-</span> <span class='id identifier rubyid_mean'>mean</span> <span class='rparen'>)</span> <span class='op'>**</span> <span class='int'>2</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_gauss_blur'>gauss_blur</span><span class='lparen'>(</span> <span class='const'>SIGMA</span> <span class='rparen'>)</span> <span class='rparen'>)</span>
  <span class='id identifier rubyid_binary'>binary</span> <span class='op'>=</span> <span class='lparen'>(</span> <span class='id identifier rubyid_avg'>avg</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_mean'>mean</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_and'>and</span><span class='lparen'>(</span> <span class='id identifier rubyid_var'>var</span> <span class='op'>&gt;=</span> <span class='const'>NOISE</span> <span class='rparen'>)</span>
  <span class='id identifier rubyid_up'>up</span> <span class='op'>=</span> <span class='id identifier rubyid_binary'>binary</span><span class='period'>.</span><span class='id identifier rubyid_to_ubyte'>to_ubyte</span><span class='period'>.</span><span class='id identifier rubyid_convolve'>convolve</span><span class='lparen'>(</span> <span class='const'>Sequence</span><span class='lbracket'>[</span> <span class='int'>1</span><span class='comma'>,</span> <span class='op'>-</span><span class='int'>1</span> <span class='rbracket'>]</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_major'>major</span> <span class='int'>0</span>
  <span class='id identifier rubyid_down'>down</span> <span class='op'>=</span> <span class='id identifier rubyid_binary'>binary</span><span class='period'>.</span><span class='id identifier rubyid_to_ubyte'>to_ubyte</span><span class='period'>.</span><span class='id identifier rubyid_convolve'>convolve</span><span class='lparen'>(</span> <span class='const'>Sequence</span><span class='lbracket'>[</span> <span class='op'>-</span><span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span> <span class='rbracket'>]</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_major'>major</span> <span class='int'>0</span>
  <span class='id identifier rubyid_stripe'>stripe</span> <span class='op'>=</span> <span class='lparen'>(</span> <span class='id identifier rubyid_up'>up</span> <span class='op'>+</span> <span class='id identifier rubyid_down'>down</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_integral'>integral</span>
  <span class='id identifier rubyid_n'>n</span> <span class='op'>=</span> <span class='id identifier rubyid_up'>up</span><span class='period'>.</span><span class='id identifier rubyid_sum'>sum</span>
  <span class='id identifier rubyid_views'>views</span> <span class='op'>=</span> <span class='const'>Sequence</span><span class='period'>.</span><span class='id identifier rubyid_int'>int</span><span class='lparen'>(</span> <span class='id identifier rubyid_avg'>avg</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_fill!'>fill!</span> <span class='int'>128</span>
  <span class='id identifier rubyid_zebra'>zebra</span> <span class='op'>=</span> <span class='const'>Sequence</span><span class='period'>.</span><span class='id identifier rubyid_ubyte'>ubyte</span><span class='lparen'>(</span> <span class='id identifier rubyid_avg'>avg</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_fill!'>fill!</span> <span class='int'>128</span>
  <span class='kw'>for</span> <span class='id identifier rubyid_o'>o</span> <span class='kw'>in</span> <span class='int'>0</span> <span class='op'>..</span> <span class='id identifier rubyid_n'>n</span> <span class='op'>-</span> <span class='int'>30</span>
    <span class='id identifier rubyid_msk'>msk</span> <span class='op'>=</span> <span class='lparen'>(</span> <span class='id identifier rubyid_stripe'>stripe</span> <span class='op'>&gt;=</span> <span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_o'>o</span> <span class='op'>+</span> <span class='int'>1</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_and'>and</span> <span class='id identifier rubyid_stripe'>stripe</span> <span class='op'>&lt;=</span> <span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_o'>o</span> <span class='op'>+</span> <span class='int'>59</span>
    <span class='id identifier rubyid_range'>range</span> <span class='op'>=</span> <span class='id identifier rubyid_lazy'>lazy</span><span class='lparen'>(</span> <span class='const'>WIDTH</span> <span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='id identifier rubyid_i'>i</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_mask'>mask</span><span class='lparen'>(</span> <span class='id identifier rubyid_msk'>msk</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_range'>range</span>
    <span class='id identifier rubyid_views'>views</span> <span class='op'>+=</span> <span class='id identifier rubyid_msk'>msk</span><span class='period'>.</span><span class='id identifier rubyid_to_ubyte'>to_ubyte</span>
    <span class='id identifier rubyid_code'>code</span> <span class='op'>=</span> <span class='lparen'>(</span> <span class='id identifier rubyid_stripe'>stripe</span><span class='lbracket'>[</span> <span class='id identifier rubyid_range'>range</span> <span class='rbracket'>]</span> <span class='op'>-</span> <span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_o'>o</span> <span class='op'>-</span> <span class='int'>1</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_lut'>lut</span> <span class='id identifier rubyid_segment'>segment</span>
    <span class='id identifier rubyid_sequence'>sequence</span> <span class='op'>=</span> <span class='id identifier rubyid_binary'>binary</span><span class='lbracket'>[</span> <span class='id identifier rubyid_range'>range</span> <span class='rbracket'>]</span>
    <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_sequence'>sequence</span><span class='period'>.</span><span class='id identifier rubyid_mask'>mask</span><span class='lparen'>(</span> <span class='id identifier rubyid_code'>code</span><span class='period'>.</span><span class='id identifier rubyid_eq'>eq</span><span class='lparen'>(</span> <span class='int'>0</span> <span class='rparen'>)</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_byte'>to_byte</span>
    <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='id identifier rubyid_sequence'>sequence</span><span class='period'>.</span><span class='id identifier rubyid_mask'>mask</span><span class='lparen'>(</span> <span class='id identifier rubyid_code'>code</span><span class='period'>.</span><span class='id identifier rubyid_eq'>eq</span><span class='lparen'>(</span> <span class='int'>7</span> <span class='rparen'>)</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_byte'>to_byte</span>
    <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_sequence'>sequence</span><span class='period'>.</span><span class='id identifier rubyid_mask'>mask</span><span class='lparen'>(</span> <span class='id identifier rubyid_code'>code</span><span class='period'>.</span><span class='id identifier rubyid_eq'>eq</span><span class='lparen'>(</span> <span class='int'>14</span> <span class='rparen'>)</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_byte'>to_byte</span>
    <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='const'>Sequence</span><span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='op'>*</span><span class='lparen'>(</span> <span class='lbracket'>[</span> <span class='int'>1</span> <span class='rbracket'>]</span> <span class='op'>*</span> <span class='int'>6</span> <span class='op'>+</span> <span class='lbracket'>[</span> <span class='int'>0</span> <span class='rbracket'>]</span> <span class='op'>+</span> <span class='lbracket'>[</span> <span class='int'>1</span> <span class='rbracket'>]</span> <span class='op'>*</span> <span class='int'>6</span> <span class='op'>+</span> <span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='rparen'>)</span> <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_bool'>to_bool</span>
    <span class='id identifier rubyid_skew'>skew</span> <span class='op'>=</span> <span class='id identifier rubyid_code'>code</span><span class='period'>.</span><span class='id identifier rubyid_histogram'>histogram</span><span class='lparen'>(</span> <span class='int'>15</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_mask'>mask</span><span class='lparen'>(</span> <span class='id identifier rubyid_c'>c</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_range'>range</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_skew'>skew</span><span class='period'>.</span><span class='id identifier rubyid_max'>max</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_skew'>skew</span><span class='period'>.</span><span class='id identifier rubyid_min'>min</span> <span class='op'>*</span> <span class='float'>1.3</span>
      <span class='id identifier rubyid_s_'>s_</span> <span class='op'>=</span> <span class='const'>Sequence</span><span class='lbracket'>[</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span> <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_warp'>warp</span> <span class='id identifier rubyid_lazy'>lazy</span><span class='lparen'>(</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>*</span> <span class='int'>3</span> <span class='op'>/</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='rbrace'>}</span>
      <span class='id identifier rubyid_m_'>m_</span> <span class='op'>=</span> <span class='const'>Sequence</span><span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_warp'>warp</span> <span class='id identifier rubyid_lazy'>lazy</span><span class='lparen'>(</span> <span class='id identifier rubyid_m'>m</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>*</span> <span class='int'>5</span> <span class='op'>/</span> <span class='id identifier rubyid_m'>m</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='rbrace'>}</span>
      <span class='id identifier rubyid_e_'>e_</span> <span class='op'>=</span> <span class='const'>Sequence</span><span class='lbracket'>[</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span> <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_warp'>warp</span> <span class='id identifier rubyid_lazy'>lazy</span><span class='lparen'>(</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>*</span> <span class='int'>3</span> <span class='op'>/</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='rbrace'>}</span>
      <span class='kw'>if</span> <span class='lparen'>(</span> <span class='id identifier rubyid_s'>s</span> <span class='op'>-</span> <span class='id identifier rubyid_s_'>s_</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span><span class='period'>.</span><span class='id identifier rubyid_sum'>sum</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='const'>ERR_THRESH</span> <span class='kw'>and</span>
         <span class='lparen'>(</span> <span class='id identifier rubyid_m'>m</span> <span class='op'>-</span> <span class='id identifier rubyid_m_'>m_</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span><span class='period'>.</span><span class='id identifier rubyid_sum'>sum</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_m'>m</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='const'>ERR_THRESH</span> <span class='kw'>and</span>
         <span class='lparen'>(</span> <span class='id identifier rubyid_e'>e</span> <span class='op'>-</span> <span class='id identifier rubyid_e_'>e_</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span><span class='period'>.</span><span class='id identifier rubyid_sum'>sum</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_m'>m</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='const'>ERR_THRESH</span>
        <span class='id identifier rubyid_zebra'>zebra</span> <span class='op'>=</span> <span class='lparen'>(</span> <span class='lparen'>(</span> <span class='id identifier rubyid_code'>code</span> <span class='op'>%</span> <span class='int'>2</span> <span class='rparen'>)</span> <span class='op'>*</span> <span class='int'>255</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_unmask'>unmask</span> <span class='id identifier rubyid_msk'>msk</span><span class='comma'>,</span> <span class='symbol'>:default</span> <span class='op'>=&gt;</span> <span class='int'>128</span>
        <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='int'>0</span>
        <span class='id identifier rubyid_max_err'>max_err</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='float'>0.0</span>
        <span class='id identifier rubyid_exp'>exp</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='symbol'>:forward</span> <span class='op'>=&gt;</span> <span class='int'>11</span><span class='comma'>,</span> <span class='symbol'>:backward</span> <span class='op'>=&gt;</span> <span class='int'>0</span> <span class='rbrace'>}</span>
        <span class='lparen'>(</span> <span class='lparen'>(</span> <span class='int'>1</span> <span class='op'>..</span> <span class='int'>6</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span> <span class='op'>+</span> <span class='lparen'>(</span> <span class='int'>8</span> <span class='op'>..</span> <span class='int'>13</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='op'>|</span>
          <span class='id identifier rubyid_cut'>cut</span> <span class='op'>=</span> <span class='id identifier rubyid_sequence'>sequence</span><span class='period'>.</span><span class='id identifier rubyid_mask'>mask</span> <span class='id identifier rubyid_code'>code</span><span class='period'>.</span><span class='id identifier rubyid_eq'>eq</span><span class='lparen'>(</span> <span class='id identifier rubyid_k'>k</span> <span class='rparen'>)</span>
          <span class='id identifier rubyid_d'>d</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='symbol'>:forward</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_cut'>cut</span><span class='comma'>,</span> <span class='symbol'>:backward</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_cut'>cut</span><span class='period'>.</span><span class='id identifier rubyid_flip'>flip</span><span class='lparen'>(</span> <span class='int'>0</span> <span class='rparen'>)</span> <span class='rbrace'>}</span>
          <span class='id identifier rubyid_span'>span</span> <span class='op'>=</span> <span class='id identifier rubyid_lazy'>lazy</span><span class='lparen'>(</span> <span class='id identifier rubyid_cut'>cut</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>*</span> <span class='int'>7</span> <span class='op'>/</span> <span class='id identifier rubyid_cut'>cut</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='rbrace'>}</span>
          <span class='id identifier rubyid_d_'>d_</span> <span class='op'>=</span> <span class='id identifier rubyid_digits'>digits</span><span class='period'>.</span><span class='id identifier rubyid_roll'>roll</span><span class='period'>.</span><span class='id identifier rubyid_warp'>warp</span><span class='lparen'>(</span> <span class='id identifier rubyid_span'>span</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_unroll'>unroll</span>
          <span class='lbracket'>[</span> <span class='symbol'>:forward</span><span class='comma'>,</span> <span class='symbol'>:backward</span> <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_dir'>dir</span><span class='op'>|</span>
            <span class='id identifier rubyid_err'>err</span> <span class='op'>=</span> <span class='lparen'>(</span> <span class='int'>0</span> <span class='op'>...</span> <span class='int'>3</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_lgr'>lgr</span><span class='op'>|</span>
              <span class='id identifier rubyid_sum'>sum</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='id identifier rubyid_lazy'>lazy</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_j'>j</span><span class='op'>|</span> <span class='lparen'>(</span> <span class='id identifier rubyid_d'>d</span><span class='lbracket'>[</span> <span class='id identifier rubyid_dir'>dir</span> <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_byte'>to_byte</span><span class='lbracket'>[</span> <span class='id identifier rubyid_i'>i</span> <span class='rbracket'>]</span> <span class='op'>-</span> <span class='id identifier rubyid_d_'>d_</span><span class='lbracket'>[</span> <span class='id identifier rubyid_lgr'>lgr</span> <span class='rbracket'>]</span><span class='lbracket'>[</span> <span class='id identifier rubyid_j'>j</span> <span class='rbracket'>]</span><span class='lbracket'>[</span> <span class='id identifier rubyid_i'>i</span> <span class='rbracket'>]</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span> <span class='rbrace'>}</span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>
            <span class='kw'>for</span> <span class='id identifier rubyid_i'>i</span> <span class='kw'>in</span> <span class='int'>0</span> <span class='op'>..</span> <span class='int'>9</span>
              <span class='id identifier rubyid_lgr'>lgr</span> <span class='op'>=</span> <span class='id identifier rubyid_patterns'>patterns</span><span class='lbracket'>[</span> <span class='id identifier rubyid_i'>i</span> <span class='rbracket'>]</span><span class='lbracket'>[</span> <span class='int'>11</span> <span class='op'>-</span> <span class='id identifier rubyid_exp'>exp</span><span class='lbracket'>[</span> <span class='id identifier rubyid_dir'>dir</span> <span class='rbracket'>]</span> <span class='rbracket'>]</span>
              <span class='id identifier rubyid_match'>match</span> <span class='op'>=</span> <span class='id identifier rubyid_argmin'>argmin</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='id identifier rubyid_err'>err</span><span class='lbracket'>[</span> <span class='id identifier rubyid_lgr'>lgr</span> <span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
              <span class='id identifier rubyid_max_err'>max_err</span><span class='lbracket'>[</span> <span class='lbracket'>[</span> <span class='id identifier rubyid_dir'>dir</span><span class='comma'>,</span> <span class='id identifier rubyid_i'>i</span> <span class='rbracket'>]</span> <span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbracket'>[</span> <span class='id identifier rubyid_max_err'>max_err</span><span class='lbracket'>[</span> <span class='lbracket'>[</span> <span class='id identifier rubyid_dir'>dir</span><span class='comma'>,</span> <span class='id identifier rubyid_i'>i</span> <span class='rbracket'>]</span> <span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_err'>err</span><span class='lbracket'>[</span> <span class='id identifier rubyid_lgr'>lgr</span> <span class='rbracket'>]</span><span class='lbracket'>[</span> <span class='id identifier rubyid_match'>match</span> <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span> <span class='op'>/</span> <span class='id identifier rubyid_cut'>cut</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_max'>max</span>
              <span class='id identifier rubyid_number'>number</span><span class='lbracket'>[</span> <span class='lbracket'>[</span> <span class='id identifier rubyid_dir'>dir</span><span class='comma'>,</span> <span class='id identifier rubyid_i'>i</span> <span class='rbracket'>]</span> <span class='rbracket'>]</span> <span class='op'>+=</span> <span class='id identifier rubyid_match'>match</span> <span class='op'>*</span> <span class='int'>10</span> <span class='op'>**</span> <span class='id identifier rubyid_exp'>exp</span><span class='lbracket'>[</span> <span class='id identifier rubyid_dir'>dir</span> <span class='rbracket'>]</span>
            <span class='kw'>end</span>
          <span class='kw'>end</span>
          <span class='id identifier rubyid_exp'>exp</span><span class='lbracket'>[</span> <span class='symbol'>:forward</span> <span class='rbracket'>]</span> <span class='op'>-=</span> <span class='int'>1</span>
          <span class='id identifier rubyid_exp'>exp</span><span class='lbracket'>[</span> <span class='symbol'>:backward</span> <span class='rbracket'>]</span> <span class='op'>+=</span> <span class='int'>1</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_opt'>opt</span> <span class='op'>=</span> <span class='id identifier rubyid_max_err'>max_err</span><span class='period'>.</span><span class='id identifier rubyid_min'>min</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='comma'>,</span><span class='id identifier rubyid_y'>y</span><span class='op'>|</span> <span class='id identifier rubyid_x'>x</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>&lt;=&gt;</span> <span class='id identifier rubyid_y'>y</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
        <span class='id identifier rubyid_number'>number</span><span class='comma'>,</span> <span class='id identifier rubyid_max_err'>max_err</span> <span class='op'>=</span> <span class='id identifier rubyid_number'>number</span><span class='lbracket'>[</span> <span class='id identifier rubyid_opt'>opt</span> <span class='rbracket'>]</span> <span class='op'>+</span> <span class='id identifier rubyid_opt'>opt</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>*</span> <span class='int'>10</span> <span class='op'>**</span> <span class='int'>12</span><span class='comma'>,</span> <span class='id identifier rubyid_max_err'>max_err</span><span class='lbracket'>[</span> <span class='id identifier rubyid_opt'>opt</span> <span class='rbracket'>]</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_max_err'>max_err</span> <span class='op'>&lt;</span> <span class='const'>ERR_THRESH</span> <span class='kw'>and</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_check?'>check?</span>
          <span class='id identifier rubyid_text'>text</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Magick.html" title="Magick (module)">Magick</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Magick/Image.html" title="Magick::Image (class)">Image</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='int'>100</span><span class='comma'>,</span> <span class='int'>20</span>
          <span class='id identifier rubyid_draw'>draw</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Magick.html" title="Magick (module)">Magick</a></span></span><span class='op'>::</span><span class='const'>Draw</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
          <span class='id identifier rubyid_draw'>draw</span><span class='period'>.</span><span class='id identifier rubyid_gravity'>gravity</span> <span class='const'><span class='object_link'><a href="Magick.html" title="Magick (module)">Magick</a></span></span><span class='op'>::</span><span class='const'>CenterGravity</span>
          <span class='id identifier rubyid_draw'>draw</span><span class='period'>.</span><span class='id identifier rubyid_text'>text</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%013d</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_number'>number</span>
          <span class='id identifier rubyid_draw'>draw</span><span class='period'>.</span><span class='id identifier rubyid_draw'>draw</span> <span class='id identifier rubyid_text'>text</span>
          <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span> <span class='int'>0</span> <span class='op'>...</span> <span class='const'>WIDTH</span> <span class='op'>-</span> <span class='id identifier rubyid_text'>text</span><span class='period'>.</span><span class='id identifier rubyid_columns'>columns</span><span class='comma'>,</span> <span class='const'>HEIGHT</span> <span class='op'>+</span> <span class='int'>80</span> <span class='op'>...</span> <span class='const'>HEIGHT</span> <span class='op'>+</span> <span class='int'>100</span> <span class='rbracket'>]</span> <span class='op'>=</span>
            <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span> <span class='id identifier rubyid_text'>text</span><span class='period'>.</span><span class='id identifier rubyid_columns'>columns</span> <span class='op'>...</span> <span class='const'>WIDTH</span><span class='comma'>,</span> <span class='const'>HEIGHT</span> <span class='op'>+</span> <span class='int'>80</span> <span class='op'>...</span> <span class='const'>HEIGHT</span> <span class='op'>+</span> <span class='int'>100</span> <span class='rbracket'>]</span>
          <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span> <span class='const'>WIDTH</span> <span class='op'>-</span> <span class='id identifier rubyid_text'>text</span><span class='period'>.</span><span class='id identifier rubyid_columns'>columns</span> <span class='op'>...</span> <span class='const'>WIDTH</span><span class='comma'>,</span> <span class='const'>HEIGHT</span> <span class='op'>+</span> <span class='int'>80</span> <span class='op'>...</span> <span class='const'>HEIGHT</span> <span class='op'>+</span> <span class='int'>100</span> <span class='rbracket'>]</span> <span class='op'>=</span>
            <span class='id identifier rubyid_text'>text</span><span class='period'>.</span><span class='id identifier rubyid_to_ubytergb'>to_ubytergb</span>
          <span class='kw'>break</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span> <span class='int'>0</span> <span class='op'>...</span> <span class='const'>WIDTH</span><span class='comma'>,</span> <span class='int'>0</span> <span class='op'>...</span> <span class='const'>HEIGHT</span> <span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_img'>img</span>
  <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span> <span class='const'>HEIGHT</span> <span class='op'>/</span> <span class='int'>2</span> <span class='rbracket'>]</span> <span class='op'>=</span> <span class='op'>~</span><span class='id identifier rubyid_img'>img</span><span class='lbracket'>[</span> <span class='const'>HEIGHT</span> <span class='op'>/</span> <span class='int'>2</span> <span class='rbracket'>]</span>
  <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span> <span class='int'>0</span> <span class='op'>...</span> <span class='const'>WIDTH</span><span class='comma'>,</span> <span class='const'>HEIGHT</span> <span class='op'>...</span> <span class='const'>HEIGHT</span> <span class='op'>+</span> <span class='int'>20</span> <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_roll'>roll</span><span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_avg'>avg</span>
  <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span> <span class='int'>0</span> <span class='op'>...</span> <span class='const'>WIDTH</span><span class='comma'>,</span> <span class='const'>HEIGHT</span> <span class='op'>+</span> <span class='int'>20</span> <span class='op'>...</span> <span class='const'>HEIGHT</span> <span class='op'>+</span> <span class='int'>40</span> <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_roll'>roll</span><span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_binary'>binary</span><span class='period'>.</span><span class='id identifier rubyid_not'>not</span><span class='period'>.</span><span class='id identifier rubyid_to_ubyte'>to_ubyte</span> <span class='op'>*</span> <span class='int'>255</span>
  <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span> <span class='int'>0</span> <span class='op'>...</span> <span class='const'>WIDTH</span><span class='comma'>,</span> <span class='const'>HEIGHT</span> <span class='op'>+</span> <span class='int'>40</span> <span class='op'>...</span> <span class='const'>HEIGHT</span> <span class='op'>+</span> <span class='int'>60</span> <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_roll'>roll</span><span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_views'>views</span><span class='period'>.</span><span class='id identifier rubyid_normalise'>normalise</span>
  <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span> <span class='int'>0</span> <span class='op'>...</span> <span class='const'>WIDTH</span><span class='comma'>,</span> <span class='const'>HEIGHT</span> <span class='op'>+</span> <span class='int'>60</span> <span class='op'>...</span> <span class='const'>HEIGHT</span> <span class='op'>+</span> <span class='int'>80</span> <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_roll'>roll</span><span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_zebra'>zebra</span>
  <span class='id identifier rubyid_result'>result</span>
<span class='kw'>end</span>
</code></pre>

<h2 id="label-See+Also">See Also</h2>
<ul><li>
<p><span class='object_link'><a href="Hornetseye/XvWidget.html" title="Hornetseye::XvWidget (class)">Hornetseye::XvWidget</a></span></p>
</li></ul>

<h2 id="label-External+Links">External Links</h2>
<ul><li>
<p><a href="http://www.gnuplot.info/">Gnuplot</a></p>
</li><li>
<p><a href="http://rgplot.rubyforge.org/">Ruby Gnuplot</a></p>
</li><li>
<p><a href="http://trollop.rubyforge.org/">trollop</a></p>
</li><li>
<p><a href="ftp://download.intel.com/technology/itj/q21998/pdf/camshift.pdf">Camshift publication</a></p>
</li><li>
<p><a href="http://www.youtube.com/watch?v=LBXgXqtt1F8">Camshift video</a></p>
</li><li>
<p><a href="http://en.wikipedia.org/wiki/European_Article_Number">European Article Number</a></p>
</li><li>
<p><a href="http://en.wikipedia.org/wiki/Universal_Product_Code">Universal Product Code</a></p>
</li><li>
<p><a href="http://www.upcdatabase.com/">UPC database</a></p>
</li><li>
<p><a href="http://www.youtube.com/watch?v=Sv28MUMM_EA">EAN-13 reader video</a></p>
</li><li>
<p><a href="http://video.google.com/videoplay?docid=8157280827402899141">PCA recognition video</a></p>
</li><li>
<p><a href="http://www.camspace.com/">Camspace (play games with your webcam)</a></p>
</li><li>
<p><a href="http://en.wikipedia.org/wiki/Hough_transform">Hough transform</a></p>
</li><li>
<p><a href="http://www.ri.cmu.edu/projects/project_515.html">Lucas-Kanade 20 Years on: A Unifying Framework</a></p>
</li><li>
<p><a href="http://digitalcommons.shu.ac.uk/mmvl_papers/2/">A machine vision extension for the Ruby programming language</a></p>
</li><li>
<p><a href="http://www.nasa.gov/multimedia/hd/">NASA high definition videos</a></p>
</li><li>
<p><a href="http://scribblethink.org/Work/nvisionInterface/nip.html">Fast Normalised Cross-Correlation</a></p>
</li></ul>
</div></div>

      <div id="footer">
  Generated on Mon Feb  3 19:23:56 2025 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.37 (ruby-3.4.1).
</div>

    </div>
  </body>
</html>