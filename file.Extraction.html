<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: Extraction
  
    &mdash; Hornetseye - Ruby-extension for Computer Vision (DEPRECATED, only works with Ruby version up to 2.7.8))
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Extraction";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="file_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: Extraction</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'><h1 id="feature-extraction">Feature Extraction</h1>

<h2 id="sobel-gradient-magnitude">Sobel Gradient Magnitude</h2>

<p><img src="images/sobelmag.png" alt="Sobel gradient magnitude" /></p>

<p>In the following example the sobel gradient magnitude is computed.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_v4l2</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_xorg</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="Hornetseye.html" title="Hornetseye (module)">Hornetseye</a></span></span>
<span class='kw'>class</span> <span class='const'>Node</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_sobel_norm'>sobel_norm</span>
    <span class='const'><span class='object_link'><a href="Math.html" title="Math (module)">Math</a></span></span><span class='period'>.</span><span class='id identifier rubyid_sqrt'><span class='object_link'><a href="Math.html#sqrt-class_method" title="Math.sqrt (method)">sqrt</a></span></span> <span class='id identifier rubyid_sobel'>sobel</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span> <span class='op'>**</span> <span class='int'>2</span> <span class='op'>+</span> <span class='id identifier rubyid_sobel'>sobel</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span> <span class='op'>**</span> <span class='int'>2</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
<span class='id identifier rubyid_input'>input</span> <span class='op'>=</span> <span class='const'>V4L2Input</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='const'>X11Display</span><span class='period'>.</span><span class='id identifier rubyid_show'>show</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_input'>input</span><span class='period'>.</span><span class='id identifier rubyid_read_ubyte'>read_ubyte</span><span class='period'>.</span><span class='id identifier rubyid_sobel_norm'>sobel_norm</span><span class='period'>.</span><span class='id identifier rubyid_normalise'>normalise</span> <span class='int'>255</span> <span class='op'>..</span> <span class='int'>0</span> <span class='rbrace'>}</span>
</code></pre>

<h2 id="roberts-cross-edge-detector">Roberts Cross Edge Detector</h2>

<p><img src="images/roberts.png" alt="Roberts cross edge detector" /></p>

<p>Roberts cross edge detector consists of two small filters. The image is correlated with both filters. The final edge image is computed by taking the sum of the two correlation results.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_rmagick</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_xorg</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="Hornetseye.html" title="Hornetseye (module)">Hornetseye</a></span></span>
<span class='kw'>class</span> <span class='const'>Node</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_roberts'>roberts</span>
    <span class='id identifier rubyid_filter1'>filter1</span> <span class='op'>=</span> <span class='const'>MultiArray</span><span class='lparen'>(</span><span class='const'>SINT</span><span class='comma'>,</span> <span class='int'>2</span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='comma'>,</span>  <span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_filter2'>filter2</span> <span class='op'>=</span> <span class='const'>MultiArray</span><span class='lparen'>(</span><span class='const'>SINT</span><span class='comma'>,</span> <span class='int'>2</span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='lbracket'>[</span> <span class='int'>0</span><span class='comma'>,</span> <span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_convolve'>convolve</span><span class='lparen'>(</span><span class='id identifier rubyid_filter1'>filter1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span> <span class='op'>+</span> <span class='id identifier rubyid_convolve'>convolve</span><span class='lparen'>(</span><span class='id identifier rubyid_filter2'>filter2</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
<span class='id identifier rubyid_img'>img</span> <span class='op'>=</span> <span class='const'>MultiArray</span><span class='period'>.</span><span class='id identifier rubyid_load_ubyte'>load_ubyte</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>http://www.wedesoft.de/hornetseye-api/images/grey.png</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_roberts'>roberts</span><span class='period'>.</span><span class='id identifier rubyid_normalise'>normalise</span><span class='lparen'>(</span><span class='int'>0xFF</span> <span class='op'>..</span> <span class='int'>0</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_show'>show</span>
</code></pre>

<h2 id="difference-of-gaussian">Difference of Gaussian</h2>

<p><img src="images/dog.jpg" alt="Difference of Gaussian" /></p>

<p>The difference of Gaussian is simply the difference of two Gaussian filters of different size.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_rmagick</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_xorg</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="Hornetseye.html" title="Hornetseye (module)">Hornetseye</a></span></span>
<span class='id identifier rubyid_img'>img</span> <span class='op'>=</span> <span class='const'>MultiArray</span><span class='period'>.</span><span class='id identifier rubyid_load_ubytergb'>load_ubytergb</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>http://www.wedesoft.de/hornetseye-api/images/colour.png</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_dog'>dog</span> <span class='op'>=</span> <span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_gauss_blur'>gauss_blur</span><span class='lparen'>(</span><span class='float'>1.5</span><span class='rparen'>)</span> <span class='op'>-</span> <span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_gauss_blur'>gauss_blur</span><span class='lparen'>(</span><span class='float'>3.0</span><span class='rparen'>)</span>
<span class='id identifier rubyid_dog'>dog</span><span class='period'>.</span><span class='id identifier rubyid_normalise'>normalise</span><span class='period'>.</span><span class='id identifier rubyid_show'>show</span>
</code></pre>

<h2 id="laplacian-of-gaussian">Laplacian of Gaussian</h2>

<p><img src="images/log.png" alt="Laplacian of Gaussian" /></p>

<p>The LoG-filter creates an image with zero-crossings at edge locations. The edges can be detected using either dilation or erosion. Alternatively one could match a set of small 3x3 patterns. The notable property of edge detection using the LoG-filter is that it generates closed edge contours.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_xorg</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_rmagick</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="Hornetseye.html" title="Hornetseye (module)">Hornetseye</a></span></span>
<span class='id identifier rubyid_img'>img</span> <span class='op'>=</span> <span class='const'>MultiArray</span><span class='period'>.</span><span class='id identifier rubyid_load_ubyte'>load_ubyte</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>http://www.wedesoft.de/hornetseye-api/images/lena.jpg</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_log'>log</span> <span class='op'>=</span> <span class='const'>MultiArray</span><span class='period'>.</span><span class='id identifier rubyid_laplacian_of_gaussian'>laplacian_of_gaussian</span> <span class='float'>1.4</span><span class='comma'>,</span> <span class='int'>9</span>
<span class='id identifier rubyid_binary'>binary</span> <span class='op'>=</span> <span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_convolve'>convolve</span><span class='lparen'>(</span><span class='id identifier rubyid_log'>log</span><span class='rparen'>)</span> <span class='op'>&gt;=</span> <span class='int'>0</span>
<span class='id identifier rubyid_binary'>binary</span><span class='period'>.</span><span class='id identifier rubyid_not'>not</span><span class='period'>.</span><span class='id identifier rubyid_or'>or</span><span class='lparen'>(</span><span class='id identifier rubyid_binary'>binary</span><span class='period'>.</span><span class='id identifier rubyid_erode'>erode</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_conditional'>conditional</span><span class='lparen'>(</span><span class='int'>0xFF</span><span class='comma'>,</span> <span class='int'>0</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_show'>show</span>
</code></pre>

<h2 id="canny-edge-detector">Canny Edge Detector</h2>

<p><img src="images/canny.png" alt="Canny edge detector" /></p>

<p>The Canny edge detector uses two thresholds. The gradient norm is used to select edges. The gradient orientation is used to perform non-maxima suppression for edges. Edges are suppressed if the gradient is below the high threshold and the edge is not connected to edges with a gradient norm surpassing the high threshold. The Canny algorithm requires tracing along the edges. Here full connectivity is used instead.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_v4l2</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_xorg</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="Hornetseye.html" title="Hornetseye (module)">Hornetseye</a></span></span>
<span class='const'>HIGH</span> <span class='op'>=</span> <span class='float'>6.0</span>
<span class='const'>LOW</span> <span class='op'>=</span> <span class='float'>0.75</span>
<span class='id identifier rubyid_input'>input</span> <span class='op'>=</span> <span class='const'>V4L2Input</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='id identifier rubyid_w'>w</span><span class='comma'>,</span> <span class='id identifier rubyid_h'>h</span> <span class='op'>=</span> <span class='id identifier rubyid_input'>input</span><span class='period'>.</span><span class='id identifier rubyid_width'>width</span><span class='comma'>,</span> <span class='id identifier rubyid_input'>input</span><span class='period'>.</span><span class='id identifier rubyid_height'>height</span>
<span class='const'>X11Display</span><span class='period'>.</span><span class='id identifier rubyid_show'>show</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_img'>img</span> <span class='op'>=</span> <span class='id identifier rubyid_input'>input</span><span class='period'>.</span><span class='id identifier rubyid_read_ubyte'>read_ubyte</span>
  <span class='id identifier rubyid_x'>x</span> <span class='op'>=</span> <span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_gauss_gradient'>gauss_gradient</span> <span class='float'>1.4</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='float'>0.5</span>
  <span class='id identifier rubyid_y'>y</span> <span class='op'>=</span> <span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_gauss_gradient'>gauss_gradient</span> <span class='float'>1.4</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='float'>0.5</span>
  <span class='id identifier rubyid_norm'>norm</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Math.html" title="Math (module)">Math</a></span></span><span class='period'>.</span><span class='id identifier rubyid_hypot'>hypot</span> <span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='id identifier rubyid_y'>y</span>
  <span class='id identifier rubyid_angle'>angle</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Math.html" title="Math (module)">Math</a></span></span><span class='period'>.</span><span class='id identifier rubyid_atan2'><span class='object_link'><a href="Math.html#atan2-class_method" title="Math.atan2 (method)">atan2</a></span></span> <span class='id identifier rubyid_y'>y</span><span class='comma'>,</span> <span class='id identifier rubyid_x'>x</span>
  <span class='id identifier rubyid_orientation'>orientation</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='lparen'>(</span><span class='int'>2</span> <span class='op'>*</span> <span class='const'><span class='object_link'><a href="Math.html" title="Math (module)">Math</a></span></span><span class='op'>::</span><span class='const'>PI</span> <span class='op'>-</span> <span class='const'><span class='object_link'><a href="Math.html" title="Math (module)">Math</a></span></span><span class='op'>::</span><span class='const'>PI</span> <span class='op'>/</span> <span class='int'>8</span> <span class='op'>+</span> <span class='id identifier rubyid_angle'>angle</span><span class='rparen'>)</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='int'>4</span> <span class='op'>/</span> <span class='const'><span class='object_link'><a href="Math.html" title="Math (module)">Math</a></span></span><span class='op'>::</span><span class='const'>PI</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_ubyte'>to_ubyte</span> <span class='op'>%</span> <span class='int'>4</span>
  <span class='id identifier rubyid_idx'>idx</span><span class='comma'>,</span> <span class='id identifier rubyid_idy'>idy</span> <span class='op'>=</span> <span class='id identifier rubyid_lazy'>lazy</span><span class='lparen'>(</span><span class='id identifier rubyid_w'>w</span><span class='comma'>,</span> <span class='id identifier rubyid_h'>h</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span><span class='id identifier rubyid_j'>j</span><span class='op'>|</span> <span class='id identifier rubyid_i'>i</span> <span class='rbrace'>}</span><span class='comma'>,</span> <span class='id identifier rubyid_lazy'>lazy</span><span class='lparen'>(</span><span class='id identifier rubyid_w'>w</span><span class='comma'>,</span> <span class='id identifier rubyid_h'>h</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span><span class='id identifier rubyid_j'>j</span><span class='op'>|</span> <span class='id identifier rubyid_j'>j</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_dx'>dx</span><span class='comma'>,</span> <span class='id identifier rubyid_dy'>dy</span> <span class='op'>=</span> <span class='id identifier rubyid_orientation'>orientation</span><span class='period'>.</span><span class='id identifier rubyid_lut'>lut</span><span class='lparen'>(</span><span class='const'>Sequence</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_orientation'>orientation</span><span class='period'>.</span><span class='id identifier rubyid_lut'>lut</span><span class='lparen'>(</span><span class='const'>Sequence</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='comma'>,</span> <span class='op'>-</span><span class='int'>1</span><span class='comma'>,</span> <span class='op'>-</span><span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_low'>low</span> <span class='op'>=</span> <span class='id identifier rubyid_norm'>norm</span> <span class='op'>&gt;=</span> <span class='id identifier rubyid_norm'>norm</span><span class='period'>.</span><span class='id identifier rubyid_warp'>warp</span><span class='lparen'>(</span><span class='id identifier rubyid_idx'>idx</span> <span class='op'>+</span> <span class='id identifier rubyid_dx'>dx</span><span class='comma'>,</span> <span class='id identifier rubyid_idy'>idy</span> <span class='op'>+</span> <span class='id identifier rubyid_dy'>dy</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_major'>major</span><span class='lparen'>(</span><span class='id identifier rubyid_norm'>norm</span><span class='period'>.</span><span class='id identifier rubyid_warp'>warp</span><span class='lparen'>(</span><span class='id identifier rubyid_idx'>idx</span> <span class='op'>-</span> <span class='id identifier rubyid_dx'>dx</span><span class='comma'>,</span> <span class='id identifier rubyid_idy'>idy</span> <span class='op'>-</span> <span class='id identifier rubyid_dy'>dy</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_major'>major</span><span class='lparen'>(</span><span class='const'>LOW</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_high'>high</span> <span class='op'>=</span> <span class='id identifier rubyid_norm'>norm</span> <span class='op'>&gt;=</span> <span class='const'>HIGH</span>
  <span class='id identifier rubyid_comp'>comp</span> <span class='op'>=</span> <span class='id identifier rubyid_low'>low</span><span class='period'>.</span><span class='id identifier rubyid_components'>components</span>
  <span class='id identifier rubyid_hist'>hist</span> <span class='op'>=</span> <span class='id identifier rubyid_comp'>comp</span><span class='period'>.</span><span class='id identifier rubyid_histogram'>histogram</span> <span class='id identifier rubyid_comp'>comp</span><span class='period'>.</span><span class='id identifier rubyid_max'>max</span> <span class='op'>+</span> <span class='int'>1</span><span class='comma'>,</span> <span class='symbol'>:weight</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_high'>high</span><span class='period'>.</span><span class='id identifier rubyid_to_int'>to_int</span>
  <span class='id identifier rubyid_edges'>edges</span> <span class='op'>=</span> <span class='id identifier rubyid_low'>low</span><span class='period'>.</span><span class='id identifier rubyid_and'>and</span> <span class='id identifier rubyid_comp'>comp</span><span class='period'>.</span><span class='id identifier rubyid_lut'>lut</span><span class='lparen'>(</span><span class='id identifier rubyid_hist'>hist</span> <span class='op'>&gt;</span> <span class='int'>0</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_edges'>edges</span><span class='period'>.</span><span class='id identifier rubyid_conditional'>conditional</span> <span class='id identifier rubyid_high'>high</span><span class='period'>.</span><span class='id identifier rubyid_conditional'>conditional</span><span class='lparen'>(</span><span class='const'>RGB</span><span class='lparen'>(</span><span class='int'>255</span><span class='comma'>,</span> <span class='int'>255</span><span class='comma'>,</span> <span class='int'>0</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='const'>RGB</span><span class='lparen'>(</span><span class='int'>255</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_img'>img</span>
<span class='kw'>end</span>
</code></pre>

<h2 id="corner-strength-by-yang-et-al">Corner Strength by Yang et al.</h2>

<p><img src="images/yang.png" alt="Corner strength by Yang et al." /></p>

<p>The following program computes the corner strength measure by Yang, Burger, Firmin, and Underwood.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_rmagick</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_xorg</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="Hornetseye.html" title="Hornetseye (module)">Hornetseye</a></span></span>
<span class='const'>GRAD_SIGMA</span> <span class='op'>=</span> <span class='float'>2.0</span>
<span class='const'>COV_SIGMA</span> <span class='op'>=</span> <span class='float'>1.0</span>
<span class='const'>NOISE</span> <span class='op'>=</span> <span class='float'>1.0</span>
<span class='const'>EXP</span> <span class='op'>=</span> <span class='float'>0.5</span>
<span class='id identifier rubyid_img'>img</span> <span class='op'>=</span> <span class='const'>MultiArray</span><span class='period'>.</span><span class='id identifier rubyid_load_ubyte'>load_ubyte</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>http://www.wedesoft.de/hornetseye-api/images/grey.png</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_x'>x</span> <span class='op'>=</span> <span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_gauss_gradient'>gauss_gradient</span> <span class='const'>GRAD_SIGMA</span><span class='comma'>,</span> <span class='int'>0</span>
<span class='id identifier rubyid_y'>y</span> <span class='op'>=</span> <span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_gauss_gradient'>gauss_gradient</span> <span class='const'>GRAD_SIGMA</span><span class='comma'>,</span> <span class='int'>1</span>
<span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span> <span class='op'>*</span> <span class='id identifier rubyid_x'>x</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_gauss_blur'>gauss_blur</span> <span class='const'>COV_SIGMA</span>
<span class='id identifier rubyid_b'>b</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_y'>y</span> <span class='op'>*</span> <span class='id identifier rubyid_y'>y</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_gauss_blur'>gauss_blur</span> <span class='const'>COV_SIGMA</span>
<span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span> <span class='op'>*</span> <span class='id identifier rubyid_y'>y</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_gauss_blur'>gauss_blur</span> <span class='const'>COV_SIGMA</span>
<span class='id identifier rubyid_g'>g</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span> <span class='op'>-</span> <span class='id identifier rubyid_b'>b</span><span class='rparen'>)</span> <span class='op'>**</span> <span class='int'>2</span> <span class='op'>+</span> <span class='lparen'>(</span><span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_c'>c</span><span class='rparen'>)</span> <span class='op'>**</span> <span class='int'>2</span><span class='rparen'>)</span> <span class='op'>/</span> <span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span> <span class='op'>+</span> <span class='id identifier rubyid_b'>b</span> <span class='op'>+</span> <span class='const'>NOISE</span> <span class='op'>**</span> <span class='int'>2</span><span class='rparen'>)</span> <span class='op'>**</span> <span class='int'>2</span>
<span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_g'>g</span><span class='period'>.</span><span class='id identifier rubyid_normalise'>normalise</span><span class='lparen'>(</span><span class='float'>1.0</span> <span class='op'>..</span> <span class='float'>0.0</span><span class='rparen'>)</span> <span class='op'>**</span> <span class='const'>EXP</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span> <span class='op'>**</span> <span class='int'>2</span> <span class='op'>+</span> <span class='id identifier rubyid_y'>y</span> <span class='op'>**</span> <span class='int'>2</span><span class='rparen'>)</span>
<span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_normalise'>normalise</span><span class='lparen'>(</span><span class='int'>0xFF</span> <span class='op'>..</span> <span class='int'>0</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_show'>show</span>
</code></pre>

<h2 id="harris-stephens-corner--and-edge-detector">Harris-Stephens Corner- and Edge-Detector</h2>

<p><img src="images/harris.png" alt="Harris-Stephens corner- and edge-detector" /></p>

<p>This program implements the Harris-Stephens corner- and edge-detector. In the resulting image corners will appear white while edges will become black.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_rmagick</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_xorg</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="Hornetseye.html" title="Hornetseye (module)">Hornetseye</a></span></span>
<span class='const'>GRAD_SIGMA</span> <span class='op'>=</span> <span class='int'>1</span>
<span class='const'>COV_SIGMA</span> <span class='op'>=</span> <span class='int'>1</span>
<span class='const'>K</span> <span class='op'>=</span> <span class='float'>0.05</span>
<span class='id identifier rubyid_img'>img</span> <span class='op'>=</span> <span class='const'>MultiArray</span><span class='period'>.</span><span class='id identifier rubyid_load_ubyte'>load_ubyte</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>http://www.wedesoft.de/hornetseye-api/images/grey.png</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_x'>x</span> <span class='op'>=</span> <span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_gauss_gradient'>gauss_gradient</span> <span class='const'>GRAD_SIGMA</span><span class='comma'>,</span> <span class='int'>0</span>
<span class='id identifier rubyid_y'>y</span> <span class='op'>=</span> <span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_gauss_gradient'>gauss_gradient</span> <span class='const'>GRAD_SIGMA</span><span class='comma'>,</span> <span class='int'>1</span>
<span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span> <span class='op'>*</span> <span class='id identifier rubyid_x'>x</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_gauss_blur'>gauss_blur</span> <span class='const'>COV_SIGMA</span>
<span class='id identifier rubyid_b'>b</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_y'>y</span> <span class='op'>*</span> <span class='id identifier rubyid_y'>y</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_gauss_blur'>gauss_blur</span> <span class='const'>COV_SIGMA</span>
<span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span> <span class='op'>*</span> <span class='id identifier rubyid_y'>y</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_gauss_blur'>gauss_blur</span> <span class='const'>COV_SIGMA</span>
<span class='id identifier rubyid_tr'>tr</span> <span class='op'>=</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>+</span> <span class='id identifier rubyid_b'>b</span>
<span class='id identifier rubyid_det'>det</span> <span class='op'>=</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_b'>b</span> <span class='op'>-</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>*</span> <span class='id identifier rubyid_c'>c</span>
<span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_det'>det</span> <span class='op'>-</span> <span class='id identifier rubyid_tr'>tr</span> <span class='op'>*</span> <span class='id identifier rubyid_tr'>tr</span> <span class='op'>*</span> <span class='const'>K</span>
<span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_normalise'>normalise</span><span class='period'>.</span><span class='id identifier rubyid_show'>show</span>
</code></pre>

<h2 id="shi-tomasi-corner-detector">Shi-Tomasi Corner Detector</h2>

<p><img src="images/shi.png" alt="Shi-Tomasi corner detector" /></p>

<p>Here is an implementation of the Shi-Tomasi corner-detector.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_rmagick</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_xorg</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="Hornetseye.html" title="Hornetseye (module)">Hornetseye</a></span></span>
<span class='const'>GRAD_SIGMA</span> <span class='op'>=</span> <span class='int'>1</span>
<span class='const'>COV_SIGMA</span> <span class='op'>=</span> <span class='int'>1</span>
<span class='id identifier rubyid_img'>img</span> <span class='op'>=</span> <span class='const'>MultiArray</span><span class='period'>.</span><span class='id identifier rubyid_load_ubyte'>load_ubyte</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>http://www.wedesoft.de/hornetseye-api/images/grey.png</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_x'>x</span> <span class='op'>=</span> <span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_gauss_gradient'>gauss_gradient</span> <span class='const'>GRAD_SIGMA</span><span class='comma'>,</span> <span class='int'>0</span>
<span class='id identifier rubyid_y'>y</span> <span class='op'>=</span> <span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_gauss_gradient'>gauss_gradient</span> <span class='const'>GRAD_SIGMA</span><span class='comma'>,</span> <span class='int'>1</span>
<span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span> <span class='op'>*</span> <span class='id identifier rubyid_x'>x</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_gauss_blur'>gauss_blur</span> <span class='const'>COV_SIGMA</span>
<span class='id identifier rubyid_b'>b</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_y'>y</span> <span class='op'>*</span> <span class='id identifier rubyid_y'>y</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_gauss_blur'>gauss_blur</span> <span class='const'>COV_SIGMA</span>
<span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span> <span class='op'>*</span> <span class='id identifier rubyid_y'>y</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_gauss_blur'>gauss_blur</span> <span class='const'>COV_SIGMA</span>
<span class='id identifier rubyid_tr'>tr</span> <span class='op'>=</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>+</span> <span class='id identifier rubyid_b'>b</span>
<span class='id identifier rubyid_det'>det</span> <span class='op'>=</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_b'>b</span> <span class='op'>-</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>*</span> <span class='id identifier rubyid_c'>c</span>
<span class='comment'># &quot;major&quot; is needed to deal with numerical errors.
</span><span class='id identifier rubyid_dissqrt'>dissqrt</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Math.html" title="Math (module)">Math</a></span></span><span class='period'>.</span><span class='id identifier rubyid_sqrt'><span class='object_link'><a href="Math.html#sqrt-class_method" title="Math.sqrt (method)">sqrt</a></span></span><span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_tr'>tr</span> <span class='op'>*</span> <span class='id identifier rubyid_tr'>tr</span> <span class='op'>-</span> <span class='id identifier rubyid_det'>det</span> <span class='op'>*</span> <span class='int'>4</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_major'>major</span><span class='lparen'>(</span><span class='float'>0.0</span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='comment'># Take smallest eigenvalue. Eigenvalues are &quot;0.5 * (tr +- dissqrt)&quot;
</span><span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='float'>0.5</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='id identifier rubyid_tr'>tr</span> <span class='op'>-</span> <span class='id identifier rubyid_dissqrt'>dissqrt</span><span class='rparen'>)</span>
<span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_normalise'>normalise</span><span class='lparen'>(</span><span class='int'>0xFF</span> <span class='op'>..</span> <span class='int'>0</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_show'>show</span>
</code></pre>

<h2 id="feature-locations">Feature Locations</h2>

<p><img src="images/features.png" alt="Feature locations" /></p>

<p>Usually computing a feature image is not enough and one needs to determine the locations of the most prominent features. This can be achieved by thresholding the image and then locating the maxima (i.e. performing non-maxima suppression for corners). HornetsEye does not support non-maxima suppression directly. However one can use greylevel dilation followed by masking as shown below.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_rmagick</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hornetseye_xorg</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="Hornetseye.html" title="Hornetseye (module)">Hornetseye</a></span></span>
<span class='kw'>class</span> <span class='const'>Node</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_nms'>nms</span><span class='lparen'>(</span><span class='id identifier rubyid_threshold'>threshold</span> <span class='op'>=</span> <span class='float'>0.05</span><span class='rparen'>)</span>
    <span class='kw'>self</span> <span class='op'>&gt;=</span> <span class='id identifier rubyid_dilate'>dilate</span><span class='period'>.</span><span class='id identifier rubyid_major'>major</span><span class='lparen'>(</span><span class='id identifier rubyid_threshold'>threshold</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_harris'>harris</span><span class='lparen'>(</span><span class='id identifier rubyid_sigma_grad'>sigma_grad</span> <span class='op'>=</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='id identifier rubyid_sigma_avg'>sigma_avg</span> <span class='op'>=</span> <span class='float'>1.0</span><span class='comma'>,</span> <span class='id identifier rubyid_k'>k</span> <span class='op'>=</span> <span class='float'>0.05</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='id identifier rubyid_y'>y</span> <span class='op'>=</span> <span class='id identifier rubyid_gauss_gradient'>gauss_gradient</span><span class='lparen'>(</span><span class='id identifier rubyid_sigma_grad'>sigma_grad</span><span class='comma'>,</span> <span class='int'>0</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_gauss_gradient'>gauss_gradient</span><span class='lparen'>(</span><span class='id identifier rubyid_sigma_grad'>sigma_grad</span><span class='comma'>,</span> <span class='int'>1</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span> <span class='op'>*</span> <span class='id identifier rubyid_x'>x</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_gauss_blur'>gauss_blur</span> <span class='id identifier rubyid_sigma_avg'>sigma_avg</span>
    <span class='id identifier rubyid_b'>b</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_y'>y</span> <span class='op'>*</span> <span class='id identifier rubyid_y'>y</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_gauss_blur'>gauss_blur</span> <span class='id identifier rubyid_sigma_avg'>sigma_avg</span>
    <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span> <span class='op'>*</span> <span class='id identifier rubyid_y'>y</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_gauss_blur'>gauss_blur</span> <span class='id identifier rubyid_sigma_avg'>sigma_avg</span>
    <span class='id identifier rubyid_tr'>tr</span> <span class='op'>=</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>+</span> <span class='id identifier rubyid_b'>b</span>
    <span class='id identifier rubyid_det'>det</span> <span class='op'>=</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>*</span> <span class='id identifier rubyid_b'>b</span> <span class='op'>-</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>*</span> <span class='id identifier rubyid_c'>c</span>
    <span class='id identifier rubyid_det'>det</span> <span class='op'>-</span> <span class='id identifier rubyid_tr'>tr</span> <span class='op'>*</span> <span class='id identifier rubyid_tr'>tr</span> <span class='op'>*</span> <span class='id identifier rubyid_k'>k</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
<span class='id identifier rubyid_img'>img</span> <span class='op'>=</span> <span class='const'>MultiArray</span><span class='period'>.</span><span class='id identifier rubyid_load_ubyte'>load_ubyte</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>http://www.wedesoft.de/hornetseye-api/images/grey.png</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_img'>img</span><span class='period'>.</span><span class='id identifier rubyid_harris'>harris</span><span class='period'>.</span><span class='id identifier rubyid_nms'>nms</span><span class='period'>.</span><span class='id identifier rubyid_dilate'>dilate</span><span class='lparen'>(</span><span class='int'>3</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_conditional'>conditional</span><span class='lparen'>(</span><span class='const'>RGB</span><span class='lparen'>(</span><span class='int'>0</span><span class='comma'>,</span> <span class='int'>255</span><span class='comma'>,</span> <span class='int'>0</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_img'>img</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_show'>show</span>
</code></pre>

<h2 id="see-also">See Also</h2>

<ul>
  <li><span class='object_link'><a href="Hornetseye/Node.html#convolve-instance_method" title="Hornetseye::Node#convolve (method)">Hornetseye::Node#convolve</a></span></li>
  <li><span class='object_link'><a href="Hornetseye/Node.html#sobel-instance_method" title="Hornetseye::Node#sobel (method)">Hornetseye::Node#sobel</a></span></li>
  <li><span class='object_link'><a href="Hornetseye/Node.html#gauss_blur-instance_method" title="Hornetseye::Node#gauss_blur (method)">Hornetseye::Node#gauss_blur</a></span></li>
  <li><span class='object_link'><a href="Hornetseye/Node.html#gauss_gradient-instance_method" title="Hornetseye::Node#gauss_gradient (method)">Hornetseye::Node#gauss_gradient</a></span></li>
</ul>

<h2 id="external-links">External Links</h2>

<ul>
  <li><a href="http://en.wikipedia.org/wiki/Sobel_operator">Sobel operator</a></li>
  <li><a href="http://homepages.inf.ed.ac.uk/rbf/HIPR2/roberts.htm">Roberts cross edge detector</a></li>
  <li><a href="http://en.wikipedia.org/wiki/Canny_edge_detector">Canny edge detector</a></li>
  <li><a href="http://en.wikipedia.org/wiki/Corner_detection">Corner detection</a></li>
  <li><a href="http://en.wikipedia.org/wiki/Difference_of_Gaussians">Difference of Gaussian</a></li>
  <li><a href="http://pubs.doc.ic.ac.uk/structure-anisotropic-image/">Corner strength by Yang et al.</a></li>
  <li><a href="www.bmva.org/bmvc/1988/avc-88-023.pdf">Harris-Stephens corner- and edge detector</a></li>
  <li><a href="http://www.ces.clemson.edu/~stb/klt/">Kanade-Lucas-Tomasi feature tracker</a></li>
</ul>
</div></div>

      <div id="footer">
  Generated on Mon Jun 30 15:58:32 2025 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.37 (ruby-3.4.1).
</div>

    </div>
  </body>
</html>